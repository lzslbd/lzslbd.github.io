<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>phoenix综述（sql on hbase） | LBD&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="大数据NoSQLPhoenix" />
  
  
  
  
  <meta name="description" content="1. Phoenix概述Phoenix最早是saleforce的一个开源项目，后来成为Apache基金的顶级项目。">
<meta property="og:type" content="article">
<meta property="og:title" content="Phoenix综述（SQL on HBase）">
<meta property="og:url" content="http://linbingdong.com/2016/09/02/Phoenix文档/index.html">
<meta property="og:site_name" content="LBD's Blog">
<meta property="og:description" content="1. Phoenix概述Phoenix最早是saleforce的一个开源项目，后来成为Apache基金的顶级项目。">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-ab4f066b9dfce30a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-c0f2f49522ae3da2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-684d1b6dcfcdf8f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-3d6f52d14720d6d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-c1a747aba143487f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-30cf6769ba33e129.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-697a95a8cab3a28d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-38710062c800a26b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-c642457642dacd1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-7c15c329a370c654.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-9079f69e939c61e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-81d30687fe0f32ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-2e4b0e5141927479.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-03-11T12:33:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Phoenix综述（SQL on HBase）">
<meta name="twitter:description" content="1. Phoenix概述Phoenix最早是saleforce的一个开源项目，后来成为Apache基金的顶级项目。">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1752522-ab4f066b9dfce30a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
  
    <link rel="alternate" href="/atom.xml" title="LBD&#39;s Blog" type="application/atom+xml">
  
  <link rel="icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  
    <link rel="stylesheet" href="/css/header-post.css" >
  

  

</head>

<body>
  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;"  
                href="#" data-toggle="modal" data-target="#myModal" >
                  <img width="62px" height="62px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="index.search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://linbingdong.com"></form>

</div></li>
            </div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Phoenix文档" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" class="article-title" itemprop="name">
      Phoenix综述（SQL on HBase）
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/09/02/Phoenix文档/" class="article-date">
	  <time datetime="2016-09-02T09:06:16.000Z" itemprop="datePublished">2016-09-02</time>
	</a>

      
    <a class="article-category-link" href="/categories/Phoenix/">Phoenix</a>
   
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-Phoenix概述"><a href="#1-Phoenix概述" class="headerlink" title="1. Phoenix概述"></a>1. Phoenix概述</h2><p>Phoenix最早是saleforce的一个开源项目，后来成为Apache基金的顶级项目。</p>
<a id="more"></a>
<p>Phoenix是构建在HBase上的一个SQL层，能让我们用标准的JDBC APIs而不是HBase客户端APIs来创建表，插入数据和对HBase数据进行查询。</p>
<blockquote>
<p>put the SQL back in NoSQL</p>
</blockquote>
<p>Phoenix完全使用Java编写，作为HBase内嵌的JDBC驱动。Phoenix查询引擎会将SQL查询转换为一个或多个HBase扫描，并编排执行以生成标准的JDBC结果集。直接使用HBase API、协同处理器与自定义过滤器，对于简单查询来说，其性能量级是毫秒，对于百万级别的行数来说，其性能量级是秒。 </p>
<p>HBase的查询工具有很多，如：Hive、Tez、Impala、Spark SQL、Phoenix等。</p>
<p>Phoenix通过以下方式使我们可以少写代码，并且性能比我们自己写代码更好：</p>
<ul>
<li>将SQL编译成原生的HBase scans。</li>
<li>确定scan关键字的最佳开始和结束</li>
<li>让scan并行执行</li>
<li>…</li>
</ul>
<p>使用Phoenix的公司</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-ab4f066b9dfce30a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<h2 id="2-历史演进"><a href="#2-历史演进" class="headerlink" title="2. 历史演进"></a>2. 历史演进</h2><ul>
<li><strong>3.0/4.0 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/array_type.html" target="_blank" rel="external">ARRAY Type</a></strong>. 支持标准的JDBC数组类型</p>
<p><strong><a href="http://phoenix.apache.org/sequences.html" target="_blank" rel="external">Sequences</a></strong>. 支持 CREATE/DROP SEQUENCE, NEXT VALUE FOR, CURRENT VALUE FOR也实现了</p>
<p><strong><a href="http://phoenix.apache.org/multi-tenancy.html" target="_blank" rel="external">Multi-tenancy</a></strong>. 同一张HBase物理表上，不同的租户可以创建相互独立的视图</p>
<p><strong><a href="http://phoenix.apache.org/views.html" target="_blank" rel="external">Views</a></strong>. 同一张HBase物理表上可以创建不同的视图</p>
<ul>
<li><strong>3.1/4.1 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/pig_integration.html#Pig_Loader" target="_blank" rel="external">Apache Pig Loader</a></strong> . 通过pig来处理数据时支持pig加载器来利用Phoenix的性能</p>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-136" target="_blank" rel="external">Derived Tables</a></strong>. 允许在一个FROM子句中使用SELECT子句来定义一张衍生表</p>
<p><strong><a href="http://phoenix.apache.org/secondary_indexing.html#Local_Indexing" target="_blank" rel="external">Local Indexing</a></strong>. 后面介绍</p>
<p><strong><a href="http://phoenix.apache.org/tracing.html" target="_blank" rel="external">Tracing</a></strong>. 后面介绍</p>
<ul>
<li><strong>3.2/4.2 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/subqueries.html" target="_blank" rel="external">Subqueries</a></strong> 支持在WHERE和FROM子句中的独立子查询和相关子查询</p>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-167" target="_blank" rel="external">Semi/anti joins</a></strong>. 通过标准的[NOT] IN 和 [NOT] EXISTS关键字来支持半/反连接</p>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-852" target="_blank" rel="external">Optimize foreign key joins</a></strong>. 通过利用跳跃扫描过滤器来优化外键连接</p>
<p><strong><a href="http://phoenix.apache.org/update_statistics.html" target="_blank" rel="external">Statistics Collection</a></strong>. 通过收集表的统计信息来提高并行查询能力</p>
<ul>
<li><strong>3.3/4.3 release</strong></li>
</ul>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-1179" target="_blank" rel="external">Many-to-many joins</a></strong>. 支持两边都太大以至于无法放进内存的连接</p>
<p><strong><a href="http://phoenix.apache.org/phoenix_mr.html" target="_blank" rel="external">Map-reduce Integration</a></strong>. 支持Map-reduce集成</p>
<p><strong><a href="http://phoenix.apache.org/secondary_indexing.html#Functional_Indexes" target="_blank" rel="external">Functional Indexes</a></strong>. 后面介绍</p>
<ul>
<li><strong>4.4 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/udf.html" target="_blank" rel="external">User Defined Functions</a></strong>. 后面介绍</p>
<ul>
<li><strong>4.5 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/secondary_indexing.html#Asynchronous_Index_Population" target="_blank" rel="external">Asynchronous Index Population</a></strong>. 通过一个Map-reduce job，索引可以被异步创建</p>
<ul>
<li><strong>4.6 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/rowtimestamp.html" target="_blank" rel="external">Time series Optimization</a></strong>. 优化针对时间序列数据的查询</p>
<ul>
<li><strong>4.7 release</strong></li>
</ul>
<p><strong><a href="http://phoenix.apache.org/transactions.html" target="_blank" rel="external">Transaction Support</a></strong>. 后面介绍</p>
<ul>
<li><strong>4.8 release</strong></li>
</ul>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-258" target="_blank" rel="external">DISTINCT Query Optimization</a></strong>. 使用搜索逻辑来大幅提高 SELECT DISTINCT 和 COUNT DISTINCT的查询性能 </p>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-1734" target="_blank" rel="external">Local Index Improvements</a></strong>. Reworked 后面介绍</p>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-2743" target="_blank" rel="external">Hive Integration</a></strong>. 能够在Phoenix内使用Hive来支持大表和大表之间的连接</p>
<p><strong><a href="https://issues.apache.org/jira/browse/PHOENIX-1311" target="_blank" rel="external">Namespace Mapping</a></strong>. 将Phoenix schema映射到HBase的命名空间来增强不同schema之间的隔离性</p>
<h2 id="3-特性"><a href="#3-特性" class="headerlink" title="3. 特性"></a>3. 特性</h2><h3 id="3-1-Transactions-beta-事务"><a href="#3-1-Transactions-beta-事务" class="headerlink" title="3.1 Transactions (beta)  事务"></a>3.1 <a href="http://phoenix.apache.org/transactions.html" target="_blank" rel="external">Transactions (beta)</a>  事务</h3><p>该特性还处于beta版，并非正式版。通过集成<a href="http://tephra.incubator.apache.org/" target="_blank" rel="external">Tephra</a>,Phoenix可以支持ACID特性。Tephra也是Apache的一个项目,是事务管理器，它在像HBase这样的分布式数据存储上提供全局一致事务。HBase本身在行层次和区层次上支持强一致性，Tephra额外提供交叉区、交叉表的一致性来支持可扩展性。</p>
<p>要想让Phoenix支持事务特性，需要以下步骤：</p>
<ul>
<li>配置客户端hbase-site.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.transactions.enabled<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>配置服务端hbase-site.xml</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="code"><pre><div class="line">&lt;<span class="keyword">property</span>&gt;</div><div class="line">  &lt;<span class="built_in">name</span>&gt;data.tx.snapshot.dir&lt;/<span class="built_in">name</span>&gt;</div><div class="line">  &lt;value&gt;/tmp/tephra/snapshots&lt;/value&gt;</div><div class="line">&lt;/<span class="keyword">property</span>&gt;</div><div class="line">&lt;<span class="keyword">property</span>&gt;</div><div class="line">  &lt;<span class="built_in">name</span>&gt;data.tx.<span class="keyword">timeout</span>&lt;/<span class="built_in">name</span>&gt;</div><div class="line">  &lt;value&gt;<span class="number">60</span>&lt;/value&gt;</div><div class="line">  &lt;description&gt; <span class="keyword">set</span> <span class="keyword">the</span> <span class="keyword">transaction</span> <span class="keyword">timeout</span> (<span class="built_in">time</span> <span class="keyword">after</span> which open transactions become invalid) <span class="keyword">to</span> a reasonable value.&lt;/description&gt;</div><div class="line">&lt;/<span class="keyword">property</span>&gt;</div></pre></td></tr></table></figure>
<ul>
<li>配置$HBASE_HOME并启动Tephra</li>
</ul>
<figure class="highlight awk"><table><tr><td class="code"><pre><div class="line">.<span class="regexp">/bin/</span>tephra</div></pre></td></tr></table></figure>
<p>通过以上配置，Phoenix已经支持了事务特性，但创建表的时候默认还是不支持的。如果想创建一个表支持事务特性，需要显示声明，如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> my_table (k <span class="built_in">BIGINT</span> PRIMARY <span class="keyword">KEY</span>, v <span class="built_in">VARCHAR</span>) <span class="keyword">TRANSACTIONAL</span>=<span class="literal">true</span>;</div></pre></td></tr></table></figure>
<p>就是在建表语句末尾增加 <code>TRANSACTIONAL=true</code>。</p>
<p>原本存在的表也可以更改成支持事务的，需要注意的是，事务表无法改回非事务的，因此更改的时候要小心。一旦改成事务的，就改不回去了。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_other_table <span class="keyword">SET</span> <span class="keyword">TRANSACTIONAL</span>=<span class="literal">true</span>;</div></pre></td></tr></table></figure>
<h3 id="3-2-User-defined-functions-UDFs-用户定义函数"><a href="#3-2-User-defined-functions-UDFs-用户定义函数" class="headerlink" title="3.2 User-defined functions(UDFs)  用户定义函数"></a>3.2 <a href="http://phoenix.apache.org/udf.html" target="_blank" rel="external">User-defined functions(UDFs)</a>  用户定义函数</h3><h4 id="3-2-1-概述"><a href="#3-2-1-概述" class="headerlink" title="3.2.1 概述"></a>3.2.1 概述</h4><p>Phoenix从4.4.0版本开始支持用户自定义函数。</p>
<p>用户可以创建临时或永久的用户自定义函数。这些用户自定义函数可以像内置的create、upsert、delete一样被调用。临时函数是针对特定的会话或连接，对其他会话或连接不可见。永久函数的元信息会被存储在一张叫做SYSTEM.FUNCTION的系统表中，对任何会话或连接均可见。</p>
<h4 id="3-2-2-配置"><a href="#3-2-2-配置" class="headerlink" title="3.2.2 配置"></a>3.2.2 配置</h4><ul>
<li>hive-site.xml</li>
</ul>
<figure class="highlight dust"><table><tr><td class="code"><pre><div class="line"><span class="xml"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>phoenix.functions.allowUserDefinedFunctions<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.hdfs.impl<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>org.apache.hadoop.hdfs.DistributedFileSystem<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>$<span class="template-variable">&#123;hbase.tmp.dir&#125;</span><span class="xml">/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>The directory shared by region servers and into</div><div class="line">    which HBase persists.  The URL should be 'fully-qualified'</div><div class="line">    to include the filesystem scheme.  For example, to specify the</div><div class="line">    HDFS directory '/hbase' where the HDFS instance's namenode is</div><div class="line">    running at namenode.example.org on port 9000, set this value to:</div><div class="line">    hdfs://namenode.example.org:9000/hbase.  By default, we write</div><div class="line">    to whatever $<span class="template-variable">&#123;hbase.tmp.dir&#125;</span><span class="xml"> is set too -- usually /tmp --</span></div><div class="line">    so change this configuration or else all data will be lost on</div><div class="line">    machine restart.<span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.dynamic.jars.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">value</span>&gt;</span>$<span class="template-variable">&#123;hbase.rootdir&#125;</span><span class="xml">/lib<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></div><div class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span></div><div class="line">    The directory from which the custom udf jars can be loaded</div><div class="line">    dynamically by the phoenix client/region server without the need to restart. However,</div><div class="line">    an already loaded udf class would not be un-loaded. See</div><div class="line">    HBASE-1936 for more details.</div><div class="line">  <span class="tag">&lt;/<span class="name">description</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div></pre></td></tr></table></figure>
<p>后两个配置需要跟hbse服务端的配置一致。</p>
<p>以上配置完后，在JDBC连接时还需要执行以下语句：</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><div class="line">Properties <span class="built_in">props</span> = <span class="built_in">new</span> Properties();</div><div class="line"><span class="built_in">props</span>.setProperty(<span class="string">"phoenix.functions.allowUserDefinedFunctions"</span>, <span class="string">"true"</span>);</div><div class="line">Connection conn = DriverManager.getConnection(<span class="string">"jdbc:phoenix:localhost"</span>, <span class="built_in">props</span>);</div></pre></td></tr></table></figure>
<p>以下是可选的配置，用于动态类加载的时候把jar包从hdfs拷贝到本地文件系统</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><div class="line">&lt;<span class="keyword">property</span>&gt;</div><div class="line">  &lt;<span class="built_in">name</span>&gt;hbase.<span class="keyword">local</span>.dir&lt;/<span class="built_in">name</span>&gt;</div><div class="line">  &lt;value&gt;$&#123;hbase.tmp.dir&#125;/<span class="keyword">local</span>/&lt;/value&gt;</div><div class="line">  &lt;description&gt;Directory <span class="keyword">on</span> <span class="keyword">the</span> <span class="keyword">local</span> filesystem <span class="keyword">to</span> be used</div><div class="line">    <span class="keyword">as</span> a <span class="keyword">local</span> storage.&lt;/description&gt;</div><div class="line">&lt;/<span class="keyword">property</span>&gt;</div></pre></td></tr></table></figure>
<h3 id="3-3-Secondary-Indexing-二级索引"><a href="#3-3-Secondary-Indexing-二级索引" class="headerlink" title="3.3 Secondary Indexing  二级索引"></a>3.3 <a href="http://phoenix.apache.org/secondary_indexing.html" target="_blank" rel="external">Secondary Indexing</a>  二级索引</h3><p>在HBase中，只有一个单一的按照字典序排序的rowKey索引，当使用rowKey来进行数据查询的时候速度较快，但是如果不使用rowKey来查询的话就会使用filter来对全表进行扫描，很大程度上降低了检索性能。而Phoenix提供了二级索引技术来应对这种使用rowKey之外的条件进行检索的场景。</p>
<ul>
<li>Covered Indexes</li>
</ul>
<blockquote>
<p>只需要通过索引就能返回所要查询的数据，所以索引的列必须包含所需查询的列(SELECT的列和WHRER的列)</p>
</blockquote>
<ul>
<li>Functional Indexes</li>
</ul>
<blockquote>
<p>从Phoeinx4.3以上就支持函数索引，其索引不局限于列，可以合适任意的表达式来创建索引，当在查询时用到了这些表达式时就直接返回表达式结果</p>
</blockquote>
<ul>
<li>Global Indexes</li>
</ul>
<blockquote>
<p>Global indexing适用于多读少写的业务场景。<br>使用Global indexing的话在写数据的时候会消耗大量开销，因为所有对数据表的更新操作（DELETE, UPSERT VALUES and UPSERT SELECT）,会引起索引表的更新，而索引表是分布在不同的数据节点上的，跨节点的数据传输带来了较大的性能消耗。在读数据的时候Phoenix会选择索引表来降低查询消耗的时间。在默认情况下如果想查询的字段不是索引字段的话索引表不会被使用，也就是说不会带来查询速度的提升。</p>
</blockquote>
<ul>
<li>Local Indexes</li>
</ul>
<blockquote>
<p>Local indexing适用于写操作频繁的场景。<br>与Global indexing一样，Phoenix会自动判定在进行查询的时候是否使用索引。使用Local indexing时，索引数据和数据表的数据是存放在相同的服务器中的避免了在写操作的时候往不同服务器的索引表中写索引带来的额外开销。使用Local indexing的时候即使查询的字段不是索引字段索引表也会被使用，这会带来查询速度的提升，这点跟Global indexing不同。一个数据表的所有索引数据都存储在一个单一的独立的可共享的表中。</p>
</blockquote>
<h3 id="3-4-Statistics-Collection-统计信息收集"><a href="#3-4-Statistics-Collection-统计信息收集" class="headerlink" title="3.4 Statistics Collection  统计信息收集"></a>3.4 <a href="http://phoenix.apache.org/update_statistics.html" target="_blank" rel="external">Statistics Collection</a>  统计信息收集</h3><blockquote>
<p>UPDATE STATISTICS可以更新某张表的统计信息，以提高查询性能</p>
</blockquote>
<h3 id="3-5-Row-timestamp-时间戳"><a href="#3-5-Row-timestamp-时间戳" class="headerlink" title="3.5 Row timestamp  时间戳"></a>3.5 <a href="http://phoenix.apache.org/rowtimestamp.html" target="_blank" rel="external">Row timestamp</a>  时间戳</h3><blockquote>
<p>从4.6版本开始，Phoenix提供了一种将HBase原生的row timestamp映射到Phoenix列的方法。这样有利于充分利用HBase提供的针对存储文件的时间范围的各种优化，以及Phoenix内置的各种查询优化。</p>
</blockquote>
<h3 id="3-6-Paged-Queries-分页查询"><a href="#3-6-Paged-Queries-分页查询" class="headerlink" title="3.6 Paged Queries  分页查询"></a>3.6 <a href="http://phoenix.apache.org/paged.html#" target="_blank" rel="external">Paged Queries</a>  分页查询</h3><blockquote>
<p>Phoenix支持分页查询：</p>
<ul>
<li>Row Value Constructors (RVC)</li>
<li>OFFSET with limit</li>
</ul>
</blockquote>
<h3 id="3-7-Salted-Tables-散步表"><a href="#3-7-Salted-Tables-散步表" class="headerlink" title="3.7 Salted Tables  散步表"></a>3.7 <a href="http://phoenix.apache.org/salted.html" target="_blank" rel="external">Salted Tables</a>  散步表</h3><blockquote>
<p>如果row key是自动增长的，那么HBase的顺序写会导致region server产生数据热点的问题，Phoenix的Salted Tables技术可以解决region server的热点问题</p>
</blockquote>
<h3 id="3-8-Skip-Scan-跳跃扫描"><a href="#3-8-Skip-Scan-跳跃扫描" class="headerlink" title="3.8 Skip Scan  跳跃扫描"></a>3.8 <a href="http://phoenix.apache.org/skip_scan.html" target="_blank" rel="external">Skip Scan</a>  跳跃扫描</h3><blockquote>
<p>可以在范围扫描的时候提高性能</p>
</blockquote>
<h3 id="3-9-Views-视图"><a href="#3-9-Views-视图" class="headerlink" title="3.9 Views  视图"></a>3.9 <a href="http://phoenix.apache.org/views.html" target="_blank" rel="external">Views</a>  视图</h3><blockquote>
<p>标准的SQL视图语法现在在Phoenix上也支持了。这使得能在同一张底层HBase物理表上创建多个虚拟表。</p>
</blockquote>
<h3 id="3-10-Multi-tenancy-多租户"><a href="#3-10-Multi-tenancy-多租户" class="headerlink" title="3.10 Multi tenancy  多租户"></a>3.10 <a href="http://phoenix.apache.org/multi-tenancy.html" target="_blank" rel="external">Multi tenancy</a>  多租户</h3><blockquote>
<p>通过指定不同的租户连接实现数据访问的隔离</p>
</blockquote>
<h3 id="3-11-Dynamic-Columns-动态列"><a href="#3-11-Dynamic-Columns-动态列" class="headerlink" title="3.11 Dynamic Columns  动态列"></a>3.11 <a href="http://phoenix.apache.org/dynamic_columns.html" target="_blank" rel="external">Dynamic Columns</a>  动态列</h3><blockquote>
<p>Phoenix 1.2, specifying columns dynamically is now supported by allowing column definitions to included in parenthesis after the table in the FROM clause on a SELECT statement. Although this is not standard SQL, it is useful to surface this type of functionality to leverage the late binding ability of HBase.</p>
</blockquote>
<h3 id="3-12-Bulk-CSV-Data-Loading-大量CSV数据加载"><a href="#3-12-Bulk-CSV-Data-Loading-大量CSV数据加载" class="headerlink" title="3.12 Bulk CSV Data Loading  大量CSV数据加载"></a>3.12 <a href="http://phoenix.apache.org/bulk_dataload.html" target="_blank" rel="external">Bulk CSV Data Loading</a>  大量CSV数据加载</h3><blockquote>
<p>加载CSV数据到Phoenix表有两种方式：1. 通过psql命令以单线程的方式加载，数据量少的情况下适用。 2. 基于MapReduce的bulk load工具，适用于数据量大的情况</p>
</blockquote>
<h3 id="3-13-Query-Server-查询服务器"><a href="#3-13-Query-Server-查询服务器" class="headerlink" title="3.13 Query Server  查询服务器"></a>3.13 <a href="http://phoenix.apache.org/server.html" target="_blank" rel="external">Query Server</a>  查询服务器</h3><blockquote>
<p>Phoenix4.4引入的一个单独的服务器来提供thin客户端的连接</p>
</blockquote>
<h3 id="3-14-Tracing-追踪"><a href="#3-14-Tracing-追踪" class="headerlink" title="3.14 Tracing  追踪"></a>3.14 <a href="http://phoenix.apache.org/tracing.html" target="_blank" rel="external">Tracing</a>  追踪</h3><blockquote>
<p>从4.1版本开始Phoenix增加这个特性来追踪每条查询的踪迹，这使用户能够看到每一条查询或插入操作背后从客户端到HBase端执行的每一步。</p>
</blockquote>
<h3 id="3-15-Metrics-指标"><a href="#3-15-Metrics-指标" class="headerlink" title="3.15 Metrics  指标"></a>3.15 <a href="http://phoenix.apache.org/metrics.html" target="_blank" rel="external">Metrics</a>  指标</h3><blockquote>
<p>Phoenix提供各种各样的指标使我们能够知道Phoenix客户端在执行不同SQL语句的时候其内部发生了什么。这些指标在客户端JVM中通过两种方式来收集：</p>
<ul>
<li><strong>Request level metrics</strong> - collected at an individual SQL statement<br>level</li>
<li><strong>Global metrics</strong> - collected at the client JVM level</li>
</ul>
</blockquote>
<h2 id="4-架构和组成"><a href="#4-架构和组成" class="headerlink" title="4. 架构和组成"></a>4. 架构和组成</h2><ul>
<li>Phoenix架构</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-c0f2f49522ae3da2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Phoenix Architecture.png"></p>
<ul>
<li>Phoenix在Hadoop生态系统中的位置</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-684d1b6dcfcdf8f9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="位置.png"></p>
<h2 id="5-数据存储"><a href="#5-数据存储" class="headerlink" title="5. 数据存储"></a>5. 数据存储</h2><blockquote>
<p>Phoenix将HBase的数据模型映射到关系型世界</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-3d6f52d14720d6d9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Data Model.png"></p>
<h2 id="6-对QL的支持"><a href="#6-对QL的支持" class="headerlink" title="6. 对QL的支持"></a>6. 对QL的支持</h2><p>支持的命令如下：</p>
<ul>
<li>SELECT</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">TEST</span> <span class="keyword">LIMIT</span> <span class="number">1000</span>;</div><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">TEST</span> <span class="keyword">LIMIT</span> <span class="number">1000</span> <span class="keyword">OFFSET</span> <span class="number">100</span>;</div><div class="line"><span class="keyword">SELECT</span> full_name <span class="keyword">FROM</span> SALES_PERSON <span class="keyword">WHERE</span> ranking &gt;= <span class="number">5.0</span> <span class="keyword">UNION</span> ALL <span class="keyword">SELECT</span> reviewer_name <span class="keyword">FROM</span> CUSTOMER_REVIEW <span class="keyword">WHERE</span> score &gt;= <span class="number">8.0</span></div></pre></td></tr></table></figure>
<ul>
<li>UPSERT VALUES</li>
</ul>
<figure class="highlight less"><table><tr><td class="code"><pre><div class="line"><span class="attribute">Example</span>:</div><div class="line">UPSERT INTO TEST VALUES(<span class="string">'foo'</span>,<span class="string">'bar'</span>,<span class="number">3</span>);</div><div class="line"><span class="selector-tag">UPSERT</span> <span class="selector-tag">INTO</span> <span class="selector-tag">TEST</span>(NAME,ID) <span class="selector-tag">VALUES</span>(<span class="string">'foo'</span>,<span class="number">123</span>);</div></pre></td></tr></table></figure>
<ul>
<li>UPSERT SELECT</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line">UPSERT INTO test.targetTable(col1, col2) <span class="keyword">SELECT</span> col3, col4 <span class="keyword">FROM</span> test.sourceTable <span class="keyword">WHERE</span> col5 &lt; <span class="number">100</span></div><div class="line"><span class="keyword">UPSERT</span> <span class="keyword">INTO</span> foo <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> bar;</div></pre></td></tr></table></figure>
<ul>
<li>DELETE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">TEST</span>;</div><div class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">TEST</span> <span class="keyword">WHERE</span> <span class="keyword">ID</span>=<span class="number">123</span>;</div><div class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">TEST</span> <span class="keyword">WHERE</span> <span class="keyword">NAME</span> <span class="keyword">LIKE</span> <span class="string">'foo%'</span>;</div></pre></td></tr></table></figure>
<ul>
<li>CREATE TABLE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> my_schema.my_table ( <span class="keyword">id</span> <span class="built_in">BIGINT</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>, <span class="built_in">date</span>)</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> my_table ( <span class="keyword">id</span> <span class="built_in">INTEGER</span> <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span> <span class="keyword">desc</span>, <span class="built_in">date</span> <span class="built_in">DATE</span> <span class="keyword">not</span> <span class="literal">null</span>,m.db_utilization <span class="built_in">DECIMAL</span>, i.db_utilization) m.DATA_BLOCK_ENCODING=<span class="string">'DIFF'</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stats.prod_metrics ( host <span class="built_in">char</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>, created_date <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span>,txn_count <span class="built_in">bigint</span> <span class="keyword">CONSTRAINT</span> pk PRIMARY <span class="keyword">KEY</span> (host, created_date) )</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">"my_case_sensitive_table"</span></div><div class="line">    ( <span class="string">"id"</span> <span class="built_in">char</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span> primary <span class="keyword">key</span>, <span class="string">"value"</span> <span class="built_in">integer</span>)</div><div class="line">    DATA_BLOCK_ENCODING=<span class="string">'NONE'</span>,<span class="keyword">VERSIONS</span>=<span class="number">5</span>,MAX_FILESIZE=<span class="number">2000000</span> <span class="keyword">split</span> <span class="keyword">on</span> (?, ?, ?)</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> my_schema.my_table (org_id <span class="built_in">CHAR</span>(<span class="number">15</span>), entity_id <span class="built_in">CHAR</span>(<span class="number">15</span>), payload <span class="built_in">binary</span>(<span class="number">1000</span>),<span class="keyword">CONSTRAINT</span> pk PRIMARY <span class="keyword">KEY</span> (org_id, entity_id) )TTL=<span class="number">86400</span></div></pre></td></tr></table></figure>
<ul>
<li>DROP TABLE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> my_schema.my_table;</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_table;</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> my_schema.my_table <span class="keyword">CASCADE</span>;</div></pre></td></tr></table></figure>
<ul>
<li>CREATE FUNCTION</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> my_reverse(<span class="built_in">varchar</span>) <span class="keyword">returns</span> <span class="built_in">varchar</span> <span class="keyword">as</span> <span class="string">'com.mypackage.MyReverseFunction'</span> <span class="keyword">using</span> jar <span class="string">'hdfs:/localhost:8080/hbase/lib/myjar.jar'</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> my_reverse(<span class="built_in">varchar</span>) <span class="keyword">returns</span> <span class="built_in">varchar</span> <span class="keyword">as</span> <span class="string">'com.mypackage.MyReverseFunction'</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> my_increment(<span class="built_in">integer</span>, <span class="built_in">integer</span> <span class="keyword">constant</span> defaultvalue=<span class="string">'10'</span>) <span class="keyword">returns</span> <span class="built_in">integer</span> <span class="keyword">as</span> <span class="string">'com.mypackage.MyIncrementFunction'</span> <span class="keyword">using</span> jar <span class="string">'/hbase/lib/myincrement.jar'</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">FUNCTION</span> my_reverse(<span class="built_in">varchar</span>) <span class="keyword">returns</span> <span class="built_in">varchar</span> <span class="keyword">as</span> <span class="string">'com.mypackage.MyReverseFunction'</span> <span class="keyword">using</span> jar <span class="string">'hdfs:/localhost:8080/hbase/lib/myjar.jar'</span></div></pre></td></tr></table></figure>
<ul>
<li>DROP FUNCTION</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_reverse</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> my_reverse</div></pre></td></tr></table></figure>
<ul>
<li>CREATE VIEW</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> <span class="string">"my_hbase_table"</span>( k <span class="built_in">VARCHAR</span> primary <span class="keyword">key</span>, <span class="string">"v"</span> UNSIGNED_LONG) default_column_family=<span class="string">'a'</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> my_view ( new_col <span class="built_in">SMALLINT</span> ) <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> my_table <span class="keyword">WHERE</span> k = <span class="number">100</span>;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> my_view_on_view <span class="keyword">AS</span> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> my_view <span class="keyword">WHERE</span> new_col &gt; <span class="number">70</span>;</div></pre></td></tr></table></figure>
<ul>
<li>DROP VIEW</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> my_view</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_schema.my_view</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_schema.my_view <span class="keyword">CASCADE</span></div></pre></td></tr></table></figure>
<ul>
<li>CREATE SEQUENCE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> my_sequence;</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> my_sequence <span class="keyword">START</span> <span class="keyword">WITH</span> <span class="number">-1000</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> my_sequence <span class="keyword">INCREMENT</span> <span class="keyword">BY</span> <span class="number">10</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SEQUENCE</span> my_schema.my_sequence <span class="keyword">START</span> <span class="number">0</span> <span class="keyword">CACHE</span> <span class="number">10</span></div></pre></td></tr></table></figure>
<ul>
<li>DROP SEQUENCE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">SEQUENCE</span> my_sequence</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">SEQUENCE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_schema.my_sequence</div></pre></td></tr></table></figure>
<ul>
<li>ALTER</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_schema.my_table <span class="keyword">ADD</span> d.dept_id <span class="built_in">char</span>(<span class="number">10</span>) <span class="keyword">VERSIONS</span>=<span class="number">10</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_table <span class="keyword">ADD</span> dept_name <span class="built_in">char</span>(<span class="number">50</span>), parent_id <span class="built_in">char</span>(<span class="number">15</span>) <span class="literal">null</span> primary <span class="keyword">key</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_table <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> d.dept_id, parent_id;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> my_view <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> new_col;</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> my_table <span class="keyword">SET</span> IMMUTABLE_ROWS=<span class="literal">true</span>,DISABLE_WAL=<span class="literal">true</span>;</div></pre></td></tr></table></figure>
<ul>
<li>CREATE INDEX</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> my_idx <span class="keyword">ON</span> sales.opportunity(last_updated_date <span class="keyword">DESC</span>)</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> my_idx <span class="keyword">ON</span> log.event(created_date <span class="keyword">DESC</span>) <span class="keyword">INCLUDE</span> (<span class="keyword">name</span>, payload) SALT_BUCKETS=<span class="number">10</span></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> my_comp_idx <span class="keyword">ON</span> server_metrics ( gc_time <span class="keyword">DESC</span>, created_date <span class="keyword">DESC</span> ) DATA_BLOCK_ENCODING=<span class="string">'NONE'</span>,<span class="keyword">VERSIONS</span>=?,MAX_FILESIZE=<span class="number">2000000</span> <span class="keyword">split</span> <span class="keyword">on</span> (?, ?, ?)</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> my_idx <span class="keyword">ON</span> sales.opportunity(<span class="keyword">UPPER</span>(contact_name))</div></pre></td></tr></table></figure>
<ul>
<li>DROP INDEX</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> my_idx <span class="keyword">ON</span> sales.opportunity</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">INDEX</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_idx <span class="keyword">ON</span> server_metrics</div></pre></td></tr></table></figure>
<ul>
<li>ALTER INDEX</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> my_idx <span class="keyword">ON</span> sales.opportunity <span class="keyword">DISABLE</span></div><div class="line"><span class="keyword">ALTER</span> <span class="keyword">INDEX</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_idx <span class="keyword">ON</span> server_metrics <span class="keyword">REBUILD</span></div></pre></td></tr></table></figure>
<ul>
<li>EXPLAIN</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> <span class="keyword">NAME</span>, <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> <span class="keyword">TEST</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">NAME</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt; <span class="number">2</span>;</div><div class="line"><span class="keyword">EXPLAIN</span> <span class="keyword">SELECT</span> entity_id <span class="keyword">FROM</span> CORE.CUSTOM_ENTITY_DATA <span class="keyword">WHERE</span> organization_id=<span class="string">'00D300000000XHP'</span> <span class="keyword">AND</span> <span class="keyword">SUBSTR</span>(entity_id,<span class="number">1</span>,<span class="number">3</span>) = <span class="string">'002'</span> <span class="keyword">AND</span> created_date &lt; <span class="keyword">CURRENT_DATE</span>()<span class="number">-1</span>;</div></pre></td></tr></table></figure>
<ul>
<li>UPDATE STATISTICS</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> my_table</div><div class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> my_schema.my_table <span class="keyword">INDEX</span></div><div class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> my_index</div><div class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> my_table <span class="keyword">COLUMNS</span></div><div class="line"><span class="keyword">UPDATE</span> <span class="keyword">STATISTICS</span> my_table <span class="keyword">SET</span> phoenix.stats.guidepost.width=<span class="number">50000000</span></div></pre></td></tr></table></figure>
<ul>
<li>CREATE SCHEMA</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> my_schema</div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">SCHEMA</span> my_schema</div></pre></td></tr></table></figure>
<ul>
<li>USE</li>
</ul>
<figure class="highlight fortran"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">USE</span> my_schema</div><div class="line"><span class="keyword">USE</span> <span class="keyword">DEFAULT</span></div></pre></td></tr></table></figure>
<ul>
<li>DROP SCHEMA</li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Example:</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> my_schema</div><div class="line"><span class="keyword">DROP</span> <span class="keyword">SCHEMA</span> my_schema</div></pre></td></tr></table></figure>
<h2 id="7-安装部署"><a href="#7-安装部署" class="headerlink" title="7. 安装部署"></a>7. 安装部署</h2><h3 id="7-1-安装预编译的Phoenix"><a href="#7-1-安装预编译的Phoenix" class="headerlink" title="7.1 安装预编译的Phoenix"></a>7.1 安装预编译的Phoenix</h3><ul>
<li><p>下载并解压最新版的phoenix-[version]-bin.tar包</p>
</li>
<li><p>将phoenix-[version]-server.jar放入服务端和master节点的HBase的lib目录下</p>
</li>
<li><p>重启HBase</p>
</li>
<li><p>将phoenix-[version]-client.jar添加到所有Phoenix客户端的classpath</p>
</li>
</ul>
<h3 id="7-2-使用Phoenix"><a href="#7-2-使用Phoenix" class="headerlink" title="7.2 使用Phoenix"></a>7.2 使用Phoenix</h3><h4 id="7-2-1-命令行"><a href="#7-2-1-命令行" class="headerlink" title="7.2.1 命令行"></a>7.2.1 命令行</h4><p>若要在命令行执行交互式SQL语句：</p>
<p>1.切换到bin目录</p>
<p>2.执行以下语句</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">$ sqlline<span class="selector-class">.py</span> localhost</div></pre></td></tr></table></figure>
<p>若要在命令行执行SQL脚本</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">$ sqlline<span class="selector-class">.py</span> localhost ../examples/stock_symbol.sql</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-c1a747aba143487f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<h4 id="7-2-2-客户端"><a href="#7-2-2-客户端" class="headerlink" title="7.2.2 客户端"></a>7.2.2 客户端</h4><p> <a href="http://squirrel-sql.sourceforge.net/" target="_blank" rel="external">SQuirrel</a>是用来连接Phoenix的客户端。</p>
<p>SQuirrel安装步骤如下：</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><div class="line"><span class="number">1.</span> Remove prior phoenix-[*oldversion*]-client.jar <span class="built_in">from</span> <span class="keyword">the</span> lib <span class="built_in">directory</span> <span class="keyword">of</span> SQuirrel, copy phoenix-[*newversion*]-client.jar <span class="built_in">to</span> <span class="keyword">the</span> lib <span class="built_in">directory</span> (*newversion* should be compatible <span class="keyword">with</span> <span class="keyword">the</span> <span class="built_in">version</span> <span class="keyword">of</span> <span class="keyword">the</span> phoenix server jar used <span class="keyword">with</span> your HBase installation)</div><div class="line"><span class="number">2.</span> Start SQuirrel <span class="keyword">and</span> <span class="built_in">add</span> <span class="built_in">new</span> driver <span class="built_in">to</span> SQuirrel (Drivers -&gt; New Driver)</div><div class="line"><span class="number">3.</span> In Add Driver dialog box, <span class="built_in">set</span> Name <span class="built_in">to</span> Phoenix, <span class="keyword">and</span> <span class="built_in">set</span> <span class="keyword">the</span> Example <span class="built_in">URL</span> <span class="built_in">to</span> jdbc:phoenix:localhost.</div><div class="line"><span class="number">4.</span> Type “org.apache.phoenix.jdbc.PhoenixDriver” <span class="keyword">into</span> <span class="keyword">the</span> Class Name textbox <span class="keyword">and</span> click OK <span class="built_in">to</span> <span class="built_in">close</span> this dialog.</div><div class="line"><span class="number">5.</span> Switch <span class="built_in">to</span> Alias <span class="literal">tab</span> <span class="keyword">and</span> <span class="built_in">create</span> <span class="keyword">the</span> <span class="built_in">new</span> Alias (Aliases -&gt; New Aliases)</div><div class="line"><span class="number">6.</span> In <span class="keyword">the</span> dialog box, Name: *<span class="keyword">any</span> name*, Driver: Phoenix, User Name: *anything*, Password: *anything*</div><div class="line"><span class="number">7.</span> Construct <span class="built_in">URL</span> <span class="keyword">as</span> follows: jdbc:phoenix: *zookeeper quorum server*. For example, <span class="built_in">to</span> connect <span class="built_in">to</span> <span class="keyword">a</span> <span class="built_in">local</span> HBase use: jdbc:phoenix:localhost</div><div class="line"><span class="number">8.</span> Press Test (which should succeed <span class="keyword">if</span> everything is setup correctly) <span class="keyword">and</span> press OK <span class="built_in">to</span> <span class="built_in">close</span>.</div><div class="line"><span class="number">9.</span> Now double click <span class="keyword">on</span> <span class="title">your</span> <span class="title">newly</span> <span class="title">created</span> <span class="title">Phoenix</span> <span class="title">alias</span> <span class="title">and</span> <span class="title">click</span> <span class="title">Connect</span>. <span class="title">Now</span> <span class="title">you</span> <span class="title">are</span> <span class="title">ready</span> <span class="title">to</span> <span class="title">run</span> <span class="title">SQL</span> <span class="title">queries</span> <span class="title">against</span> <span class="title">Phoenix</span>.</div></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-30cf6769ba33e129.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<h2 id="8-测试"><a href="#8-测试" class="headerlink" title="8. 测试"></a>8. 测试</h2><h3 id="8-1-Pherf"><a href="#8-1-Pherf" class="headerlink" title="8.1 Pherf"></a>8.1 Pherf</h3><p>Pherf是可以通过Phoenix来进行性能和功能测试的工具。Pherf可以用来生成高度定制的数据集，并且测试SQL在这些数据集上的性能。</p>
<h4 id="8-1-1-构建Pherf"><a href="#8-1-1-构建Pherf" class="headerlink" title="8.1.1 构建Pherf"></a>8.1.1 构建Pherf</h4><p>Pherf是在用maven构建Phoenix的过程中同时构建的。可以用两种不同的配置来构建：</p>
<ol>
<li>集群（默认）</li>
</ol>
<blockquote>
<p>This profile builds Pherf such that it can run along side an existing cluster. The dependencies are pulled from the HBase classpath.</p>
</blockquote>
<ol>
<li>独立</li>
</ol>
<blockquote>
<p>This profile builds all of Pherf’s dependencies into a single standalone jar. The deps will be pulled from the versions specified in Phoenix’s pom.</p>
</blockquote>
<ul>
<li>构建全部的Phoenix。包含Pherf的默认配置。</li>
</ul>
<figure class="highlight ada"><table><tr><td class="code"><pre><div class="line">mvn clean <span class="keyword">package</span> <span class="title">-DskipTests</span></div></pre></td></tr></table></figure>
<ul>
<li>用Pherf的独立配置来构建Phoenix。</li>
</ul>
<figure class="highlight ada"><table><tr><td class="code"><pre><div class="line">mvn clean <span class="keyword">package</span> <span class="title">-P standalone -DskipTests</span></div></pre></td></tr></table></figure>
<h4 id="8-1-2-安装"><a href="#8-1-2-安装" class="headerlink" title="8.1.2 安装"></a>8.1.2 安装</h4><p>用以上的Maven命令构建完Pherf后，会在该模块的目标目录下生成一个zip文件。</p>
<ol>
<li>将该zip文件解压到合适的目录</li>
<li>配置<code>env.sh</code>文件</li>
<li>./pherf.sh -h</li>
<li>想要在一个真正的集群上测试，运行如下命令: </li>
</ol>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">./pherf<span class="selector-class">.sh</span> -drop all -l -<span class="selector-tag">q</span> -z localhost -schemaFile .*user_defined_schema<span class="selector-class">.sql</span> -scenarioFile .*user_defined_scenario.xml</div></pre></td></tr></table></figure>
<h4 id="8-1-3-命令示例"><a href="#8-1-3-命令示例" class="headerlink" title="8.1.3 命令示例"></a>8.1.3 命令示例</h4><ul>
<li>列出所有可运行的场景文件</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">$./pherf<span class="selector-class">.sh</span> -listFiles</div></pre></td></tr></table></figure>
<ul>
<li>删掉全部场景文件中存在的特定的表、加载和查询数据</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">$./pherf<span class="selector-class">.sh</span> -drop all -l -<span class="selector-tag">q</span> -z localhost</div></pre></td></tr></table></figure>
<h4 id="8-1-4-参数"><a href="#8-1-4-参数" class="headerlink" title="8.1.4 参数"></a>8.1.4 参数</h4><blockquote>
<p>-h Help<br>-l Apply schema and load data<br>-q Executes Multi-threaded query sets and write results<br>-z [quorum] Zookeeper quorum<br>-m Enable monitor for statistics<br>-monitorFrequency [frequency in Ms] _Frequency at which the monitor will snopshot stats to log file.<br>-drop [pattern] Regex drop all tables with schema name as PHERF. Example drop Event tables: -drop .(EVENT). Drop all: -drop .<em> or -drop all</em><br>-scenarioFile Regex or file name of a specific scenario file to run.<br>-schemaFile Regex or file name of a specific schema file to run.<br>-export Exports query results to CSV files in CSV_EXPORT directory<br>-diff Compares results with previously exported results<br>-hint Executes all queries with specified hint. Example SMALL<br>-rowCountOverride<br>-rowCountOverride [number of rows] Specify number of rows to be upserted rather than using row count specified in schema</p>
</blockquote>
<h4 id="8-1-5-为数据生成增加规则"><a href="#8-1-5-为数据生成增加规则" class="headerlink" title="8.1.5 为数据生成增加规则"></a>8.1.5 为数据生成增加规则</h4><h4 id="8-1-6-定义场景"><a href="#8-1-6-定义场景" class="headerlink" title="8.1.6 定义场景"></a>8.1.6 定义场景</h4><h4 id="8-1-7-结果"><a href="#8-1-7-结果" class="headerlink" title="8.1.7 结果"></a>8.1.7 结果</h4><p>结果实时写入结果目录中。可以打开.jpg格式文件来实时可视化。</p>
<h4 id="8-1-8-测试"><a href="#8-1-8-测试" class="headerlink" title="8.1.8 测试"></a>8.1.8 测试</h4><blockquote>
<p>Run unit tests: mvn test -DZK_QUORUM=localhost<br>Run a specific method: mvn -Dtest=ClassName#methodName test<br>More to come…</p>
</blockquote>
<h3 id="8-2-性能"><a href="#8-2-性能" class="headerlink" title="8.2 性能"></a>8.2 性能</h3><p>Phoenix通过以下方法来奉行<code>把计算带到离数据近的地方</code>的哲学：</p>
<ul>
<li><p>协处理器<br>在服务端执行操作来最小化服务端和客户端的数据传输</p>
</li>
<li><p>定制的过滤器<br>为了删减数据使之尽可能地靠近源数据并最小化启动代价，Phoenix使用原生的HBase APIs而不是使用Map/Reduce框架</p>
</li>
</ul>
<h4 id="8-2-1-Phoenix对比相近产品"><a href="#8-2-1-Phoenix对比相近产品" class="headerlink" title="8.2.1 Phoenix对比相近产品"></a>8.2.1 Phoenix对比相近产品</h4><h5 id="8-2-1-1-Phoenix-vs-Hive-running-over-HDFS-and-HBase"><a href="#8-2-1-1-Phoenix-vs-Hive-running-over-HDFS-and-HBase" class="headerlink" title="8.2.1.1 Phoenix vs Hive (running over HDFS and HBase)"></a>8.2.1.1 Phoenix vs Hive (running over HDFS and HBase)</h5><p><img src="http://upload-images.jianshu.io/upload_images/1752522-697a95a8cab3a28d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Query: <span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">over</span> <span class="number">10</span>M <span class="keyword">and</span> <span class="number">100</span>M rows. <span class="keyword">Data</span> <span class="keyword">is</span> <span class="number">5</span> narrow columns. <span class="built_in">Number</span> <span class="keyword">of</span> Region Servers: <span class="number">4</span> (HBase <span class="keyword">heap</span>: <span class="number">10</span>GB, Processor: <span class="number">6</span> cores @ <span class="number">3.3</span>GHz Xeon)</div></pre></td></tr></table></figure>
<h5 id="8-2-1-2-Phoenix-vs-Impala-running-over-HBase"><a href="#8-2-1-2-Phoenix-vs-Impala-running-over-HBase" class="headerlink" title="8.2.1.2 Phoenix vs Impala (running over HBase)"></a>8.2.1.2 Phoenix vs Impala (running over HBase)</h5><p><img src="http://upload-images.jianshu.io/upload_images/1752522-38710062c800a26b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line">Query: <span class="keyword">select</span> <span class="keyword">count</span>(<span class="number">1</span>) <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">over</span> <span class="number">1</span>M <span class="keyword">and</span> <span class="number">5</span>M rows. <span class="keyword">Data</span> <span class="keyword">is</span> <span class="number">3</span> narrow columns. <span class="built_in">Number</span> <span class="keyword">of</span> Region <span class="keyword">Server</span>: <span class="number">1</span> (<span class="keyword">Virtual</span> Machine, HBase <span class="keyword">heap</span>: <span class="number">2</span>GB, Processor: <span class="number">2</span> cores @ <span class="number">3.3</span>GHz Xeon)</div></pre></td></tr></table></figure>
<h4 id="8-2-2-Latest-Automated-Performance-Run"><a href="#8-2-2-Latest-Automated-Performance-Run" class="headerlink" title="8.2.2 Latest Automated Performance Run"></a>8.2.2 Latest Automated Performance Run</h4><p><a href="http://phoenix-bin.github.io/client/performance/latest.htm" target="_blank" rel="external">Latest Automated Performance Run</a> | <a href="http://phoenix-bin.github.io/client/performance/" target="_blank" rel="external">Automated Performance Runs History</a></p>
<h4 id="8-2-3-Phoenix1-2性能提升"><a href="#8-2-3-Phoenix1-2性能提升" class="headerlink" title="8.2.3 Phoenix1.2性能提升"></a>8.2.3 Phoenix1.2性能提升</h4><ul>
<li>Essential Column Family</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-c642457642dacd1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<ul>
<li>Skip Scan</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-7c15c329a370c654.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<ul>
<li>Salting</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-9079f69e939c61e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<ul>
<li>Top-N</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-81d30687fe0f32ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<h2 id="9-参考资料"><a href="#9-参考资料" class="headerlink" title="9. 参考资料"></a>9. 参考资料</h2><ul>
<li><a href="http://phoenix.apache.org" target="_blank" rel="external">http://phoenix.apache.org</a></li>
<li><a href="http://phoenix.apache.org/Phoenix-in-15-minutes-or-less.html" target="_blank" rel="external">http://phoenix.apache.org/Phoenix-in-15-minutes-or-less.html</a></li>
<li><a href="http://hadooptutorial.info/apache-phoenix-hbase-an-sql-layer-on-hbase/" target="_blank" rel="external">http://hadooptutorial.info/apache-phoenix-hbase-an-sql-layer-on-hbase/</a></li>
<li><a href="http://www.phoenixframework.org/docs/resources" target="_blank" rel="external">http://www.phoenixframework.org/docs/resources</a></li>
<li><a href="https://en.wikipedia.org/wiki/Apache_Phoenix" target="_blank" rel="external">https://en.wikipedia.org/wiki/Apache_Phoenix</a><br><img src="http://upload-images.jianshu.io/upload_images/1752522-2e4b0e5141927479.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="欢迎关注公众号: FullStackPlan 获取更多干货"></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NoSQL/">NoSQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Phoenix/">Phoenix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大数据/">大数据</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/09/10/机器学习/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          机器学习笔记（持续更新）
        
      </div>
    </a>
  
  
    <a href="/2016/09/02/Hive安装配置文档/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">Hive安装配置文档（含Hive Metastore三种配置方式详解）</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Phoenix概述"><span class="toc-number">1.</span> <span class="toc-text">1. Phoenix概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-历史演进"><span class="toc-number">2.</span> <span class="toc-text">2. 历史演进</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-特性"><span class="toc-number">3.</span> <span class="toc-text">3. 特性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-Transactions-beta-事务"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Transactions (beta)  事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-User-defined-functions-UDFs-用户定义函数"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 User-defined functions(UDFs)  用户定义函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-概述"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-配置"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Secondary-Indexing-二级索引"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 Secondary Indexing  二级索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-Statistics-Collection-统计信息收集"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 Statistics Collection  统计信息收集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-Row-timestamp-时间戳"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 Row timestamp  时间戳</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-Paged-Queries-分页查询"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 Paged Queries  分页查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-Salted-Tables-散步表"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 Salted Tables  散步表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-Skip-Scan-跳跃扫描"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 Skip Scan  跳跃扫描</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-Views-视图"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 Views  视图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-10-Multi-tenancy-多租户"><span class="toc-number">3.10.</span> <span class="toc-text">3.10 Multi tenancy  多租户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-11-Dynamic-Columns-动态列"><span class="toc-number">3.11.</span> <span class="toc-text">3.11 Dynamic Columns  动态列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-12-Bulk-CSV-Data-Loading-大量CSV数据加载"><span class="toc-number">3.12.</span> <span class="toc-text">3.12 Bulk CSV Data Loading  大量CSV数据加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-13-Query-Server-查询服务器"><span class="toc-number">3.13.</span> <span class="toc-text">3.13 Query Server  查询服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-14-Tracing-追踪"><span class="toc-number">3.14.</span> <span class="toc-text">3.14 Tracing  追踪</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-15-Metrics-指标"><span class="toc-number">3.15.</span> <span class="toc-text">3.15 Metrics  指标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-架构和组成"><span class="toc-number">4.</span> <span class="toc-text">4. 架构和组成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-数据存储"><span class="toc-number">5.</span> <span class="toc-text">5. 数据存储</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-对QL的支持"><span class="toc-number">6.</span> <span class="toc-text">6. 对QL的支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-安装部署"><span class="toc-number">7.</span> <span class="toc-text">7. 安装部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-安装预编译的Phoenix"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 安装预编译的Phoenix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-使用Phoenix"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 使用Phoenix</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-命令行"><span class="toc-number">7.2.1.</span> <span class="toc-text">7.2.1 命令行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-客户端"><span class="toc-number">7.2.2.</span> <span class="toc-text">7.2.2 客户端</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-测试"><span class="toc-number">8.</span> <span class="toc-text">8. 测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-Pherf"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 Pherf</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-构建Pherf"><span class="toc-number">8.1.1.</span> <span class="toc-text">8.1.1 构建Pherf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-安装"><span class="toc-number">8.1.2.</span> <span class="toc-text">8.1.2 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-命令示例"><span class="toc-number">8.1.3.</span> <span class="toc-text">8.1.3 命令示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-4-参数"><span class="toc-number">8.1.4.</span> <span class="toc-text">8.1.4 参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-5-为数据生成增加规则"><span class="toc-number">8.1.5.</span> <span class="toc-text">8.1.5 为数据生成增加规则</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-6-定义场景"><span class="toc-number">8.1.6.</span> <span class="toc-text">8.1.6 定义场景</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-7-结果"><span class="toc-number">8.1.7.</span> <span class="toc-text">8.1.7 结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-8-测试"><span class="toc-number">8.1.8.</span> <span class="toc-text">8.1.8 测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-性能"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 性能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-Phoenix对比相近产品"><span class="toc-number">8.2.1.</span> <span class="toc-text">8.2.1 Phoenix对比相近产品</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-1-1-Phoenix-vs-Hive-running-over-HDFS-and-HBase"><span class="toc-number">8.2.1.1.</span> <span class="toc-text">8.2.1.1 Phoenix vs Hive (running over HDFS and HBase)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-2-1-2-Phoenix-vs-Impala-running-over-HBase"><span class="toc-number">8.2.1.2.</span> <span class="toc-text">8.2.1.2 Phoenix vs Impala (running over HBase)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-Latest-Automated-Performance-Run"><span class="toc-number">8.2.2.</span> <span class="toc-text">8.2.2 Latest Automated Performance Run</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-Phoenix1-2性能提升"><span class="toc-number">8.2.3.</span> <span class="toc-text">8.2.3 Phoenix1.2性能提升</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-参考资料"><span class="toc-number">9.</span> <span class="toc-text">9. 参考资料</span></a></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      <div class="row">
	      <p id="copyRightEn">Copyright &copy; 2016 - 2017 LBD All Rights Reserved.</p>
	</div>

      <div class="busuanzi_uv">
      <span id="busuanzi_container_site_uv">
     访客数 <span id="busuanzi_value_site_uv"></span>
     </span> |  
      <span id="busuanzi_container_site_pv">
      访问量 <span id="busuanzi_value_site_pv"></span>
     </span>
      </div>

  </div>
</footer>

<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    
<div style="display: none;">
  <script src="https://s11.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
</div>

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
<script src="/js/bootstrap.js"></script>


  <script src="/js/home.js"></script>



  <script src="/js/dialog.js"></script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            LBD&#39;s Blog
          </div>
          <div class="panel-body">
            Copyright © 2017 LBD All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  

</body>
</html>