<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>大数据基准测试工具tpcx-bb源码分析 | LBD&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  <meta name="keywords" content="大数据TPCx-BB基准测试">
  
  
  
  
  <meta name="description" content="TPCx-BB是大数据基准测试工具,它通过模拟零售商的30个应用场景，执行30个查询来衡量基于Hadoop的大数据系统的包括硬件和软件的性能。其中一些场景还用到了机器学习算法（聚类、线性回归等）。为了更好地了解被测试的系统的性能，需要对TPCx-BB整个测试流程深入了解。本文详细分析了整个TPCx-BB测试工具的源码，希望能够对大家理解TPCx-BB有所帮助。">
<meta name="keywords" content="大数据,TPCx-BB,基准测试">
<meta property="og:type" content="article">
<meta property="og:title" content="大数据基准测试工具TPCx-BB源码分析">
<meta property="og:url" content="http://linbingdong.com/2017/03/11/大数据基准测试工具TPCx-BB源码分析/index.html">
<meta property="og:site_name" content="LBD&#39;s Blog">
<meta property="og:description" content="TPCx-BB是大数据基准测试工具,它通过模拟零售商的30个应用场景，执行30个查询来衡量基于Hadoop的大数据系统的包括硬件和软件的性能。其中一些场景还用到了机器学习算法（聚类、线性回归等）。为了更好地了解被测试的系统的性能，需要对TPCx-BB整个测试流程深入了解。本文详细分析了整个TPCx-BB测试工具的源码，希望能够对大家理解TPCx-BB有所帮助。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://linbingdong.com/2017/03/11/大数据基准测试工具TPCx-BB源码分析/bigBench.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-2e4b0e5141927479.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-03-11T12:33:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="大数据基准测试工具TPCx-BB源码分析">
<meta name="twitter:description" content="TPCx-BB是大数据基准测试工具,它通过模拟零售商的30个应用场景，执行30个查询来衡量基于Hadoop的大数据系统的包括硬件和软件的性能。其中一些场景还用到了机器学习算法（聚类、线性回归等）。为了更好地了解被测试的系统的性能，需要对TPCx-BB整个测试流程深入了解。本文详细分析了整个TPCx-BB测试工具的源码，希望能够对大家理解TPCx-BB有所帮助。">
<meta name="twitter:image" content="http://linbingdong.com/2017/03/11/大数据基准测试工具TPCx-BB源码分析/bigBench.png">
  
    <link rel="alternate" href="/atom.xml" title="LBD&#39;s Blog" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="/css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css">
  

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 margin-top: 0px;" href="#" data-toggle="modal" data-target="#myModal">
                  <img width="62px" height="62px" alt="Hike News" src="/css/images/mylogo.jpg">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="/">首页</a> </li>
                
                  <li> <a class="main-nav-link" href="/archives">归档</a> </li>
                
                  <li> <a class="main-nav-link" href="/categories">分类</a> </li>
                
                  <li> <a class="main-nav-link" href="/tags">标签</a> </li>
                
                  <li> <a class="main-nav-link" href="/about">关于</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder>
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(无标题)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-大数据基准测试工具TPCx-BB源码分析" style="width: 75%; float:left;" class="article article-type-post" itemscope itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      大数据基准测试工具TPCx-BB源码分析
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/03/11/大数据基准测试工具TPCx-BB源码分析/" class="article-date">
	  <time datetime="2017-03-11T12:33:42.000Z" itemprop="datePublished">2017-03-11</time>
	</a>

      
    <a class="article-category-link" href="/categories/源码分析/">源码分析</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		阅读量<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>TPCx-BB是大数据基准测试工具,它通过模拟零售商的30个应用场景，执行30个查询来衡量基于Hadoop的大数据系统的包括硬件和软件的性能。其中一些场景还用到了机器学习算法（聚类、线性回归等）。为了更好地了解被测试的系统的性能，需要对TPCx-BB整个测试流程深入了解。本文详细分析了整个TPCx-BB测试工具的源码，希望能够对大家理解TPCx-BB有所帮助。</p>
<a id="more"></a>

<h2 id="代码结构"><a href="#代码结构" class="headerlink" title="代码结构"></a>代码结构</h2><p>主目录（<code>$BENCH_MARK_HOME</code>）下有：</p>
<ul>
<li>bin</li>
<li>conf</li>
<li>data-generator</li>
<li>engines</li>
<li>tools</li>
</ul>
<p>几个子目录。</p>
<p><strong>bin</strong>下有几个 <code>module</code> ,是执行时需要用到的脚本：<strong>bigBench</strong>、cleanLogs、logEnvInformation、<strong>runBenchmark</strong>、zipLogs等</p>
<p><strong>conf</strong>下有两个配置文件：<code>bigBench.properties</code> 和 <code>userSettings.conf</code></p>
<p><code>bigBench.properties</code> 主要设置 <code>workload</code>（执行的benchmarkPhases）和 <code>power_test_0</code>（<code>POWER_TEST</code> 阶段需要执行的SQL查询）</p>
<p>默认 <code>workload</code> ：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">workload=CLEAN_ALL,ENGINE_VALIDATION_DATA_GENERATION,ENGINE_VALIDATION_LOAD_TEST,ENGINE_VALIDATION_POWER_TEST,ENGINE_VALIDATION_RESULT_VALIDATION,CLEAN_DATA,DATA_GENERATION,BENCHMARK_START,LOAD_TEST,POWER_TEST,THROUGHPUT_TEST_1,BENCHMARK_STOP,VALIDATE_POWER_TEST,VALIDATE_THROUGHPUT_TEST_1</span><br></pre></td></tr></table></figure>

<p>默认 <code>power_test_0</code> ：<code>1-30</code></p>
<p><code>userSetting.conf</code> 是一些基本设置，包括JAVA environment 、default settings for benchmark（database、engine、map_tasks、scale_factor …）、HADOOP environment、<br>HDFS config and paths、Hadoop data generation options(DFS_REPLICATION、HADOOP_JVM_ENV…)</p>
<p><strong>data-generator</strong>下是跟数据生成相关的脚本及配置文件。详细内容在下面介绍。</p>
<p><strong>engines</strong>下是TPCx-BB支持的4种引擎：biginsights、hive、impala、spark_sql。默认引擎为hive。实际上，只有hive目录下不为空，其他三个目录下均为空，估计是现在还未完善。</p>
<p><strong>tools</strong>下有两个jar包：<code>HadoopClusterExec.jar</code> 和 <code>RunBigBench.jar</code> 。其中 <code>RunBigBench.jar</code> 是执行TPCx-BB测试的一个非常重要的文件，大部分程序都在该jar包内。</p>
<h2 id="数据生成"><a href="#数据生成" class="headerlink" title="数据生成"></a>数据生成</h2><p>数据生成相关程序和配置都在 <code>data-generator</code> 目录下。该目录下有一个 <code>pdgf.jar</code> 包和 <code>config、dicts、extlib</code> 三个子目录。</p>
<p><strong>pdgf.jar</strong>是数据生成的Java程序，代码量很大。config下有两个配置文件：<code>bigbench-generation.xml</code> 和 <code>bigbench-schema.xml</code> 。</p>
<p><code>bigbench-generation.xml</code> 主要设置生成的原始数据（不是数据库表）包含哪几张表、每张表的表名以及表输出的目录、表文件的后缀、分隔符、字符编码等。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">schema</span> <span class="attr">name</span>=<span class="string">"default"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">tables</span>&gt;</span>	</span><br><span class="line">		<span class="comment">&lt;!-- not refreshed tables --&gt;</span>	</span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- tables not used in benchmark, but some tables have references to them. not refreshed. Kept for legacy reasons  --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"income_band"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"reason"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"ship_mode"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"web_site"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span>		</span><br><span class="line">			<span class="comment">&lt;!-- /tables not used in benchmark  --&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- Static tables (fixed small size, generated only on node 1, skipped on others, not generated during refresh) --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"date_dim"</span> <span class="attr">static</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"time_dim"</span> <span class="attr">static</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"customer_demographics"</span> <span class="attr">static</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"household_demographics"</span> <span class="attr">static</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- /static tables --&gt;</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- "normal" tables. split over all nodes. not generated during refresh --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"store"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"warehouse"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"promotion"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"web_page"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- /"normal" tables.--&gt;</span></span><br><span class="line">			</span><br><span class="line">		<span class="comment">&lt;!-- /not refreshed tables --&gt;</span>	</span><br><span class="line">			</span><br><span class="line">			<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			refreshed tables. Generated on all nodes. </span></span><br><span class="line"><span class="comment">			Refresh tables generate extra data during refresh (e.g. add new data to the existing tables)</span></span><br><span class="line"><span class="comment">			In "normal"-Phase  generate table rows:  [0,REFRESH_PERCENTAGE*Table.Size]; </span></span><br><span class="line"><span class="comment">			In "refresh"-Phase generate table rows:  [REFRESH_PERCENTAGE*Table.Size+1, Table.Size] </span></span><br><span class="line"><span class="comment">			.Has effect only if  $&#123;REFRESH_SYSTEM_ENABLED&#125;==1. </span></span><br><span class="line"><span class="comment">			--&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">table</span> <span class="attr">name</span>=<span class="string">"customer"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">scheduler</span> <span class="attr">name</span>=<span class="string">"DefaultScheduler"</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">partitioner</span></span></span><br><span class="line"><span class="tag">						<span class="attr">name</span>=<span class="string">"pdgf.core.dataGenerator.scheduler.TemplatePartitioner"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">prePartition</span>&gt;</span>&lt;![CDATA[</span><br><span class="line">					if($&#123;REFRESH_SYSTEM_ENABLED&#125;&gt;0)&#123;</span><br><span class="line">						int tableID = table.getTableID();</span><br><span class="line">						int timeID = 0;</span><br><span class="line">						long lastTableRow=table.getSize()-1;</span><br><span class="line">						long rowStart;</span><br><span class="line">						long rowStop;</span><br><span class="line">						boolean exclude=false;</span><br><span class="line">						long refreshRows=table.getSize()*(1.0-$&#123;REFRESH_PERCENTAGE&#125;);</span><br><span class="line">						if($&#123;REFRESH_PHASE&#125;&gt;0)&#123;</span><br><span class="line">							//Refresh part</span><br><span class="line">							rowStart = lastTableRow - refreshRows +1;</span><br><span class="line">							rowStop  = lastTableRow;</span><br><span class="line">							if(refreshRows&lt;=0)&#123;</span><br><span class="line">								exclude=true;</span><br><span class="line">							&#125;</span><br><span class="line">							</span><br><span class="line">						&#125;else&#123;</span><br><span class="line">							//"normal" part</span><br><span class="line">							rowStart = 0;</span><br><span class="line">							rowStop = lastTableRow - refreshRows;</span><br><span class="line">						&#125;</span><br><span class="line">						return new pdgf.core.dataGenerator.scheduler.Partition(tableID, timeID,rowStart,rowStop,exclude);</span><br><span class="line">					&#125;else&#123;</span><br><span class="line">						//DEFAULT</span><br><span class="line">						return getParentPartitioner().getDefaultPrePartition(project, table);				</span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">					]]&gt;<span class="tag">&lt;/<span class="name">prePartition</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;/<span class="name">partitioner</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">scheduler</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">output</span> <span class="attr">name</span>=<span class="string">"SplitFileOutputWrapper"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- DEFAULT output for all Tables, if no table specific output is specified--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">output</span> <span class="attr">name</span>=<span class="string">"CSVRowOutput"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">fileTemplate</span>&gt;</span>&lt;![CDATA[outputDir + table.getName() +(nodeCount!=1?"_"+pdgf.util.StaticHelper.zeroPaddedNumber(nodeNumber,nodeCount):"")+ fileEnding]]&gt;<span class="tag">&lt;/<span class="name">fileTemplate</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDir</span>&gt;</span>output/<span class="tag">&lt;/<span class="name">outputDir</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">fileEnding</span>&gt;</span>.dat<span class="tag">&lt;/<span class="name">fileEnding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">delimiter</span>&gt;</span>|<span class="tag">&lt;/<span class="name">delimiter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">sortByRowID</span>&gt;</span>true<span class="tag">&lt;/<span class="name">sortByRowID</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">output</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">output</span> <span class="attr">name</span>=<span class="string">"StatisticsOutput"</span> <span class="attr">active</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">size</span>&gt;</span>$&#123;item_size&#125;<span class="tag">&lt;/<span class="name">size</span>&gt;</span><span class="comment">&lt;!-- a counter per item .. initialize later--&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">fileTemplate</span>&gt;</span>&lt;![CDATA[outputDir + table.getName()+"_audit" +(nodeCount!=1?"_"+pdgf.util.StaticHelper.zeroPaddedNumber(nodeNumber,nodeCount):"")+ fileEnding]]&gt;<span class="tag">&lt;/<span class="name">fileTemplate</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">outputDir</span>&gt;</span>output/<span class="tag">&lt;/<span class="name">outputDir</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">fileEnding</span>&gt;</span>.csv<span class="tag">&lt;/<span class="name">fileEnding</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">delimiter</span>&gt;</span>,<span class="tag">&lt;/<span class="name">delimiter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span>&gt;</span><span class="comment">&lt;!--"" + pdgf.util.Constants.DEFAULT_LINESEPARATOR--&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>bigbench-schema.xml</code> 设置了很多参数，有跟表的规模有关的，比如每张表的大小（记录的条数）;绝大多数是跟表的字段有关的，比如时间的起始、结束、性别比例、结婚比例、指标的上下界等。还具体定义了每个字段是怎么生成的，以及限制条件。示例如下：</p>
<p>生成的数据大小由 <code>SCALE_FACTOR（-f）</code> 决定。如 <code>-f 1</code>，则生成的数据总大小约为1G；<code>-f 100</code>，则生成的数据总大小约为100G。那么<code>SCALE_FACTOR（-f）</code> 是怎么精确控制生成的数据的大小呢？</p>
<p>原因是 <code>SCALE_FACTOR（-f）</code> 决定了每张表的记录数。如下，<code>customer</code> 表的记录数为 <code>100000.0d * ${SF_sqrt}</code>，即如果 <code>-f 1</code> 则 <code>customer</code> 表的记录数为 <code>100000*sqrt(1)= 10万条</code> ;如果 <code>-f 100</code> 则 <code>customer</code> 表的记录数为 <code>100000*sqrt(100)= 100万条</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;customer_size&#125;"</span> <span class="attr">type</span>=<span class="string">"long"</span>&gt;</span>100000.0d * $&#123;SF_sqrt&#125;<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;DIMENSION_TABLES_START_DAY&#125;"</span> <span class="attr">type</span>=<span class="string">"datetime"</span>&gt;</span>2000-01-03 00:00:00<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;DIMENSION_TABLES_END_DAY&#125;"</span> <span class="attr">type</span>=<span class="string">"datetime"</span>&gt;</span>2004-01-05 00:00:00<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;gender_likelihood&#125;"</span> <span class="attr">type</span>=<span class="string">"double"</span>&gt;</span>0.5<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;married_likelihood&#125;"</span> <span class="attr">type</span>=<span class="string">"double"</span>&gt;</span>0.3<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;WP_LINK_MIN&#125;"</span> <span class="attr">type</span>=<span class="string">"double"</span>&gt;</span>2<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"$&#123;WP_LINK_MAX&#125;"</span> <span class="attr">type</span>=<span class="string">"double"</span>&gt;</span>25<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"d_date"</span> <span class="attr">size</span>=<span class="string">"13"</span> <span class="attr">type</span>=<span class="string">"CHAR"</span> <span class="attr">primary</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">gen_DateTime</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">disableRng</span>&gt;</span>true<span class="tag">&lt;/<span class="name">disableRng</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">useFixedStepSize</span>&gt;</span>true<span class="tag">&lt;/<span class="name">useFixedStepSize</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">startDate</span>&gt;</span>$&#123;date_dim_begin_date&#125;<span class="tag">&lt;/<span class="name">startDate</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">endDate</span>&gt;</span>$&#123;date_dim_end_date&#125;<span class="tag">&lt;/<span class="name">endDate</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">outputFormat</span>&gt;</span>yyyy-MM-dd<span class="tag">&lt;/<span class="name">outputFormat</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">gen_DateTime</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"t_time_id"</span> <span class="attr">size</span>=<span class="string">"16"</span> <span class="attr">type</span>=<span class="string">"CHAR"</span> <span class="attr">primary</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">gen_ConvertNumberToString</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">gen_Id</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">size</span>&gt;</span>16.0<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">characters</span>&gt;</span>ABCDEFGHIJKLMNOPQRSTUVWXYZ<span class="tag">&lt;/<span class="name">characters</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">gen_ConvertNumberToString</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"cd_dep_employed_count"</span> <span class="attr">size</span>=<span class="string">"10"</span> <span class="attr">type</span>=<span class="string">"INTEGER"</span> <span class="attr">primary</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">gen_Null</span> <span class="attr">probability</span>=<span class="string">"$&#123;NULL_CHANCE&#125;"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">gen_WeightedListItem</span> <span class="attr">filename</span>=<span class="string">"dicts/bigbench/ds-genProbabilities.txt"</span> <span class="attr">list</span>=<span class="string">"dependent_count"</span> <span class="attr">valueColumn</span>=<span class="string">"0"</span> <span class="attr">weightColumn</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">gen_Null</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">field</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>dicts</strong>下有city.dict、country.dict、male.dict、female.dict、state.dict、mail_provider.dict等字典文件，表里每一条记录的各个字段应该是从这些字典里生成的。</p>
<p><strong>extlib</strong>下是引用的外部程序jar包。有 <code>lucene-core-4.9.0.jar</code>、<code>commons-net-3.3.jar</code>、<code>xml-apis.jar</code>和<code>log4j-1.2.15.jar</code>等</p>
<p><strong>总结</strong>：</p>
<p><code>pdgf.jar</code>根据<code>bigbench-generation.xml</code> 和 <code>bigbench-schema.xml</code>两个文件里的配置（表名、字段名、表的记录条数、每个字段生成的规则），从 <code>dicts</code> 目录下对应的 <code>.dict</code><br>文件获取表中每一条记录、每个字段的值，生成原始数据。</p>
<p><code>customer</code> 表里的某条记录如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 AAAAAAAAAAAAAAAA 1824793 3203 2555 28776 14690 Ms. Marisa Harrington N 17 4 1988 UNITED ARAB EMIRATES RRCyuY3XfE3a Marisa.Harrington@lawyer.com   gdMmGdU9</span><br></pre></td></tr></table></figure>

<p>如果执行 TPCx-BB 测试时指定 <code>-f 1（SCALE_FACTOR = 1）</code> 则最终生成的原始数据总大小约为 1G(977M+8.6M)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@node-20-100 ~]<span class="comment"># hdfs dfs -du -h /user/root/benchmarks/bigbench/data</span></span><br><span class="line">12.7 M   38.0 M   /user/root/benchmarks/bigbench/data/customer</span><br><span class="line">5.1 M    15.4 M   /user/root/benchmarks/bigbench/data/customer_address</span><br><span class="line">74.2 M   222.5 M  /user/root/benchmarks/bigbench/data/customer_demographics</span><br><span class="line">14.7 M   44.0 M   /user/root/benchmarks/bigbench/data/date_dim</span><br><span class="line">151.5 K  454.4 K  /user/root/benchmarks/bigbench/data/household_demographics</span><br><span class="line">327      981      /user/root/benchmarks/bigbench/data/income_band</span><br><span class="line">405.3 M  1.2 G    /user/root/benchmarks/bigbench/data/inventory</span><br><span class="line">6.5 M    19.5 M   /user/root/benchmarks/bigbench/data/item</span><br><span class="line">4.0 M    12.0 M   /user/root/benchmarks/bigbench/data/item_marketprices</span><br><span class="line">53.7 M   161.2 M  /user/root/benchmarks/bigbench/data/product_reviews</span><br><span class="line">45.3 K   135.9 K  /user/root/benchmarks/bigbench/data/promotion</span><br><span class="line">3.0 K    9.1 K    /user/root/benchmarks/bigbench/data/reason</span><br><span class="line">1.2 K    3.6 K    /user/root/benchmarks/bigbench/data/ship_mode</span><br><span class="line">3.3 K    9.9 K    /user/root/benchmarks/bigbench/data/store</span><br><span class="line">4.1 M    12.4 M   /user/root/benchmarks/bigbench/data/store_returns</span><br><span class="line">88.5 M   265.4 M  /user/root/benchmarks/bigbench/data/store_sales</span><br><span class="line">4.9 M    14.6 M   /user/root/benchmarks/bigbench/data/time_dim</span><br><span class="line">584      1.7 K    /user/root/benchmarks/bigbench/data/warehouse</span><br><span class="line">170.4 M  511.3 M  /user/root/benchmarks/bigbench/data/web_clickstreams</span><br><span class="line">7.9 K    23.6 K   /user/root/benchmarks/bigbench/data/web_page</span><br><span class="line">5.1 M    15.4 M   /user/root/benchmarks/bigbench/data/web_returns</span><br><span class="line">127.6 M  382.8 M  /user/root/benchmarks/bigbench/data/web_sales</span><br><span class="line">8.6 K    25.9 K   /user/root/benchmarks/bigbench/data/web_site</span><br></pre></td></tr></table></figure>

<h2 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h2><p>要执行TPCx-BB测试，首先需要切换到TPCx-BB源程序的目录下，然后进入bin目录，执行以下语句：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bigBench runBenchmark <span class="_">-f</span> 1 -m 8 <span class="_">-s</span> 2 -j 5</span><br></pre></td></tr></table></figure>

<p>其中，-f、-m、-s、-j都是参数，用户可根据集群的性能以及自己的需求来设置。如果不指定，则使用默认值，默认值在 <code>conf</code> 目录下的 <code>userSetting.conf</code> 文件指定，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> BIG_BENCH_DEFAULT_DATABASE=<span class="string">"bigbench"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DEFAULT_ENGINE=<span class="string">"hive"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DEFAULT_MAP_TASKS=<span class="string">"80"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DEFAULT_SCALE_FACTOR=<span class="string">"1000"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DEFAULT_NUMBER_OF_PARALLEL_STREAMS=<span class="string">"2"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DEFAULT_BENCHMARK_PHASE=<span class="string">"run_query"</span></span><br></pre></td></tr></table></figure>

<p>默认 <code>MAP_TASKS</code> 为 <code>80（-m 80）</code>、<code>SCALE_FACTOR</code> 为 <code>1000（-f 1000）</code>、<code>NUMBER_OF_PARALLEL_STREAMS</code> 为 <code>2（-s 2）</code>。</p>
<p>所有可选参数及其意义如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">General options:</span><br><span class="line"><span class="_">-d</span>  使用的数据库 (默认: <span class="variable">$BIG_BENCH_DEFAULT_DATABASE</span> -&gt; bigbench)</span><br><span class="line"><span class="_">-e</span>  使用的引擎 (默认: <span class="variable">$BIG_BENCH_DEFAULT_ENGINE</span> -&gt; hive)</span><br><span class="line"><span class="_">-f</span>  数据集的规模因子（scale factor） (默认: <span class="variable">$BIG_BENCH_DEFAULT_SCALE_FACTOR</span> -&gt; 1000)</span><br><span class="line">-h  显示帮助</span><br><span class="line">-m  数据生成的`map tasks`数 (default: <span class="variable">$BIG_BENCH_DEFAULT_MAP_TASKS</span>)<span class="string">"</span></span><br><span class="line"><span class="string">-s  并行的`stream`数 (默认: <span class="variable">$BIG_BENCH_DEFAULT_NUMBER_OF_PARALLEL_STREAMS</span> -&gt; 2)</span></span><br><span class="line"><span class="string">Driver specific options:</span></span><br><span class="line"><span class="string">-a  伪装模式执行</span></span><br><span class="line"><span class="string">-b  执行期间将调用的bash脚本在标准输出中打印出来</span></span><br><span class="line"><span class="string">-i  指定需要执行的阶段 (详情见<span class="variable">$BIG_BENCH_CONF_DIR</span>/bigBench.properties)</span></span><br><span class="line"><span class="string">-j  指定需要执行的查询 (默认：1-30共30个查询均执行)"</span></span><br><span class="line">-U  解锁专家模式</span><br></pre></td></tr></table></figure>

<p>若指定了<code>-U</code>,即解锁了专家模式，则：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"EXPERT MODE ACTIVE"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"WARNING - INTERNAL USE ONLY:"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Only set manually if you know what you are doing!"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Ignoring them is probably the best solution"</span> </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Running individual modules:"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Usage: `basename <span class="variable">$0</span>` module [options]"</span></span><br><span class="line">-D  指定需要debug的查询部分. 大部分查询都只有一个单独的部分</span><br><span class="line">-p  需要执行的benchmark phase (默认: <span class="variable">$BIG_BENCH_DEFAULT_BENCHMARK_PHASE</span> -&gt; run_query)<span class="string">"</span></span><br><span class="line"><span class="string">-q  指定需要执行哪个查询</span></span><br><span class="line"><span class="string">-t  指定执行查询时的stream数</span></span><br><span class="line"><span class="string">-v  metastore population的sql脚本 (默认: <span class="variable">$&#123;USER_POPULATE_FILE:-"$BIG_BENCH_POPULATION_DIR/hiveCreateLoad.sql"&#125;</span>)"</span></span><br><span class="line">-w  metastore refresh的sql脚本 (默认: <span class="variable">$&#123;USER_REFRESH_FILE:-"$BIG_BENCH_REFRESH_DIR/hiveRefreshCreateLoad.sql"&#125;</span>)<span class="string">"</span></span><br><span class="line"><span class="string">-y  含额外的用户自定义查询参数的文件 (global: <span class="variable">$BIG_BENCH_ENGINE_CONF_DIR</span>/queryParameters.sql)"</span></span><br><span class="line">-z  含额外的用户自定义引擎设置的文件 (global: <span class="variable">$BIG_BENCH_ENGINE_CONF_DIR</span>/engineSettings.sql)<span class="string">"</span></span><br><span class="line"><span class="string">List of available modules:</span></span><br><span class="line"><span class="string">    <span class="variable">$BIG_BENCH_ENGINE_BIN_DIR</span></span></span><br></pre></td></tr></table></figure>

<p>回到刚刚执行TPCx-BB测试的语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">./bigBench runBenchmark -f 1 -m 8 -s 2 -j 5</span><br></pre></td></tr></table></figure>

<h3 id="bigBench"><a href="#bigBench" class="headerlink" title="bigBench"></a>bigBench</h3><p><code>bigBench</code>是主脚本，<code>runBenchmark</code>是module。</p>
<p><code>bigBench</code> 里设置了很多环境变量，因为后面调用 <code>runBigBench.jar</code> 的时候需要在Java程序里读取这些环境变量。</p>
<p><code>bigBench</code> 前面都是在做一些基本工作，如设置环境变量、解析用户输入参数、赋予文件权限、设置路径等等。到最后一步调用 <code>runBenchmark</code> 的 <code>runModule()</code> 方法：</p>
<p>1.设置基本路径</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> BIG_BENCH_VERSION=<span class="string">"1.0"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_BIN_DIR=<span class="string">"<span class="variable">$BIG_BENCH_HOME</span>/bin"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_CONF_DIR=<span class="string">"<span class="variable">$BIG_BENCH_HOME</span>/conf"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DATA_GENERATOR_DIR=<span class="string">"<span class="variable">$BIG_BENCH_HOME</span>/data-generator"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_TOOLS_DIR=<span class="string">"<span class="variable">$BIG_BENCH_HOME</span>/tools"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_LOGS_DIR=<span class="string">"<span class="variable">$BIG_BENCH_HOME</span>/logs"</span></span><br></pre></td></tr></table></figure>

<p>2.指定 <code>core-site.xml</code> 和 <code>hdfs-site.xml</code> 的路径</p>
<p>数据生成时要用到Hadoop集群，生成在hdfs上</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> BIG_BENCH_DATAGEN_CORE_SITE=<span class="string">"<span class="variable">$BIG_BENCH_HADOOP_CONF</span>/core-site.xml"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DATAGEN_HDFS_SITE=<span class="string">"<span class="variable">$BIG_BENCH_HADOOP_CONF</span>/hdfs-site.xml"</span></span><br></pre></td></tr></table></figure>

<p>3.赋予整个包下所有可执行文件权限（.sh/.jar/.py）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find <span class="string">"<span class="variable">$BIG_BENCH_HOME</span>"</span> -name <span class="string">'*.sh'</span> -exec chmod 755 &#123;&#125; +</span><br><span class="line">find <span class="string">"<span class="variable">$BIG_BENCH_HOME</span>"</span> -name <span class="string">'*.jar'</span> -exec chmod 755 &#123;&#125; +</span><br><span class="line">find <span class="string">"<span class="variable">$BIG_BENCH_HOME</span>"</span> -name <span class="string">'*.py'</span> -exec chmod 755 &#123;&#125; +</span><br></pre></td></tr></table></figure>


<p>4.设置 <code>userSetting.conf</code> 的路径并 <code>source</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">USER_SETTINGS=<span class="string">"<span class="variable">$BIG_BENCH_CONF_DIR</span>/userSettings.conf"</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"<span class="variable">$USER_SETTINGS</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"User settings file <span class="variable">$USER_SETTINGS</span> not found"</span></span><br><span class="line">	 <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	 <span class="built_in">source</span> <span class="string">"<span class="variable">$USER_SETTINGS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>


<p>5.解析输入参数和选项并根据选项的内容作设置</p>
<p>第一个参数必须是<code>module_name</code></p>
<p>如果没有输入参数或者第一个参数以”-“开头，说明用户没有输入需要运行的module。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [[ <span class="variable">$#</span> <span class="_">-eq</span> 0 || <span class="string">"`echo "</span><span class="variable">$1</span><span class="string">" | cut -c1`"</span> = <span class="string">"-"</span> ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">export</span> MODULE_NAME=<span class="string">""</span></span><br><span class="line">	 SHOW_HELP=<span class="string">"1"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	 <span class="built_in">export</span> MODULE_NAME=<span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">	 <span class="built_in">shift</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">export</span> LIST_OF_USER_OPTIONS=<span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>


<p>解析用户输入的参数</p>
<p>根据用户输入的参数来设置环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">getopts</span> <span class="string">":d:D:e:f:hm:p:q:s:t:Uv:w:y:z:abi:j:"</span> OPT; <span class="keyword">do</span></span><br><span class="line">   <span class="keyword">case</span> <span class="string">"<span class="variable">$OPT</span>"</span> <span class="keyword">in</span></span><br><span class="line">    <span class="comment"># script options</span></span><br><span class="line">    d)</span><br><span class="line">      <span class="comment">#echo "-d was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_DATABASE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    D)</span><br><span class="line">      <span class="comment">#echo "-D was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      DEBUG_QUERY_PART=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    e)</span><br><span class="line">      <span class="comment">#echo "-e was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_ENGINE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    f)</span><br><span class="line">      <span class="comment">#echo "-f was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_SCALE_FACTOR=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    h)</span><br><span class="line">      <span class="comment">#echo "-h was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      SHOW_HELP=<span class="string">"1"</span></span><br><span class="line">    ;;</span><br><span class="line">    m)</span><br><span class="line">      <span class="comment">#echo "-m was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_MAP_TASKS=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    p)</span><br><span class="line">      <span class="comment">#echo "-p was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_BENCHMARK_PHASE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    q)</span><br><span class="line">      <span class="comment">#echo "-q was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      QUERY_NUMBER=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    s)</span><br><span class="line">      <span class="comment">#echo "-t was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_NUMBER_OF_PARALLEL_STREAMS=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    t)</span><br><span class="line">      <span class="comment">#echo "-s was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_STREAM_NUMBER=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    U)</span><br><span class="line">      <span class="comment">#echo "-U was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_EXPERT_MODE=<span class="string">"1"</span></span><br><span class="line">    ;;</span><br><span class="line">    v)</span><br><span class="line">      <span class="comment">#echo "-v was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_POPULATE_FILE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    w)</span><br><span class="line">      <span class="comment">#echo "-w was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_REFRESH_FILE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    y)</span><br><span class="line">      <span class="comment">#echo "-y was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_QUERY_PARAMS_FILE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    z)</span><br><span class="line">      <span class="comment">#echo "-z was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      USER_ENGINE_SETTINGS_FILE=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    <span class="comment"># driver options</span></span><br><span class="line">    a)</span><br><span class="line">      <span class="comment">#echo "-a was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      <span class="built_in">export</span> USER_PRETEND_MODE=<span class="string">"1"</span></span><br><span class="line">    ;;</span><br><span class="line">    b)</span><br><span class="line">      <span class="comment">#echo "-b was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      <span class="built_in">export</span> USER_PRINT_STD_OUT=<span class="string">"1"</span></span><br><span class="line">    ;;</span><br><span class="line">    i)</span><br><span class="line">      <span class="comment">#echo "-i was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      <span class="built_in">export</span> USER_DRIVER_WORKLOAD=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    j)</span><br><span class="line">      <span class="comment">#echo "-j was triggered, Parameter: $OPTARG" &gt;&amp;2</span></span><br><span class="line">      <span class="built_in">export</span> USER_DRIVER_QUERIES_TO_RUN=<span class="string">"<span class="variable">$OPTARG</span>"</span></span><br><span class="line">    ;;</span><br><span class="line">    \?)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"Invalid option: -<span class="variable">$OPTARG</span>"</span> &gt;&amp;2</span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">    ;;</span><br><span class="line">    :)</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">"Option -<span class="variable">$OPTARG</span> requires an argument."</span> &gt;&amp;2</span><br><span class="line">      <span class="built_in">exit</span> 1</span><br><span class="line">  ;;</span><br><span class="line">  <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>


<p>6.设置全局变量</p>
<p>如果用户指定了某个参数的值，则采用该值，否则使用默认值。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> BIG_BENCH_EXPERT_MODE=<span class="string">"<span class="variable">$&#123;USER_EXPERT_MODE:-"0"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> SHOW_HELP=<span class="string">"<span class="variable">$&#123;SHOW_HELP:-"0"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_DATABASE=<span class="string">"<span class="variable">$&#123;USER_DATABASE:-"$BIG_BENCH_DEFAULT_DATABASE"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_ENGINE=<span class="string">"<span class="variable">$&#123;USER_ENGINE:-"$BIG_BENCH_DEFAULT_ENGINE"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_MAP_TASKS=<span class="string">"<span class="variable">$&#123;USER_MAP_TASKS:-"$BIG_BENCH_DEFAULT_MAP_TASKS"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_SCALE_FACTOR=<span class="string">"<span class="variable">$&#123;USER_SCALE_FACTOR:-"$BIG_BENCH_DEFAULT_SCALE_FACTOR"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_NUMBER_OF_PARALLEL_STREAMS=<span class="string">"<span class="variable">$&#123;USER_NUMBER_OF_PARALLEL_STREAMS:-"$BIG_BENCH_DEFAULT_NUMBER_OF_PARALLEL_STREAMS"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_BENCHMARK_PHASE=<span class="string">"<span class="variable">$&#123;USER_BENCHMARK_PHASE:-"$BIG_BENCH_DEFAULT_BENCHMARK_PHASE"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_STREAM_NUMBER=<span class="string">"<span class="variable">$&#123;USER_STREAM_NUMBER:-"0"&#125;</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_ENGINE_DIR=<span class="string">"<span class="variable">$BIG_BENCH_HOME</span>/engines/<span class="variable">$BIG_BENCH_ENGINE</span>"</span></span><br><span class="line"><span class="built_in">export</span> BIG_BENCH_ENGINE_CONF_DIR=<span class="string">"<span class="variable">$BIG_BENCH_ENGINE_DIR</span>/conf"</span></span><br></pre></td></tr></table></figure>


<p>7.检测 -s -m -f -j的选项是否为数字</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ -n <span class="string">"`echo "</span><span class="variable">$BIG_BENCH_MAP_TASKS</span><span class="string">" | sed -e 's/[0-9]*//g'`"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"<span class="variable">$BIG_BENCH_MAP_TASKS</span> is not a number"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"`echo "</span><span class="variable">$BIG_BENCH_SCALE_FACTOR</span><span class="string">" | sed -e 's/[0-9]*//g'`"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"<span class="variable">$BIG_BENCH_SCALE_FACTOR</span> is not a number"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"`echo "</span><span class="variable">$BIG_BENCH_NUMBER_OF_PARALLEL_STREAMS</span><span class="string">" | sed -e 's/[0-9]*//g'`"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"<span class="variable">$BIG_BENCH_NUMBER_OF_PARALLEL_STREAMS</span> is not a number"</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"`echo "</span><span class="variable">$BIG_BENCH_STREAM_NUMBER</span><span class="string">" | sed -e 's/[0-9]*//g'`"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"<span class="variable">$BIG_BENCH_STREAM_NUMBER</span> is not a number"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>8.检查引擎是否存在</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$BIG_BENCH_ENGINE_DIR</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"Engine directory <span class="variable">$BIG_BENCH_ENGINE_DIR</span> not found. Aborting script..."</span></span><br><span class="line">	 <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="_">-d</span> <span class="string">"<span class="variable">$BIG_BENCH_ENGINE_CONF_DIR</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Engine configuration directory <span class="variable">$BIG_BENCH_ENGINE_CONF_DIR</span> not found. Aborting script..."</span></span><br><span class="line">	 <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>9.设置 <code>engineSetting.conf</code> 路径并 <code>source</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENGINE_SETTINGS=<span class="string">"<span class="variable">$BIG_BENCH_ENGINE_CONF_DIR</span>/engineSettings.conf"</span></span><br><span class="line"><span class="keyword">if</span> [ ! <span class="_">-f</span> <span class="string">"<span class="variable">$ENGINE_SETTINGS</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"Engine settings file <span class="variable">$ENGINE_SETTINGS</span> not found"</span></span><br><span class="line">	 <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	 <span class="built_in">source</span> <span class="string">"<span class="variable">$ENGINE_SETTINGS</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>10.检查module是否存在</p>
<p>当输入某个module时，系统会先到<code>$BIG_BENCH_ENGINE_BIN_DIR/</code>目录下去找该module是否存在，如果存在，就<code>source &quot;$MODULE&quot;</code>；如果该目录下不存在指定的module，再到<code>export MODULE=&quot;$BIG_BENCH_BIN_DIR/&quot;</code>目录下找该module，如果存在，就<code>source &quot;$MODULE&quot;</code>；否则，输出<code>Module $MODULE not found, aborting script.</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> MODULE=<span class="string">"<span class="variable">$BIG_BENCH_ENGINE_BIN_DIR</span>/<span class="variable">$MODULE_NAME</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="_">-f</span> <span class="string">"<span class="variable">$MODULE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">source</span> <span class="string">"<span class="variable">$MODULE</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	 <span class="built_in">export</span> MODULE=<span class="string">"<span class="variable">$BIG_BENCH_BIN_DIR</span>/<span class="variable">$MODULE_NAME</span>"</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="_">-f</span> <span class="string">"<span class="variable">$MODULE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">source</span> <span class="string">"<span class="variable">$MODULE</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"Module <span class="variable">$MODULE</span> not found, aborting script."</span></span><br><span class="line">	 <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>11.检查module里的runModule（）、helpModule ( )、runEngineCmd()方法是否有定义</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MODULE_RUN_METHOD=<span class="string">"runModule"</span></span><br><span class="line"><span class="keyword">if</span> ! <span class="built_in">declare</span> -F <span class="string">"<span class="variable">$MODULE_RUN_METHOD</span>"</span> &gt; /dev/null 2&gt;&amp;1</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	 <span class="built_in">echo</span> <span class="string">"<span class="variable">$MODULE_RUN_METHOD</span> was not implemented, aborting script"</span></span><br><span class="line">	 <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p>12.运行<code>module</code></p>
<p>如果module是runBenchmark，执行<br><code>runCmdWithErrorCheck &quot;$MODULE_RUN_METHOD&quot;</code><br>也就是<br><code>runCmdWithErrorCheck runModule（）</code></p>
<p><strong>由上可以看出，bigBench脚本主要执行一些如设置环境变量、赋予权限、检查并解析输入参数等基础工作，最终调用<code>runBenchmark</code>的<code>runModule()</code>方法继续往下执行。</strong></p>
<h3 id="runBenchmark"><a href="#runBenchmark" class="headerlink" title="runBenchmark"></a>runBenchmark</h3><p>接下来看看<code>runBenchmark</code>脚本。</p>
<p><code>runBenchmark</code>里有两个函数：<code>helpModule ()</code>和<code>runModule ()</code>。</p>
<p><code>helpModule ()</code>就是显示帮助。</p>
<p><code>runModule ()</code>是运行<code>runBenchmark</code>模块时真正调用的函数。该函数主要做四件事：</p>
<ol>
<li>清除之前生成的日志</li>
<li>调用<code>RunBigBench.jar</code>来执行</li>
<li>logEnvInformation</li>
<li>将日志文件夹打包成zip</li>
</ol>
<p>源码如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">runModule</span></span> () &#123;</span><br><span class="line">  <span class="comment">#check input parameters</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">"<span class="variable">$BIG_BENCH_NUMBER_OF_PARALLEL_STREAMS</span>"</span> -le 0 ]</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"The number of parallel streams -s must be greater than 0"</span></span><br><span class="line">    <span class="built_in">return</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="string">"<span class="variable">$&#123;BIG_BENCH_BIN_DIR&#125;</span>/bigBench"</span> cleanLogs -U <span class="variable">$LIST_OF_USER_OPTIONS</span></span><br><span class="line">  <span class="string">"<span class="variable">$BIG_BENCH_JAVA</span>"</span> -jar <span class="string">"<span class="variable">$&#123;BIG_BENCH_TOOLS_DIR&#125;</span>/RunBigBench.jar"</span></span><br><span class="line">  <span class="string">"<span class="variable">$&#123;BIG_BENCH_BIN_DIR&#125;</span>/bigBench"</span> <span class="built_in">log</span>EnvInformation -U <span class="variable">$LIST_OF_USER_OPTIONS</span></span><br><span class="line">  <span class="string">"<span class="variable">$&#123;BIG_BENCH_BIN_DIR&#125;</span>/bigBench"</span> zipLogs -U <span class="variable">$LIST_OF_USER_OPTIONS</span></span><br><span class="line">  <span class="built_in">return</span> $?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相当于运行<code>runBenchmark</code>模块时又调用了<code>cleanLogs</code>、<code>logEnvInformation</code>、<code>zipLogs</code>三个模块以及<code>RunBigBench.jar</code>。其中<code>RunBigBench.jar</code>是TCPx-BB测试执行的核心代码，用Java语言编写。接下来分析<code>RunBigBench.jar</code>源码。</p>
<h3 id="runModule"><a href="#runModule" class="headerlink" title="runModule()"></a>runModule()</h3><p>runModule()函数用来执行某个module。我们已知，执行某个module需要切换到主目录下的bin目录，然后执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bigBench module_name arguments</span><br></pre></td></tr></table></figure>

<p>在runModule()函数里，cmdLine用来生成如上命令。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList cmdLine = <span class="keyword">new</span> ArrayList();</span><br><span class="line">cmdLine.add(<span class="string">"bash"</span>);</span><br><span class="line">cmdLine.add(<span class="keyword">this</span>.runScript);</span><br><span class="line">cmdLine.add(benchmarkPhase.getRunModule());</span><br><span class="line">cmdLine.addAll(arguments);</span><br></pre></td></tr></table></figure>

<p>其中，<code>this.runScript</code>为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.runScript = (String)env.get(<span class="string">"BIG_BENCH_BIN_DIR"</span>) + <span class="string">"/bigBench"</span>;</span><br></pre></td></tr></table></figure>

<p><code>benchmarkPhase.getRunModule()</code>用来获得需要执行的module。</p>
<p><code>arguments</code>为用户输入的参数。</p>
<p>至此，cmdLine为：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash <span class="variable">$BIG_BENCH_BIN_DIR</span>/bigBench module_name arguments</span><br></pre></td></tr></table></figure>

<p><strong>那么，怎么让系统执行该bash命令呢？答案是调用<code>runCmd()</code>方法。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> successful = <span class="keyword">this</span>.runCmd(<span class="keyword">this</span>.homeDir, benchmarkPhase.isPrintStdOut(), (String[])cmdLine.toArray(<span class="keyword">new</span> String[<span class="number">0</span>]));</span><br></pre></td></tr></table></figure>

<p>接下来介绍rumCmd()方法</p>
<h3 id="runCmd"><a href="#runCmd" class="headerlink" title="runCmd()"></a>runCmd()</h3><p>runCmd()方法通过<code>ProcessBuilder</code>来创建一个操作系统进程，并用该进程执行以上的bash命令。</p>
<p><code>ProcessBuilder</code>还可以设置工作目录和环境。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ProcessBuilder pb = <span class="keyword">new</span> ProcessBuilder(command);</span><br><span class="line">pb.directory(<span class="keyword">new</span> File(workingDirectory));</span><br><span class="line">Process p = <span class="keyword">null</span>;</span><br><span class="line">---</span><br><span class="line">p = pb.start();</span><br></pre></td></tr></table></figure>

<h3 id="getQueryList"><a href="#getQueryList" class="headerlink" title="getQueryList()"></a>getQueryList()</h3><p>getQueryList()用来获得需要执行的查询列表。从<code>$BIG_BENCH_LOGS_DIR/bigBench.properties</code>文件中读取。与<code>$BIG_BENCH_HOME/conf/bigBench.properties</code>内容一致。</p>
<p><code>bigBench.properties</code>里<code>power_test_0=1-30</code>规定了<code>powter_test_0</code>阶段需要执行的查询及其顺序。</p>
<p>可以用区间如 <code>5-12</code> 或者单个数字如 <code>21</code> 表示，中间用 <code>,</code> 隔开。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">power_test_0=28-25,2-5,10,22,30</span><br></pre></td></tr></table></figure>

<p>表示<code>powter_test_0</code>阶段需要执行的查询及其顺序为：<code>25,26,27,28,2,3,4,5,10,22,30</code></p>
<p>如果想让30个查询按顺序执行，则：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">power_test_0=1-30</span><br></pre></td></tr></table></figure>

<p>获得查询列表的源码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Integer&gt; <span class="title">getQueryList</span><span class="params">(BigBench.BenchmarkPhase benchmarkPhase, <span class="keyword">int</span> streamNumber)</span> </span>&#123;</span><br><span class="line">    String SHUFFLED_NAME_PATTERN = <span class="string">"shuffledQueryList"</span>;</span><br><span class="line">    BigBench.BenchmarkPhase queryOrderBasicPhase = BigBench.BenchmarkPhase.POWER_TEST;</span><br><span class="line">    String propertyKey = benchmarkPhase.getQueryListProperty(streamNumber);</span><br><span class="line">    <span class="keyword">boolean</span> queryOrderCached = benchmarkPhase.isQueryOrderCached();</span><br><span class="line">    <span class="keyword">if</span>(queryOrderCached &amp;&amp; <span class="keyword">this</span>.queryListCache.containsKey(propertyKey)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList((Collection)<span class="keyword">this</span>.queryListCache.get(propertyKey));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        Object queryList;</span><br><span class="line">        String basicPhaseNamePattern;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">this</span>.properties.containsKey(propertyKey)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(benchmarkPhase.isQueryOrderRandom()) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!<span class="keyword">this</span>.queryListCache.containsKey(<span class="string">"shuffledQueryList"</span>)) &#123;</span><br><span class="line">                    basicPhaseNamePattern = queryOrderBasicPhase.getQueryListProperty(<span class="number">0</span>);</span><br><span class="line">                    <span class="keyword">if</span>(!<span class="keyword">this</span>.properties.containsKey(basicPhaseNamePattern)) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Property "</span> + basicPhaseNamePattern + <span class="string">" is not defined, but is the basis for shuffling the query list."</span>);</span><br><span class="line">                    &#125;                      <span class="keyword">this</span>.queryListCache.put(<span class="string">"shuffledQueryList"</span>, <span class="keyword">this</span>.getQueryList(queryOrderBasicPhase, <span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                queryList = (List)<span class="keyword">this</span>.queryListCache.get(<span class="string">"shuffledQueryList"</span>);                  <span class="keyword">this</span>.shuffleList((List)queryList, <span class="keyword">this</span>.rnd);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                queryList = <span class="keyword">this</span>.getQueryList(queryOrderBasicPhase, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            queryList = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            String[] var11;</span><br><span class="line">            <span class="keyword">int</span> var10 = (var11 = <span class="keyword">this</span>.properties.getProperty(propertyKey).split(<span class="string">","</span>)).length;</span><br><span class="line">            label65:</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> var9 = <span class="number">0</span>; var9 &lt; var10; ++var9) &#123;</span><br><span class="line">                basicPhaseNamePattern = var11[var9];</span><br><span class="line">                String[] queryRange = basicPhaseNamePattern.trim().split(<span class="string">"-"</span>);</span><br><span class="line">                <span class="keyword">switch</span>(queryRange.length) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:                       ((List)queryList).add(Integer.valueOf(Integer.parseInt(queryRange[<span class="number">0</span>].trim())));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    <span class="keyword">int</span> startQuery = Integer.parseInt(queryRange[<span class="number">0</span>]);</span><br><span class="line">                    <span class="keyword">int</span> endQuery = Integer.parseInt(queryRange[<span class="number">1</span>]);</span><br><span class="line">                    <span class="keyword">int</span> i;</span><br><span class="line">                    <span class="keyword">if</span>(startQuery &gt; endQuery) &#123;</span><br><span class="line">                        i = startQuery;</span><br><span class="line">                        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(i &lt; endQuery) &#123;</span><br><span class="line">                                <span class="keyword">continue</span> label65;</span><br><span class="line">                            &#125;                               ((List)queryList).add(Integer.valueOf(i));</span><br><span class="line">                            --i;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        i = startQuery;</span><br><span class="line">                        <span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(i &gt; endQuery) &#123;</span><br><span class="line">                                <span class="keyword">continue</span> label65;</span><br><span class="line">                            &#125;                              ((List)queryList).add(Integer.valueOf(i));</span><br><span class="line">                            ++i;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Query numbers must be in the form X or X-Y, comma separated."</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(queryOrderCached) &#123;              <span class="keyword">this</span>.queryListCache.put(propertyKey, <span class="keyword">new</span> ArrayList((Collection)queryList));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ArrayList((Collection)queryList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="parseEnvironment"><a href="#parseEnvironment" class="headerlink" title="parseEnvironment()"></a>parseEnvironment()</h3><p>parseEnvironment()读取系统的环境变量并解析。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map env = System.getenv();</span><br><span class="line"><span class="keyword">this</span>.version = (String)env.get(<span class="string">"BIG_BENCH_VERSION"</span>);</span><br><span class="line"><span class="keyword">this</span>.homeDir = (String)env.get(<span class="string">"BIG_BENCH_HOME"</span>);</span><br><span class="line"><span class="keyword">this</span>.confDir = (String)env.get(<span class="string">"BIG_BENCH_CONF_DIR"</span>);</span><br><span class="line"><span class="keyword">this</span>.runScript = (String)env.get(<span class="string">"BIG_BENCH_BIN_DIR"</span>) + <span class="string">"/bigBench"</span>;</span><br><span class="line"><span class="keyword">this</span>.datagenDir = (String)env.get(<span class="string">"BIG_BENCH_DATA_GENERATOR_DIR"</span>);</span><br><span class="line"><span class="keyword">this</span>.logDir = (String)env.get(<span class="string">"BIG_BENCH_LOGS_DIR"</span>);</span><br><span class="line"><span class="keyword">this</span>.dataGenLogFile = (String)env.get(<span class="string">"BIG_BENCH_DATAGEN_STAGE_LOG"</span>);</span><br><span class="line"><span class="keyword">this</span>.loadLogFile = (String)env.get(<span class="string">"BIG_BENCH_LOADING_STAGE_LOG"</span>);</span><br><span class="line"><span class="keyword">this</span>.engine = (String)env.get(<span class="string">"BIG_BENCH_ENGINE"</span>);</span><br><span class="line"><span class="keyword">this</span>.database = (String)env.get(<span class="string">"BIG_BENCH_DATABASE"</span>);</span><br><span class="line"><span class="keyword">this</span>.mapTasks = (String)env.get(<span class="string">"BIG_BENCH_MAP_TASKS"</span>);</span><br><span class="line"><span class="keyword">this</span>.numberOfParallelStreams = Integer.parseInt((String)env.get(<span class="string">"BIG_BENCH_NUMBER_OF_PARALLEL_STREAMS"</span>));</span><br><span class="line"><span class="keyword">this</span>.scaleFactor = Long.parseLong((String)env.get(<span class="string">"BIG_BENCH_SCALE_FACTOR"</span>));</span><br><span class="line"><span class="keyword">this</span>.stopAfterFailure = ((String)env.get(<span class="string">"BIG_BENCH_STOP_AFTER_FAILURE"</span>)).equals(<span class="string">"1"</span>);</span><br></pre></td></tr></table></figure>

<p>并自动在用户指定的参数后面加上 <code>-U</code> (解锁专家模式)</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.userArguments.add(<span class="string">"-U"</span>);</span><br></pre></td></tr></table></figure>

<p>如果用户指定了 <code>PRETEND_MODE</code>、<code>PRINT_STD_OUT</code>、<code>WORKLOAD</code>、<code>QUERIES_TO_RUN</code>，则以用户指定的参数为准，否则使用默认值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(env.containsKey(<span class="string">"USER_PRETEND_MODE"</span>)) &#123;</span><br><span class="line">	<span class="keyword">this</span>.properties.setProperty(<span class="string">"pretend_mode"</span>, (String)env.get(<span class="string">"USER_PRETEND_MODE"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(env.containsKey(<span class="string">"USER_PRINT_STD_OUT"</span>)) &#123;  <span class="keyword">this</span>.properties.setProperty(<span class="string">"show_command_stdout"</span>, (String)env.get(<span class="string">"USER_PRINT_STD_OUT"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(env.containsKey(<span class="string">"USER_DRIVER_WORKLOAD"</span>)) &#123;</span><br><span class="line">   <span class="keyword">this</span>.properties.setProperty(<span class="string">"workload"</span>, (String)env.get(<span class="string">"USER_DRIVER_WORKLOAD"</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(env.containsKey(<span class="string">"USER_DRIVER_QUERIES_TO_RUN"</span>)) &#123;	<span class="keyword">this</span>.properties.setProperty(BigBench.BenchmarkPhase.POWER_TEST.getQueryListProperty(<span class="number">0</span>), (String)env.get(<span class="string">"USER_DRIVER_QUERIES_TO_RUN"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>读取 <code>workload</code> 并赋值 <code>benchmarkPhases</code>。如果 <code>workload</code> 里不包含 <code>BENCHMARK_START</code> 和 <code>BENCHMARK_STOP</code>，自动在 <code>benchmarkPhases</code> 的首位和末位分别加上 <code>BENCHMARK_START</code> 和 <code>BENCHMARK_STOP</code>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.benchmarkPhases = <span class="keyword">new</span> ArrayList();</span><br><span class="line">Iterator var7 = Arrays.asList(<span class="keyword">this</span>.properties.getProperty(<span class="string">"workload"</span>).split(<span class="string">","</span>)).iterator();</span><br><span class="line">	</span><br><span class="line"><span class="keyword">while</span>(var7.hasNext()) &#123;</span><br><span class="line">    String benchmarkPhase = (String)var7.next();</span><br><span class="line">    <span class="keyword">this</span>.benchmarkPhases.add(BigBench.BenchmarkPhase.valueOf(benchmarkPhase.trim()));</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">this</span>.benchmarkPhases.contains(BigBench.BenchmarkPhase.BENCHMARK_START)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.benchmarkPhases.add(<span class="number">0</span>, BigBench.BenchmarkPhase.BENCHMARK_START);</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">this</span>.benchmarkPhases.contains(BigBench.BenchmarkPhase.BENCHMARK_STOP)) &#123;</span><br><span class="line">    <span class="keyword">this</span>.benchmarkPhases.add(BigBench.BenchmarkPhase.BENCHMARK_STOP);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="run"><a href="#run" class="headerlink" title="run()"></a>run()</h3><p><code>run()</code> 方法是 <code>RunBigBench.jar</code> 里核心的方法。所有的执行都是通过 <code>run()</code> 方法调用的。比如 <code>runQueries()</code>、<code>runModule()</code>、<code>generateData()</code>等。<code>runQueries()</code>、<code>runModule()</code>、<code>generateData()</code> 又通过调用 <code>runCmd()</code> 方法来创建操作系统进程，执行bash命令，调用bash脚本。</p>
<p><code>run()</code> 方法里通过一个 <code>while</code> 循环来逐一执行 <code>workload</code> 里的每一个 <code>benchmarkPhase</code>。 不同的 <code>benchmarkPhase</code> 会调用 <code>runQueries()</code>、<code>runModule()</code>、<code>generateData()</code>…中的不同方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="keyword">long</span> e = <span class="number">0L</span>;</span><br><span class="line"><span class="keyword">this</span>.log.finer(<span class="string">"Benchmark phases: "</span> + <span class="keyword">this</span>.benchmarkPhases);</span><br><span class="line">Iterator startCheckpoint = <span class="keyword">this</span>.benchmarkPhases.iterator();</span><br><span class="line"><span class="keyword">long</span> throughputStart;</span><br><span class="line"><span class="keyword">while</span>(startCheckpoint.hasNext()) &#123;</span><br><span class="line">    BigBench.BenchmarkPhase children = (BigBench.BenchmarkPhase)startCheckpoint.next();</span><br><span class="line">    <span class="keyword">if</span>(children.isPhaseDone()) &#123;</span><br><span class="line">        <span class="keyword">this</span>.log.info(<span class="string">"The phase "</span> + children.name() + <span class="string">" was already performed earlier. Skipping this phase"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span>($SWITCH_TABLE$io$bigdatabenchmark$v1$driver$BigBench$BenchmarkPhase()[children.ordinal()]) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">20</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"The value "</span> + children.name() + <span class="string">" is only used internally."</span>);</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:                                    <span class="keyword">this</span>.log.info(children.getConsoleMessage());</span><br><span class="line">                e = System.currentTimeMillis();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">if</span>(!BigBench.BenchmarkPhase.BENCHMARK_START.isPhaseDone()) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Error: Cannot stop the benchmark before starting it"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                throughputStart = System.currentTimeMillis();</span><br><span class="line">              <span class="keyword">this</span>.log.info(String.format(<span class="string">"%-55s finished. Time: %25s"</span>, <span class="keyword">new</span> Object[]&#123;children.getConsoleMessage(), BigBench.Helper.formatTime(throughputStart - e)&#125;));               <span class="keyword">this</span>.logTreeRoot.setCheckpoint(<span class="keyword">new</span> BigBench.Checkpoint(BigBench.BenchmarkPhase.BENCHMARK, -<span class="number">1L</span>, -<span class="number">1L</span>, e, throughputStart, <span class="keyword">this</span>.logTreeRoot.isSuccessful()));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">18</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">22</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">27</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">28</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">29</span>:</span><br><span class="line">                <span class="keyword">this</span>.runModule(children, <span class="keyword">this</span>.userArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">                <span class="keyword">this</span>.runQueries(children, <span class="number">1</span>, validationArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">                <span class="keyword">this</span>.runModule(children, validationArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                <span class="keyword">this</span>.generateData(children, <span class="keyword">false</span>, validationArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                <span class="keyword">this</span>.generateData(children, <span class="keyword">true</span>, validationArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">19</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">24</span>:</span><br><span class="line">                <span class="keyword">this</span>.runQueries(children, <span class="number">1</span>, <span class="keyword">this</span>.userArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">13</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">14</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">21</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">23</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">25</span>:</span><br><span class="line">            <span class="keyword">case</span> <span class="number">26</span>:</span><br><span class="line">                <span class="keyword">this</span>.runQueries(children, <span class="keyword">this</span>.numberOfParallelStreams, <span class="keyword">this</span>.userArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">                <span class="keyword">this</span>.generateData(children, <span class="keyword">false</span>, <span class="keyword">this</span>.userArguments);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">17</span>:</span><br><span class="line">                <span class="keyword">this</span>.generateData(children, <span class="keyword">true</span>, <span class="keyword">this</span>.userArguments);</span><br><span class="line">            &#125;</span><br><span class="line">            children.setPhaseDone(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException var21) &#123;</span><br><span class="line">            <span class="keyword">this</span>.log.info(<span class="string">"==============\nBenchmark run terminated\nReason: An error occured while running a command in phase "</span> + children + <span class="string">"\n=============="</span>);</span><br><span class="line">            var21.printStackTrace();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.stopAfterFailure || children.mustSucceed()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 <code>case 1-29</code> 并不是 <code>1-29</code> 条查询，而是枚举类型里的 <code>1-29</code> 个 <code>benmarkPhase</code> 。如下所示：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">enum</span> BenchmarkPhase &#123;</span><br><span class="line">BENCHMARK((String)<span class="keyword">null</span>, <span class="string">"benchmark"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench benchmark"</span>),</span><br><span class="line">BENCHMARK_START((String)<span class="keyword">null</span>, <span class="string">"benchmark_start"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench benchmark: Start"</span>),</span><br><span class="line">BENCHMARK_STOP((String)<span class="keyword">null</span>, <span class="string">"benchmark_stop"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench benchmark: Stop"</span>),</span><br><span class="line">CLEAN_ALL(<span class="string">"cleanAll"</span>, <span class="string">"clean_all"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench clean all"</span>),</span><br><span class="line">ENGINE_VALIDATION_CLEAN_POWER_TEST(<span class="string">"cleanQuery"</span>, <span class="string">"engine_validation_power_test"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench engine validation: Clean power test queries"</span>),</span><br><span class="line">ENGINE_VALIDATION_CLEAN_LOAD_TEST(<span class="string">"cleanMetastore"</span>, <span class="string">"engine_validation_metastore"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench engine validation: Clean metastore"</span>),</span><br><span class="line">ENGINE_VALIDATION_CLEAN_DATA(<span class="string">"cleanData"</span>, <span class="string">"engine_validation_data"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench engine validation: Clean data"</span>),</span><br><span class="line">ENGINE_VALIDATION_DATA_GENERATION(<span class="string">"dataGen"</span>, <span class="string">"engine_validation_data"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="string">"BigBench engine validation: Data generation"</span>),</span><br><span class="line">ENGINE_VALIDATION_LOAD_TEST(<span class="string">"populateMetastore"</span>, <span class="string">"engine_validation_metastore"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="string">"BigBench engine validation: Populate metastore"</span>),</span><br><span class="line">ENGINE_VALIDATION_POWER_TEST(<span class="string">"runQuery"</span>, <span class="string">"engine_validation_power_test"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench engine validation: Power test"</span>),</span><br><span class="line">ENGINE_VALIDATION_RESULT_VALIDATION(<span class="string">"validateQuery"</span>, <span class="string">"engine_validation_power_test"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench engine validation: Check all query results"</span>),</span><br><span class="line">CLEAN_POWER_TEST(<span class="string">"cleanQuery"</span>, <span class="string">"power_test"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench clean: Clean power test queries"</span>),</span><br><span class="line">CLEAN_THROUGHPUT_TEST_1(<span class="string">"cleanQuery"</span>, <span class="string">"throughput_test_1"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench clean: Clean first throughput test queries"</span>),</span><br><span class="line">CLEAN_THROUGHPUT_TEST_2(<span class="string">"cleanQuery"</span>, <span class="string">"throughput_test_2"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench clean: Clean second throughput test queries"</span>),</span><br><span class="line">CLEAN_LOAD_TEST(<span class="string">"cleanMetastore"</span>, <span class="string">"metastore"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench clean: Load test"</span>),</span><br><span class="line">CLEAN_DATA(<span class="string">"cleanData"</span>, <span class="string">"data"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench clean: Data"</span>),</span><br><span class="line">DATA_GENERATION(<span class="string">"dataGen"</span>, <span class="string">"data"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="string">"BigBench preparation: Data generation"</span>),</span><br><span class="line">LOAD_TEST(<span class="string">"populateMetastore"</span>, <span class="string">"metastore"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="string">"BigBench phase 1: Load test"</span>),</span><br><span class="line">POWER_TEST(<span class="string">"runQuery"</span>, <span class="string">"power_test"</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench phase 2: Power test"</span>),</span><br><span class="line">THROUGHPUT_TEST((String)<span class="keyword">null</span>, <span class="string">"throughput_test"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench phase 3: Throughput test"</span>),</span><br><span class="line">THROUGHPUT_TEST_1(<span class="string">"runQuery"</span>, <span class="string">"throughput_test_1"</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench phase 3: First throughput test run"</span>),</span><br><span class="line">THROUGHPUT_TEST_REFRESH(<span class="string">"refreshMetastore"</span>, <span class="string">"throughput_test_refresh"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench phase 3: Throughput test data refresh"</span>),</span><br><span class="line">THROUGHPUT_TEST_2(<span class="string">"runQuery"</span>, <span class="string">"throughput_test_2"</span>, <span class="keyword">true</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="string">"BigBench phase 3: Second throughput test run"</span>),</span><br><span class="line">VALIDATE_POWER_TEST(<span class="string">"validateQuery"</span>, <span class="string">"power_test"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench validation: Power test results"</span>),</span><br><span class="line">VALIDATE_THROUGHPUT_TEST_1(<span class="string">"validateQuery"</span>, <span class="string">"throughput_test_1"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench validation: First throughput test results"</span>),</span><br><span class="line">VALIDATE_THROUGHPUT_TEST_2(<span class="string">"validateQuery"</span>, <span class="string">"throughput_test_2"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench validation: Second throughput test results"</span>),</span><br><span class="line">SHOW_TIMES(<span class="string">"showTimes"</span>, <span class="string">"show_times"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench: show query times"</span>),</span><br><span class="line">SHOW_ERRORS(<span class="string">"showErrors"</span>, <span class="string">"show_errors"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench: show query errors"</span>),</span><br><span class="line">SHOW_VALIDATION(<span class="string">"showValidation"</span>, <span class="string">"show_validation"</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">false</span>, <span class="string">"BigBench: show query validation results"</span>);</span><br><span class="line"><span class="keyword">private</span> String runModule;</span><br><span class="line"><span class="keyword">private</span> String namePattern;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> queryOrderRandom;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> queryOrderCached;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> printStdOut;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> mustSucceed;</span><br><span class="line"><span class="keyword">private</span> String consoleMessage;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> phaseDone;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">BenchmarkPhase</span><span class="params">(String runModule, String namePattern, <span class="keyword">boolean</span> queryOrderRandom, <span class="keyword">boolean</span> queryOrderCached, <span class="keyword">boolean</span> printStdOut, <span class="keyword">boolean</span> mustSucceed, String consoleMessage)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.runModule = runModule;</span><br><span class="line">    <span class="keyword">this</span>.namePattern = namePattern;</span><br><span class="line">    <span class="keyword">this</span>.queryOrderRandom = queryOrderRandom;</span><br><span class="line">    <span class="keyword">this</span>.queryOrderCached = queryOrderCached;</span><br><span class="line">    <span class="keyword">this</span>.printStdOut = printStdOut;</span><br><span class="line">    <span class="keyword">this</span>.mustSucceed = mustSucceed;</span><br><span class="line">    <span class="keyword">this</span>.consoleMessage = consoleMessage;</span><br><span class="line">    <span class="keyword">this</span>.phaseDone = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3对应 <code>BENCHMARK_STOP</code>，4对应 <code>CLEAN_ALL</code>,29对应 <code>SHOW_VALIDATION</code>，依此类推…</p>
<p>可以看出：</p>
<p><code>CLEAN_ALL、CLEAN_LOAD_TEST、LOAD_TEST、THROUGHPUT_TEST_REFRESH、SHOW_TIMES、SHOW_ERRORS、SHOW_VALIDATION</code>等benchmarkPhases调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.runModule(children, <span class="keyword">this</span>.userArguments);</span><br></pre></td></tr></table></figure>

<p>方法是 <code>runModule</code> ，参数是 <code>this.userArguments</code>。</p>
<p><code>ENGINE_VALIDATION_CLEAN_POWER_TEST、ENGINE_VALIDATION_POWER_TEST、ENGINE_VALIDATION_RESULT_VALIDATION</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.runQueries(children, <span class="number">1</span>, validationArguments);</span><br></pre></td></tr></table></figure>

<p>方法是 <code>runQueries</code> ，参数是 <code>1</code>(stream number) 和 <code>validationArguments</code>。</p>
<p><code>ENGINE_VALIDATION_CLEAN_LOAD_TEST</code> 和 <code>ENGINE_VALIDATION_LOAD_TEST</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.runModule(children, validationArguments);</span><br></pre></td></tr></table></figure>

<p><code>ENGINE_VALIDATION_CLEAN_DATA</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.generateData(children, <span class="keyword">false</span>, validationArguments);</span><br></pre></td></tr></table></figure>

<p><code>ENGINE_VALIDATION_DATA_GENERATION</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.generateData(children, <span class="keyword">true</span>, validationArguments);</span><br></pre></td></tr></table></figure>

<p><code>CLEAN_POWER_TEST</code>、<code>POWER_TEST</code>、<code>VALIDATE_POWER_TEST</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.runQueries(children, <span class="number">1</span>, <span class="keyword">this</span>.userArguments);</span><br></pre></td></tr></table></figure>

<p><code>CLEAN_THROUGHPUT_TEST_1``CLEAN_THROUGHPUT_TEST_2``THROUGHPUT_TEST_1``THROUGHPUT_TEST_2``VALIDATE_THROUGHPUT_TEST_1</code> <code>VALIDATE_THROUGHPUT_TEST_2</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.runQueries(children, <span class="keyword">this</span>.numberOfParallelStreams, <span class="keyword">this</span>.userArguments);</span><br></pre></td></tr></table></figure>

<p><code>CLEAN_DATA</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.generateData(children, <span class="keyword">false</span>, <span class="keyword">this</span>.userArguments);</span><br></pre></td></tr></table></figure>

<p><code>DATA_GENERATION</code> 调用的是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.generateData(children, <span class="keyword">true</span>, <span class="keyword">this</span>.userArguments);</span><br></pre></td></tr></table></figure>

<p>总结一下以上的方法调用可以发现：</p>
<ul>
<li>跟 <code>ENGINE_VALIDATION</code> 相关的benchmarkPhase用的参数都是 <code>validationArguments</code>。其余用的是 <code>userArguments</code></li>
<li>跟 <code>POWER_TEST</code> 相关的都是调用 <code>runQueries()</code> 方法，因为 <code>POWER_TEST</code> 就是执行SQL查询</li>
<li>跟 <code>CLEAN_DATA</code> <code>DATA_GENERATION</code> 相关的都是调用 <code>generateData()</code> 方法</li>
<li>跟 <code>LOAD_TEST</code> <code>SHOW</code> 相关的都是调用 <code>runModule()</code> 方法</li>
</ul>
<h3 id="benchmarkPhase-和-module-对应关系"><a href="#benchmarkPhase-和-module-对应关系" class="headerlink" title="benchmarkPhase 和 module 对应关系"></a>benchmarkPhase 和 module 对应关系</h3><p>具体每个 <code>benchmarkPhase</code> 跟 <code>module</code>（执行的脚本）的对应关系如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CLEAN_ALL -&gt; <span class="string">"cleanAll"</span></span><br><span class="line">ENGINE_VALIDATION_CLEAN_POWER_TEST -&gt; <span class="string">"cleanQuery"</span></span><br><span class="line">ENGINE_VALIDATION_CLEAN_LOAD_TEST -&gt; <span class="string">"cleanMetastore"</span>,</span><br><span class="line">ENGINE_VALIDATION_CLEAN_DATA -&gt; <span class="string">"cleanData"</span></span><br><span class="line">ENGINE_VALIDATION_DATA_GENERATION -&gt; <span class="string">"dataGen"</span></span><br><span class="line">ENGINE_VALIDATION_LOAD_TEST -&gt; <span class="string">"populateMetastore"</span></span><br><span class="line">ENGINE_VALIDATION_POWER_TEST -&gt; <span class="string">"runQuery"</span></span><br><span class="line">ENGINE_VALIDATION_RESULT_VALIDATION -&gt; <span class="string">"validateQuery"</span></span><br><span class="line">CLEAN_POWER_TEST -&gt; <span class="string">"cleanQuery"</span></span><br><span class="line">CLEAN_THROUGHPUT_TEST_1 -&gt; <span class="string">"cleanQuery"</span></span><br><span class="line">CLEAN_THROUGHPUT_TEST_2 -&gt; <span class="string">"cleanQuery"</span></span><br><span class="line">CLEAN_LOAD_TEST -&gt; <span class="string">"cleanMetastore"</span></span><br><span class="line">CLEAN_DATA -&gt; <span class="string">"cleanData"</span></span><br><span class="line">DATA_GENERATION -&gt; <span class="string">"dataGen"</span></span><br><span class="line">LOAD_TEST -&gt; <span class="string">"populateMetastore"</span></span><br><span class="line">POWER_TEST -&gt; <span class="string">"runQuery"</span></span><br><span class="line">THROUGHPUT_TEST -&gt; (String)<span class="keyword">null</span></span><br><span class="line">THROUGHPUT_TEST_1 -&gt; <span class="string">"runQuery"</span></span><br><span class="line">THROUGHPUT_TEST_REFRESH -&gt; <span class="string">"refreshMetastore"</span></span><br><span class="line">THROUGHPUT_TEST_2 -&gt; <span class="string">"runQuery"</span></span><br><span class="line">VALIDATE_POWER_TEST -&gt; <span class="string">"validateQuery"</span></span><br><span class="line">VALIDATE_THROUGHPUT_TEST_1 -&gt; <span class="string">"validateQuery"</span></span><br><span class="line">VALIDATE_THROUGHPUT_TEST_2 -&gt; <span class="string">"validateQuery"</span></span><br><span class="line">SHOW_TIMES -&gt; <span class="string">"showTimes"</span></span><br><span class="line">SHOW_ERRORS -&gt; <span class="string">"showErrors"</span></span><br><span class="line">SHOW_VALIDATION -&gt; <span class="string">"showValidation"</span></span><br></pre></td></tr></table></figure>

<p>当执行某个 <code>benchmarkPhase</code> 时会去调用如上该 <code>benchmarkPhase</code> 对应的 <code>module</code> （脚本位于 <code>$BENCH_MARK_HOME/engines/hive/bin</code> 目录下）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cmdLine.add(benchmarkPhase.getRunModule());</span><br></pre></td></tr></table></figure>

<h3 id="程序调用流程"><a href="#程序调用流程" class="headerlink" title="程序调用流程"></a>程序调用流程</h3><p><img src="./bigBench.png" alt="Alt text"></p>
<p>接下来介绍每个module的功能</p>
<h2 id="module"><a href="#module" class="headerlink" title="module"></a>module</h2><h3 id="cleanAll"><a href="#cleanAll" class="headerlink" title="cleanAll"></a>cleanAll</h3><pre><code>1. DROP DATABASE
2. 删除hdfs上的源数据</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"dropping database (with all tables)"</span></span><br><span class="line">runCmdWithErrorCheck runEngineCmd <span class="_">-e</span> <span class="string">"DROP DATABASE IF EXISTS <span class="variable">$BIG_BENCH_DATABASE</span> CASCADE;"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"cleaning <span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_HOME&#125;</span>"</span></span><br><span class="line">hadoop fs -rm -r <span class="_">-f</span> -skipTrash <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_HOME&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<h3 id="cleanQuery"><a href="#cleanQuery" class="headerlink" title="cleanQuery"></a>cleanQuery</h3><pre><code>1. 删除对应的 Query 生成的临时表
2. 删除对应的 Query 生成的结果表</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runCmdWithErrorCheck runEngineCmd <span class="_">-e</span> <span class="string">"DROP TABLE IF EXISTS <span class="variable">$TEMP_TABLE1</span>; DROP TABLE IF EXISTS <span class="variable">$TEMP_TABLE2</span>; DROP TABLE IF EXISTS <span class="variable">$RESULT_TABLE</span>;"</span></span><br><span class="line"><span class="built_in">return</span> $?</span><br></pre></td></tr></table></figure>

<h3 id="cleanMetastore"><a href="#cleanMetastore" class="headerlink" title="cleanMetastore"></a>cleanMetastore</h3><pre><code>1. 调用 `dropTables.sql` 将23张表依次DROP</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"cleaning metastore tables"</span></span><br><span class="line">runCmdWithErrorCheck runEngineCmd <span class="_">-f</span> <span class="string">"<span class="variable">$BIG_BENCH_CLEAN_METASTORE_FILE</span>"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> BIG_BENCH_CLEAN_METASTORE_FILE=<span class="string">"<span class="variable">$BIG_BENCH_CLEAN_DIR</span>/dropTables.sql"</span></span><br></pre></td></tr></table></figure>

<p><code>dropTables.sql</code> 将23张表依次DROP,源码如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:customerTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:customerAddressTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:customerDemographicsTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:dateTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:householdDemographicsTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:incomeTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:itemTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:promotionTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:reasonTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:shipModeTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:storeTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:timeTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:warehouseTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:webSiteTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:webPageTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:inventoryTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:storeSalesTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:storeReturnsTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:webSalesTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:webReturnsTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:marketPricesTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:clickstreamsTableName&#125;;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:reviewsTableName&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="cleanData"><a href="#cleanData" class="headerlink" title="cleanData"></a>cleanData</h3><pre><code>1. 删除hdfs上 /user/root/benchmarks/bigbench/data 目录
2. 删除hdfs上 /user/root/benchmarks/bigbench/data_refresh 目录</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"cleaning <span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_INIT_DATA_DIR&#125;</span>"</span></span><br><span class="line">hadoop fs -rm -r <span class="_">-f</span> -skipTrash <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_INIT_DATA_DIR&#125;</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"cleaning <span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_REFRESH_DATA_DIR&#125;</span>"</span></span><br><span class="line">hadoop fs -rm -r <span class="_">-f</span> -skipTrash <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_REFRESH_DATA_DIR&#125;</span>"</span></span><br><span class="line">```	</span><br><span class="line"></span><br><span class="line"><span class="comment">### dataGen</span></span><br><span class="line"></span><br><span class="line">	1. 创建目录 /user/root/benchmarks/bigbench/data 并赋予权限</span><br><span class="line">	2. 创建目录 /user/root/benchmarks/bigbench/data_refresh 并赋予权限</span><br><span class="line">	3. 调用 HadoopClusterExec.jar 和 pdgf.jar 生成 base data 到 /user/root/benchmarks/bigbench/data 目录下</span><br><span class="line">	4. 调用 HadoopClusterExec.jar 和 pdgf.jar 生成 refresh data 到 /user/root/benchmarks/bigbench/data_refresh 目录下</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建目录 /user/root/benchmarks/bigbench/data 并赋予权限</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">runCmdWithErrorCheck hadoop fs -mkdir -p <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_INIT_DATA_DIR&#125;</span>"</span></span><br><span class="line">runCmdWithErrorCheck hadoop fs -chmod 777 <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_INIT_DATA_DIR&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<p>创建目录 /user/root/benchmarks/bigbench/data_refresh 并赋予权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runCmdWithErrorCheck hadoop fs -mkdir -p <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_REFRESH_DATA_DIR&#125;</span>"</span></span><br><span class="line">runCmdWithErrorCheck hadoop fs -chmod 777 <span class="string">"<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_REFRESH_DATA_DIR&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<p>调用 HadoopClusterExec.jar 和 pdgf.jar 生成 base data</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runCmdWithErrorCheck hadoop jar <span class="string">"<span class="variable">$&#123;BIG_BENCH_TOOLS_DIR&#125;</span>/HadoopClusterExec.jar"</span> -archives <span class="string">"<span class="variable">$&#123;PDGF_ARCHIVE_PATH&#125;</span>"</span> <span class="variable">$&#123;BIG_BENCH_DATAGEN_HADOOP_EXEC_DEBUG&#125;</span> -taskFailOnNonZeroReturnValue -execCWD <span class="string">"<span class="variable">$&#123;PDGF_DISTRIBUTED_NODE_DIR&#125;</span>"</span> <span class="variable">$&#123;HadoopClusterExecOptions&#125;</span> -exec <span class="variable">$&#123;BIG_BENCH_DATAGEN_HADOOP_JVM_ENV&#125;</span> -cp <span class="string">"<span class="variable">$&#123;HADOOP_CP&#125;</span>:pdgf.jar"</span> <span class="variable">$&#123;PDGF_CLUSTER_CONF&#125;</span> pdgf.Controller -nc HadoopClusterExec.tasks -nn HadoopClusterExec.taskNumber -ns -c -sp REFRESH_PHASE 0 -o <span class="string">"'<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_INIT_DATA_DIR&#125;</span>/'+table.getName()+'/'"</span> <span class="variable">$&#123;BIG_BENCH_DATAGEN_HADOOP_OPTIONS&#125;</span> <span class="_">-s</span> <span class="variable">$&#123;BIG_BENCH_DATAGEN_TABLES&#125;</span> <span class="variable">$&#123;PDGF_OPTIONS&#125;</span> <span class="string">"<span class="variable">$@</span>"</span> 2&gt;&amp;1 | tee <span class="_">-a</span> <span class="string">"<span class="variable">$BIG_BENCH_DATAGEN_STAGE_LOG</span>"</span> 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>调用 HadoopClusterExec.jar 和 pdgf.jar 生成 refresh data</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runCmdWithErrorCheck hadoop jar <span class="string">"<span class="variable">$&#123;BIG_BENCH_TOOLS_DIR&#125;</span>/HadoopClusterExec.jar"</span> -archives <span class="string">"<span class="variable">$&#123;PDGF_ARCHIVE_PATH&#125;</span>"</span> <span class="variable">$&#123;BIG_BENCH_DATAGEN_HADOOP_EXEC_DEBUG&#125;</span> -taskFailOnNonZeroReturnValue -execCWD <span class="string">"<span class="variable">$&#123;PDGF_DISTRIBUTED_NODE_DIR&#125;</span>"</span> <span class="variable">$&#123;HadoopClusterExecOptions&#125;</span> -exec <span class="variable">$&#123;BIG_BENCH_DATAGEN_HADOOP_JVM_ENV&#125;</span> -cp <span class="string">"<span class="variable">$&#123;HADOOP_CP&#125;</span>:pdgf.jar"</span> <span class="variable">$&#123;PDGF_CLUSTER_CONF&#125;</span> pdgf.Controller -nc HadoopClusterExec.tasks -nn HadoopClusterExec.taskNumber -ns -c -sp REFRESH_PHASE 1 -o <span class="string">"'<span class="variable">$&#123;BIG_BENCH_HDFS_ABSOLUTE_REFRESH_DATA_DIR&#125;</span>/'+table.getName()+'/'"</span> <span class="variable">$&#123;BIG_BENCH_DATAGEN_HADOOP_OPTIONS&#125;</span> <span class="_">-s</span> <span class="variable">$&#123;BIG_BENCH_DATAGEN_TABLES&#125;</span> <span class="variable">$&#123;PDGF_OPTIONS&#125;</span> <span class="string">"<span class="variable">$@</span>"</span> 2&gt;&amp;1 | tee <span class="_">-a</span> <span class="string">"<span class="variable">$BIG_BENCH_DATAGEN_STAGE_LOG</span>"</span> 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<h3 id="populateMetastore"><a href="#populateMetastore" class="headerlink" title="populateMetastore"></a>populateMetastore</h3><p> 该过程是真正的创建数据库表的过程。建表的过程调用的是 <code>$BENCH_MARK_HOME/engines/hive/population/</code> 目录下的 <code>hiveCreateLoad.sql</code> ,通过该sql文件来建数据库表。</p>
<ol>
<li>从 /user/root/benchmarks/bigbench/data 路径下读取 .dat 的原始数据，生成 TEXTFILE 格式的外部临时表</li>
<li>用 <code>select * from 临时表</code> 来创建最终的 ORC 格式的数据库表</li>
<li>删除外部临时表。</li>
</ol>
<p>从 /user/root/benchmarks/bigbench/data 路径下读取 .dat 的原始数据，生成 TEXTFILE 格式的外部临时表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;</span><br><span class="line">  ( c_customer_sk             <span class="built_in">bigint</span>              <span class="comment">--not null</span></span><br><span class="line">  , c_customer_id             <span class="keyword">string</span>              <span class="comment">--not null</span></span><br><span class="line">  , c_current_cdemo_sk        <span class="built_in">bigint</span></span><br><span class="line">  , c_current_hdemo_sk        <span class="built_in">bigint</span></span><br><span class="line">  , c_current_addr_sk         <span class="built_in">bigint</span></span><br><span class="line">  , c_first_shipto_date_sk    <span class="built_in">bigint</span></span><br><span class="line">  , c_first_sales_date_sk     <span class="built_in">bigint</span></span><br><span class="line">  , c_salutation              <span class="keyword">string</span></span><br><span class="line">  , c_first_name              <span class="keyword">string</span></span><br><span class="line">  , c_last_name               <span class="keyword">string</span></span><br><span class="line">  , c_preferred_cust_flag     <span class="keyword">string</span></span><br><span class="line">  , c_birth_day               <span class="built_in">int</span></span><br><span class="line">  , c_birth_month             <span class="built_in">int</span></span><br><span class="line">  , c_birth_year              <span class="built_in">int</span></span><br><span class="line">  , c_birth_country           <span class="keyword">string</span></span><br><span class="line">  , c_login                   <span class="keyword">string</span></span><br><span class="line">  , c_email_address           <span class="keyword">string</span></span><br><span class="line">  , c_last_review_date        <span class="keyword">string</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'$&#123;hiveconf:fieldDelimiter&#125;'</span></span><br><span class="line">  <span class="keyword">STORED</span> <span class="keyword">AS</span> TEXTFILE LOCATION <span class="string">'$&#123;hiveconf:hdfsDataPath&#125;/$&#123;hiveconf:customerTableName&#125;'</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>


<p>用 <code>select * from 临时表</code> 来创建最终的 ORC 格式的数据库表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:customerTableName&#125;;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> $&#123;hiveconf:customerTableName&#125;</span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> $&#123;hiveconf:tableFormat&#125;</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>删除外部临时表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;;</span><br></pre></td></tr></table></figure>

<p>总结下执行以下 <code>TPCx-BB</code> 测试命令代码的执行步骤:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">./bigBench runBenchmark -f <span class="number">1</span> -m <span class="number">8</span> -s <span class="number">2</span> -j <span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="runQuery"><a href="#runQuery" class="headerlink" title="runQuery"></a>runQuery</h3><pre><code>1. runQuery 调用每个query下的 run.sh 里的 `query_run_main_method()` 方法
2. `query_run_main_method()` 调用 `runEngineCmd` 来执行query脚本（qxx.sql）</code></pre><p>runQuery 调用每个query下的 run.sh 里的 <code>query_run_main_method()</code> 方法</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">QUERY_MAIN_METHOD=<span class="string">"query_run_main_method"</span></span><br><span class="line">-----------------------------------------</span><br><span class="line"><span class="string">"<span class="variable">$QUERY_MAIN_METHOD</span>"</span> 2&gt;&amp;1 | tee <span class="_">-a</span> <span class="string">"<span class="variable">$LOG_FILE_NAME</span>"</span> 2&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p><code>query_run_main_method()</code> 调用 <code>runEngineCmd</code> 来执行query脚本（qxx.sql）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">query_run_main_method</span></span> () &#123;</span><br><span class="line">	QUERY_SCRIPT=<span class="string">"<span class="variable">$QUERY_DIR</span>/<span class="variable">$QUERY_NAME</span>.sql"</span></span><br><span class="line">	<span class="keyword">if</span> [ ! -r <span class="string">"<span class="variable">$QUERY_SCRIPT</span>"</span> ]</span><br><span class="line">	<span class="keyword">then</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="string">"SQL file <span class="variable">$QUERY_SCRIPT</span> can not be read."</span></span><br><span class="line">		<span class="built_in">exit</span> 1</span><br><span class="line">	<span class="keyword">fi</span></span><br><span class="line">	runCmdWithErrorCheck runEngineCmd <span class="_">-f</span> <span class="string">"<span class="variable">$QUERY_SCRIPT</span>"</span></span><br><span class="line">	<span class="built_in">return</span> $?</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>一般情况下 <code>query_run_main_method ()</code> 方法只是执行对应的query脚本，但是像 q05、q20… 这些查询，用到了机器学习算法，所以在执行对应的query脚本后会把生成的结果表作为输入，然后调用执行机器学习算法（如聚类、逻辑回归）的jar包继续执行，得到最终的结果。</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">runEngineCmd</span></span> () &#123;</span><br><span class="line">  <span class="keyword">if</span> addInitScriptsToParams</span><br><span class="line">  <span class="keyword">then</span></span><br><span class="line">    <span class="string">"<span class="variable">$BINARY</span>"</span> <span class="string">"<span class="variable">$&#123;BINARY_PARAMS[@]&#125;</span>"</span> <span class="string">"<span class="variable">$&#123;INIT_PARAMS[@]&#125;</span>"</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">return</span> 1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line">BINARY=<span class="string">"/usr/bin/hive"</span></span><br><span class="line">BINARY_PARAMS+=(--hiveconf BENCHMARK_PHASE=<span class="variable">$BIG_BENCH_BENCHMARK_PHASE</span> --hiveconf STREAM_NUMBER=<span class="variable">$BIG_BENCH_STREAM_NUMBER</span> --hiveconf QUERY_NAME=<span class="variable">$QUERY_NAME</span> --hiveconf QUERY_DIR=<span class="variable">$QUERY_DIR</span> --hiveconf RESULT_TABLE=<span class="variable">$RESULT_TABLE</span> --hiveconf RESULT_DIR=<span class="variable">$RESULT_DIR</span> --hiveconf TEMP_TABLE=<span class="variable">$TEMP_TABLE</span> --hiveconf TEMP_DIR=<span class="variable">$TEMP_DIR</span> --hiveconf TABLE_PREFIX=<span class="variable">$TABLE_PREFIX</span>)</span><br><span class="line">INIT_PARAMS=(-i <span class="string">"<span class="variable">$BIG_BENCH_QUERY_PARAMS_FILE</span>"</span> -i <span class="string">"<span class="variable">$BIG_BENCH_ENGINE_SETTINGS_FILE</span>"</span>)</span><br><span class="line">INIT_PARAMS+=(-i <span class="string">"<span class="variable">$LOCAL_QUERY_ENGINE_SETTINGS_FILE</span>"</span>)</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$USER_QUERY_PARAMS_FILE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ -r <span class="string">"<span class="variable">$USER_QUERY_PARAMS_FILE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"User defined query parameter file found. Adding <span class="variable">$USER_QUERY_PARAMS_FILE</span> to hive init."</span></span><br><span class="line">  INIT_PARAMS+=(-i <span class="string">"<span class="variable">$USER_QUERY_PARAMS_FILE</span>"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"User query parameter file <span class="variable">$USER_QUERY_PARAMS_FILE</span> can not be read."</span></span><br><span class="line">  <span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">"<span class="variable">$USER_ENGINE_SETTINGS_FILE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="keyword">if</span> [ -r <span class="string">"<span class="variable">$USER_ENGINE_SETTINGS_FILE</span>"</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"User defined engine settings file found. Adding <span class="variable">$USER_ENGINE_SETTINGS_FILE</span> to hive init."</span></span><br><span class="line">  INIT_PARAMS+=(-i <span class="string">"<span class="variable">$USER_ENGINE_SETTINGS_FILE</span>"</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"User hive settings file <span class="variable">$USER_ENGINE_SETTINGS_FILE</span> can not be read."</span></span><br><span class="line">  <span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">return</span> 0</span><br></pre></td></tr></table></figure>

<h3 id="validateQuery"><a href="#validateQuery" class="headerlink" title="validateQuery"></a>validateQuery</h3><pre><code>1. 调用每个query下的 run.sh 里的 `query_run_validate_method()` 方法
2. `query_run_validate_method()` 比较 `$BENCH_MARK_HOME/engines/hive/queries/qxx/results/qxx-result` 和hdfs上 `/user/root/benchmarks/bigbench/queryResults/qxx_hive_${BIG_BENCH_BENCHMARK_PHASE}_${BIG_BENCH_STREAM_NUMBER}_result` 两个文件，如果一样，则验证通过，否则验证失败。</code></pre><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> diff -q <span class="string">"<span class="variable">$VALIDATION_RESULTS_FILENAME</span>"</span> &lt;(hadoop fs -cat <span class="string">"<span class="variable">$RESULT_DIR</span>/*"</span>)</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Validation of <span class="variable">$VALIDATION_RESULTS_FILENAME</span> passed: Query returned correct results"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Validation of <span class="variable">$VALIDATION_RESULTS_FILENAME</span> failed: Query returned incorrect results"</span></span><br><span class="line">	VALIDATION_PASSED=<span class="string">"0"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p><strong>SF为1时(-f 1)，用上面的方法比较，SF不为1（&gt;1）时,只要hdfs上的结果表中行数大于等于1即验证通过</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> [ `hadoop fs -cat <span class="string">"<span class="variable">$RESULT_DIR</span>/*"</span> | head -n 10 | wc <span class="_">-l</span>` -ge 1 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Validation passed: Query returned results"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">"Validation failed: Query did not return results"</span></span><br><span class="line">	<span class="built_in">return</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<h3 id="refreshMetastore"><a href="#refreshMetastore" class="headerlink" title="refreshMetastore"></a>refreshMetastore</h3><pre><code>1. 调用 `$BENCH_MARK_HOME/engines/hive/refresh/` 目录下的 `hiveRefreshCreateLoad.sql` 脚本
2. `hiveRefreshCreateLoad.sql` 将hdfs上 `/user/root/benchmarks/bigbench/data_refresh/` 目录下每个表数据插入外部临时表
3. 外部临时表再将每个表的数据插入Hive数据库对应的表中</code></pre><p><code>hiveRefreshCreateLoad.sql</code> 将hdfs上 <code>/user/root/benchmarks/bigbench/data_refresh/</code> 目录下每个表数据插入外部临时表</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;</span><br><span class="line">  ( c_customer_sk             <span class="built_in">bigint</span>              <span class="comment">--not null</span></span><br><span class="line">  , c_customer_id             <span class="keyword">string</span>              <span class="comment">--not null</span></span><br><span class="line">  , c_current_cdemo_sk        <span class="built_in">bigint</span></span><br><span class="line">  , c_current_hdemo_sk        <span class="built_in">bigint</span></span><br><span class="line">  , c_current_addr_sk         <span class="built_in">bigint</span></span><br><span class="line">  , c_first_shipto_date_sk    <span class="built_in">bigint</span></span><br><span class="line">  , c_first_sales_date_sk     <span class="built_in">bigint</span></span><br><span class="line">  , c_salutation              <span class="keyword">string</span></span><br><span class="line">  , c_first_name              <span class="keyword">string</span></span><br><span class="line">  , c_last_name               <span class="keyword">string</span></span><br><span class="line">  , c_preferred_cust_flag     <span class="keyword">string</span></span><br><span class="line">  , c_birth_day               <span class="built_in">int</span></span><br><span class="line">  , c_birth_month             <span class="built_in">int</span></span><br><span class="line">  , c_birth_year              <span class="built_in">int</span></span><br><span class="line">  , c_birth_country           <span class="keyword">string</span></span><br><span class="line">  , c_login                   <span class="keyword">string</span></span><br><span class="line">  , c_email_address           <span class="keyword">string</span></span><br><span class="line">  , c_last_review_date        <span class="keyword">string</span></span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'$&#123;hiveconf:fieldDelimiter&#125;'</span></span><br><span class="line">  <span class="keyword">STORED</span> <span class="keyword">AS</span> TEXTFILE LOCATION <span class="string">'$&#123;hiveconf:hdfsDataPath&#125;/$&#123;hiveconf:customerTableName&#125;'</span></span><br><span class="line">;</span><br><span class="line"><span class="keyword">set</span> hdfsDataPath=$&#123;env:BIG_BENCH_HDFS_ABSOLUTE_REFRESH_DATA_DIR&#125;;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">外部临时表再将每个表的数据插入Hive数据库对应的表中</span><br><span class="line"></span><br><span class="line">```sql</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> $&#123;hiveconf:customerTableName&#125;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> $&#123;hiveconf:customerTableName&#125;$&#123;hiveconf:temporaryTableSuffix&#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p>在测试之前会先用PDGF（并行数据生成框架）生成数据。指定Scale Factor为1（1GB），生成以下共23张表。以下是每张表的建表语句及每张表里的某一条记录。</p>
<h3 id="23张表"><a href="#23张表" class="headerlink" title="23张表"></a>23张表</h3><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show tables;</span><br><span class="line">OK</span><br><span class="line">customer</span><br><span class="line">customer_address</span><br><span class="line">customer_demographics</span><br><span class="line">date_dim</span><br><span class="line">household_demographics</span><br><span class="line">income_band</span><br><span class="line">inventory</span><br><span class="line">item</span><br><span class="line">item_marketprices</span><br><span class="line">product_reviews</span><br><span class="line">promotion</span><br><span class="line">reason</span><br><span class="line">ship_mode</span><br><span class="line">store</span><br><span class="line">store_returns</span><br><span class="line">store_sales</span><br><span class="line">time_dim</span><br><span class="line">warehouse</span><br><span class="line">web_clickstreams</span><br><span class="line">web_page</span><br><span class="line">web_returns</span><br><span class="line">web_sales</span><br><span class="line">web_site</span><br><span class="line">Time taken: 0.017 seconds, Fetched: 23 row(s)</span><br></pre></td></tr></table></figure>

<h3 id="customer-（99000行）4-03MB"><a href="#customer-（99000行）4-03MB" class="headerlink" title="customer （99000行）4.03MB"></a>customer （99000行）4.03MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table customer;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`customer`</span>(</span><br><span class="line"> <span class="string">`c_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`c_customer_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_current_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`c_current_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`c_current_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`c_first_shipto_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`c_first_sales_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`c_salutation`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_first_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_last_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_preferred_cust_flag`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_birth_day`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`c_birth_month`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`c_birth_year`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`c_birth_country`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_login`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_email_address`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`c_last_review_date`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/customer\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'99000\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'88084062\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'4221267\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167154\')</span></span><br><span class="line"><span class="string">Time taken: 0.116 seconds, Fetched: 34 row(s)</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 AAAAAAAAAAAAAAAA 1824793 3203 2555 28776 14690 Ms. Marisa Harrington N 17 4 1988 UNITED ARAB EMIRATES RRCyuY3XfE3a Marisa.Harrington@lawyer.com 	gdMmGdU9</span><br></pre></td></tr></table></figure>

<h3 id="customer-address（49500行）-0-92MB"><a href="#customer-address（49500行）-0-92MB" class="headerlink" title="customer_address（49500行） 0.92MB"></a>customer_address（49500行） 0.92MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table customer_address;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`customer_address`</span>(</span><br><span class="line"> <span class="string">`ca_address_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ca_address_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_street_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_street_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_street_type`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_suite_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_city`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_county`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_state`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_zip`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_country`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`ca_gmt_offset`</span> <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ca_location_type`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/customer_address\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'49500\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'55836000\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'966548\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167160\')</span></span><br><span class="line"><span class="string">Time taken: 0.043 seconds, Fetched: 29 row(s)</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">6187 AAAAAAAAAAAAAJDZ 536 6th Lake Drive UKL8bE5C Lowell Brule County SD 18464 United States -6 apartment</span><br></pre></td></tr></table></figure>

<h3 id="customer-demographics-19200800行）6-84MB"><a href="#customer-demographics-19200800行）6-84MB" class="headerlink" title="customer_demographics (19200800行）6.84MB"></a>customer_demographics (19200800行）6.84MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table customer_demographics;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`customer_demographics`</span>(</span><br><span class="line"> <span class="string">`cd_demo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`cd_gender`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`cd_marital_status`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`cd_education_status`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`cd_purchase_estimate`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`cd_credit_rating`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`cd_dep_count`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`cd_dep_employed_count`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`cd_dep_college_count`</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/customer_demographics\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'1\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'1920800\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'718371044\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'7167503\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167169\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 F 	U Primary 6000 Good 0 5 0</span><br></pre></td></tr></table></figure>

<h3 id="date-dim-（109573行）-1-67MB"><a href="#date-dim-（109573行）-1-67MB" class="headerlink" title="date_dim （109573行） 1.67MB"></a>date_dim （109573行） 1.67MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table date_dim;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`date_dim`</span>(</span><br><span class="line"> <span class="string">`d_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`d_date_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_month_seq`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_week_seq`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_quarter_seq`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_year`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_dow`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_moy`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_dom`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_qoy`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_fy_year`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_fy_quarter_seq`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_fy_week_seq`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_day_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_quarter_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_holiday`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_weekend`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_following_holiday`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_first_dom`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_last_dom`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_same_day_ly`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_same_day_lq`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`d_current_day`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_current_week`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_current_month`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_current_quarter`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`d_current_year`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/date_dim\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'1\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'109573\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'123050479\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'1748707\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167172\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 AAAAAAAAAAAAAAAA 1900-01-01 0 0 0 1900 1 1 1 1 1900 0 0 Monday 1900Q1 Y 	N 	N 2448812 2458802 2472542 2420941 N 	N 	NN 	N</span><br></pre></td></tr></table></figure>

<h3 id="household-demographics-（7200行）-14-31KB"><a href="#household-demographics-（7200行）-14-31KB" class="headerlink" title="household_demographics （7200行） 14.31KB"></a>household_demographics （7200行） 14.31KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table household_demographics;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`household_demographics`</span>(</span><br><span class="line"> <span class="string">`hd_demo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`hd_income_band_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`hd_buy_potential`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`hd_dep_count`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`hd_vehicle_count`</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/household_demographics\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'1\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'7200\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'835168\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'14655\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167173\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 3 1001-5000 0 0</span><br></pre></td></tr></table></figure>

<h3 id="income-band-（20行）-754B"><a href="#income-band-（20行）-754B" class="headerlink" title="income_band （20行） 754B"></a>income_band （20行） 754B</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table income_band;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`income_band`</span>(</span><br><span class="line"> <span class="string">`ib_income_band_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ib_lower_bound`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`ib_upper_bound`</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/income_band\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'20\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'320\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'754\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167179\')</span></span><br><span class="line"><span class="string">Time taken: 0.032 seconds, Fetched: 19 row(s)</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 1 10000</span><br></pre></td></tr></table></figure>

<h3 id="inventory-（23255100行）-34-55MB"><a href="#inventory-（23255100行）-34-55MB" class="headerlink" title="inventory （23255100行） 34.55MB"></a>inventory （23255100行） 34.55MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table inventory;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`inventory`</span>(</span><br><span class="line"> <span class="string">`inv_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`inv_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`inv_warehouse_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`inv_quantity_on_hand`</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/inventory\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'3\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'23255100\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'651118804\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'36234106\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167235\')</span></span><br><span class="line"><span class="string">Time taken: 0.031 seconds, Fetched: 20 row(s)</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">36890 0 0 503</span><br></pre></td></tr></table></figure>

<h3 id="item-（17820行）-2-36MB"><a href="#item-（17820行）-2-36MB" class="headerlink" title="item （17820行） 2.36MB"></a>item （17820行） 2.36MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table item;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`item`</span>(</span><br><span class="line"> <span class="string">`i_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`i_item_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_rec_start_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_rec_end_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_item_desc`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_current_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`i_wholesale_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`i_brand_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`i_brand`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_class_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`i_class`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_category_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`i_category`</span> strong,</span><br><span class="line"> <span class="string">`i_manufact_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`i_manufact`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_size`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_formulation`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_color`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_units`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_container`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`i_manager_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`i_product_name`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/item\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'1\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'17820\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'31238428\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'2472973\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167181\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0 AAAAAAAAAAAAAAAA 2000-01-14 quickly even dinos beneath the frays must have to boost boldly careful bold escapades: stealthily even forges over the dependencies integrate always past the quiet sly decoys-- notornis sol 72.29 64.96 3898712 71TS7NSbvH1YbdiQMG6ttBHKAljiNoIRB 1 Fan Shop 9 Sports &amp; Outdoors 995 2VOxvrIWwlJQTSk6 small 99Ee1r6uFbZSSClAX3 dodger Oz Unknown 18 8m9n5Q7T33DNWidoA6nWlg6ydmpA1SKOoOJLXiLVb</span><br></pre></td></tr></table></figure>

<h3 id="item-marketprices-（89100行）-0-63MB"><a href="#item-marketprices-（89100行）-0-63MB" class="headerlink" title="item_marketprices （89100行） 0.63MB"></a>item_marketprices （89100行） 0.63MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table item_marketprices;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`item_marketprices`</span>(</span><br><span class="line"> <span class="string">`imp_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`imp_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`imp_competitor`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`imp_competitor_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`imp_start_date`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`imp_end_date`</span> <span class="built_in">bigint</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/item_marketprices\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'89100\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'21736912\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'657024\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167275\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5 4737 AAAAAAAAAAAAAAIN 66.4 36890 36958</span><br></pre></td></tr></table></figure>

<h3 id="product-reviews-（89991行）-24-36MB"><a href="#product-reviews-（89991行）-24-36MB" class="headerlink" title="product_reviews （89991行） 24.36MB"></a>product_reviews （89991行） 24.36MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table product_reviews;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`product_reviews`</span>(</span><br><span class="line"> <span class="string">`pr_review_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`pr_review_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`pr_review_time`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`pr_review_rating`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`pr_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`pr_user_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`pr_order_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`pr_review_content`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/product_reviews\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'89991\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'79597043\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'25546821\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167305\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">4 2004-02-25 21:43:07 1 3683 88783 41241 Had to offset the praise handed down by so many years is probably the result of some sin committed (obviously so grievous don\&apos;t &quot;get&quot; it. Why all the original artwork by Stephen Gammel.</span><br></pre></td></tr></table></figure>

<h3 id="promotion-（300行）-15-83KB"><a href="#promotion-（300行）-15-83KB" class="headerlink" title="promotion （300行） 15.83KB"></a>promotion （300行） 15.83KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table promotion;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`promotion`</span>(</span><br><span class="line"> <span class="string">`p_promo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`p_promo_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_start_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`p_end_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`p_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`p_cost`</span> <span class="built_in">decimal</span>(<span class="number">15</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`p_response_target`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`p_promo_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_dmail`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_email`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_catalog`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_tv`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_radio`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_press`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_event`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_demo`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_channel_details`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_purpose`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`p_discount_active`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/promotion\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'300\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'404926\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'16204\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167186\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">7 AAAAAAAAAAAAAAAH 94455 108529 13511 427.76 1 bar 	YN 	Y 	N 	N 	N 	N 	N 	blithe grouches past the blithe quick epitaphs print rut Unknown N</span><br></pre></td></tr></table></figure>

<h3 id="reason-（35行）-3-17KB"><a href="#reason-（35行）-3-17KB" class="headerlink" title="reason （35行） 3.17KB"></a>reason （35行） 3.17KB</h3><p>建表语句:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table reason;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`reason`</span>(</span><br><span class="line"> <span class="string">`r_reason_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`r_reason_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`r_reason_desc`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/reason\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'35\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'9027\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'3240\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167190\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5 uy 	busily sly excuses hang: slow braids to the daring somas was toward the epitaphs-- gifts betw</span><br></pre></td></tr></table></figure>

<h3 id="ship-mode-（20行）-2-93KB"><a href="#ship-mode-（20行）-2-93KB" class="headerlink" title="ship_mode （20行） 2.93KB"></a>ship_mode （20行） 2.93KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table ship_mode;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`ship_mode`</span>(</span><br><span class="line"> <span class="string">`sm_ship_mode_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sm_ship_mode_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`sm_type`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`sm_code`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`sm_carrier`</span> strong,</span><br><span class="line"> <span class="string">`sm_contract`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/ship_mode\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'20\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'9576\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'3001\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167196\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">12 wGyozLRZ3uL 	iCTZsMlNzsQ 	cBRc FlWM9v tm0ehuQ2</span><br></pre></td></tr></table></figure>

<h3 id="store-（12行）-8-03KB"><a href="#store-（12行）-8-03KB" class="headerlink" title="store （12行） 8.03KB"></a>store （12行） 8.03KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table store;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`store`</span>(</span><br><span class="line"> <span class="string">`s_store_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`s_store_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_rec_start_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_rec_end_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_closed_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`s_store_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_number_employees`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`s_floor_space`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`s_hours`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_manager`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_market_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`s_geography_class`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_market_desc`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_market_manager`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_division_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`s_division_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_company_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`s_company_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_street_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_street_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_street_type`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_suite_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_city`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_county`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_state`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_zip`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_country`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`s_gmt_offset`</span> <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`s_tax_precentage`</span> <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/store\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'12\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'25962\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'8214\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167201\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">10 AAAAAAAAAAAAAAAK 2000-11-01 6235 Avalon 254 6468537 8AM-12AM Michael Barlow 6 Unknown final sly gifts by the even final dependencies x-ray under the fluffy Barry Shaw 1 Unknown1Unknown 993 Mill Pkwy aQV Cold Springs Cumberland County TN 95692 United States -5 0.03</span><br></pre></td></tr></table></figure>

<h3 id="store-returns-37902行）-1-19MB"><a href="#store-returns-37902行）-1-19MB" class="headerlink" title="store_returns (37902行） 1.19MB"></a>store_returns (37902行） 1.19MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table store_returns;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`store_returns`</span>(</span><br><span class="line"> <span class="string">`sr_returned_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_return_time_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_store_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_reason_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_ticket_number`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`sr_return_quantity`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`sr_return_amt`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_return_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_return_amt_inc_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_fee`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_return_ship_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_refunded_cash`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_reversed_charge`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_store_credit`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`sr_net_loss`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/store_returns\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'37902\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'41388272\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'1250563\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167251\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">37375 38182 11520 7640 242073 6754 25731 2 22 20293 33 1990.89 119.45 2110.34 34.14 2433.41 477.81 559.84 953.24 2672.31</span><br></pre></td></tr></table></figure>

<h3 id="store-sales-（667579行）-23-49MB"><a href="#store-sales-（667579行）-23-49MB" class="headerlink" title="store_sales （667579行） 23.49MB"></a>store_sales （667579行） 23.49MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table store_sales;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`store_sales`</span>(</span><br><span class="line"> <span class="string">`ss_sold_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_sold_time_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_store_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_promo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_ticket_number`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ss_quantity`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`ss_wholesale_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_list_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_sales_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_ext_discount_amt`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_ext_sales_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_ext_wholesale_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_ext_list_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_ext_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_coupon_amt`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_net_paid`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_net_paid_inc_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ss_net_profit`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/store_sales\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'667579\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'953293700\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'24629162\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167245\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">37115 20244 16481 98676 1211207 5239 37107 9 38 11138 93 56.47 82.45 36.28 4293.81 3374.04 5251.71 7667.85 101.22 0 3374.04 3475.26 -1877.67</span><br></pre></td></tr></table></figure>

<h3 id="time-dim-（86400行）-219-49KB"><a href="#time-dim-（86400行）-219-49KB" class="headerlink" title="time_dim （86400行） 219.49KB"></a>time_dim （86400行） 219.49KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table time_dim;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`time_dim`</span>(</span><br><span class="line"> <span class="string">`t_time_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`t_time_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`t_time`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`t_hour`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`t_minute`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`t_second`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`t_am_pm`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`t_shift`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`t_sub_shift`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`t_meal_time`</span> <span class="keyword">string</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/time_dim\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'1\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'86400\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'41040000\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'224757\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167202\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2 AAAAAAAAAAAAAAAC 2 0 0 2 AM 	third 	night</span><br></pre></td></tr></table></figure>

<h3 id="warehouse-（5行）-1-94KB"><a href="#warehouse-（5行）-1-94KB" class="headerlink" title="warehouse （5行） 1.94KB"></a>warehouse （5行） 1.94KB</h3><p>建表语句:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table warehouse;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`warehouse`</span>(</span><br><span class="line"> <span class="string">`w_warehouse_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`w_warehouse_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_warehouse_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_warehouse_sq_ft`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`w_street_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_street_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_street_type`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_suite_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_city`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_county`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_state`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_zip`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_country`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`w_gmt_offset`</span> <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/warehouse\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'5\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'5695\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'1980\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167204\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 AAAAAAAAAAAAAAAB 	frets would sleep 845707 181 9th 13thCourt kQ Sherwood Forest Teton County WY 87891 United States -7</span><br></pre></td></tr></table></figure>

<h3 id="web-clickstreams-（6770550行）-34-11MB"><a href="#web-clickstreams-（6770550行）-34-11MB" class="headerlink" title="web_clickstreams （6770550行） 34.11MB"></a>web_clickstreams （6770550行） 34.11MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table web_clickstreams;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`web_clickstreams`</span>(</span><br><span class="line"> <span class="string">`wcs_click_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wcs_click_time_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wcs_sales_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wcs_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wcs_web_page_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wcs_user_sk`</span> <span class="built_in">bigint</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/web_clickstreams\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'6770550\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'253337416\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'35768476\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167298\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">36890 27089 NULL 15465 47 NULL</span><br></pre></td></tr></table></figure>

<h3 id="web-page-（60行）-6-81KB"><a href="#web-page-（60行）-6-81KB" class="headerlink" title="web_page （60行） 6.81KB"></a>web_page （60行） 6.81KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table web_page;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`web_page`</span>(</span><br><span class="line"> <span class="string">`wp_web_page_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wp_web_page_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`wp_rec_start_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`wp_rec_end_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`wp_creation_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wp_access_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wp_autogen_flag`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`wp_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wp_url`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`wp_type`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`wp_char_count`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`wp_link_count`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`wp_image_count`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`wp_max_ad_count`</span> <span class="built_in">int</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/web_page\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'60\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'38763\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'6969\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167215\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">24 AAAAAAAAAAAAAAAY 2000-12-19 38819 69008 0 44446 http://www.C8jdri37RmtbDNeFnXjmYbyBPzeO4WWK9pVYP6xtBJbaQ5yIj4s.com 	feedback	4340 	23 	5 	2</span><br></pre></td></tr></table></figure>

<h3 id="web-returns-（38487行）-1-40MB"><a href="#web-returns-（38487行）-1-40MB" class="headerlink" title="web_returns （38487行） 1.40MB"></a>web_returns （38487行） 1.40MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table web_returns;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`web_returns`</span>(</span><br><span class="line"> <span class="string">`wr_returned_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_returned_time_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_refunded_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_refunded_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_refunded_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_refunded_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_returning_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_returning_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_returning_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_returning_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_web_page_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_reason_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_order_number`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`wr_return_quantity`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`wr_return_amt`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_return_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_return_amt_inc_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_fee`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_return_ship_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_refunded_cash`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_reversed_charge`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_account_credit`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`wr_net_loss`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/web_returns\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'38487\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'43257220\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'1471571\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167269\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">38952 68126 9590 52948 893223 2020 6942 52948 893223 2020 6942 32 13 63444 33 626.0125.04 651.05 18.74 958.4 244.14 286.4 95.47 1008.48</span><br></pre></td></tr></table></figure>

<h3 id="web-sales-（668052行）-32-99MB"><a href="#web-sales-（668052行）-32-99MB" class="headerlink" title="web_sales （668052行） 32.99MB"></a>web_sales （668052行） 32.99MB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table web_sales;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`web_sales`</span>(</span><br><span class="line"> <span class="string">`ws_sold_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_sold_time_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_ship_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_item_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_bill_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_bill_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_bill_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_bill_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_ship_customer_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_ship_cdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_ship_hdemo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_ship_addr_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_web_page_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_web_site_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_ship_mode_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_warehouse_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_promo_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_order_number`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`ws_quantity`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`ws_wholesale_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_list_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_sales_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_ext_discount_amt`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_ext_sales_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_ext_wholesale_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_ext_list_price`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_ext_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_coupon_amt`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_ext_ship_cost`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_net_paid`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_net_paid_inc_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_net_paid_inc_ship`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_net_paid_inc_ship_tax`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`ws_net_profit`</span> <span class="built_in">decimal</span>(<span class="number">7</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/web_sales\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'668052\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'1221174888\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'34585166\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167263\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">36890 26789 36993 794 85457 380790 2436 42649 29934 1583844 5251 525 2 14 1 3 120 0 93 32.62 81.22 59.29 2039.49 5513.97 3033.66 7553.46 330.84 0 1661.76 5513.97 5844.81 7175.73 7506.57 2480.31</span><br></pre></td></tr></table></figure>

<h3 id="web-site-（30行）10-31KB"><a href="#web-site-（30行）10-31KB" class="headerlink" title="web_site （30行）10.31KB"></a>web_site （30行）10.31KB</h3><p>建表语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">hive&gt; show create table web_site;</span><br><span class="line">OK</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`web_site`</span>(</span><br><span class="line"> <span class="string">`web_site_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`web_site_id`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_rec_start_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_rec_end_date`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_open_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`web_close_date_sk`</span> <span class="built_in">bigint</span>,</span><br><span class="line"> <span class="string">`web_class`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_manager`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_mkt_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`web_mkt_class`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_mkt_desc`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_market_manager`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_company_id`</span> <span class="built_in">int</span>,</span><br><span class="line"> <span class="string">`web_company_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_street_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_street_name`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_street_type`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_suite_number`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_city`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_county`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_state`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_zip`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_country`</span> <span class="keyword">string</span>,</span><br><span class="line"> <span class="string">`web_gmt_offset`</span> <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>),</span><br><span class="line"> <span class="string">`web_tax_percentage`</span> <span class="built_in">decimal</span>(<span class="number">5</span>,<span class="number">2</span>))</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> SERDE</span><br><span class="line"> \<span class="string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde\'</span></span><br><span class="line"><span class="string">STORED AS INPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat\'</span></span><br><span class="line"><span class="string">OUTPUTFORMAT</span></span><br><span class="line"><span class="string"> \'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat\'</span></span><br><span class="line"><span class="string">LOCATION</span></span><br><span class="line"><span class="string"> \'hdfs://mycluster/usr/hive/warehouse/bigbench.db/web_site\'</span></span><br><span class="line"><span class="string">TBLPROPERTIES (</span></span><br><span class="line"><span class="string"> \'COLUMN_STATS_ACCURATE\'=\'true\',</span></span><br><span class="line"><span class="string"> \'numFiles\'=\'2\',</span></span><br><span class="line"><span class="string"> \'numRows\'=\'30\',</span></span><br><span class="line"><span class="string"> \'rawDataSize\'=\'62832\',</span></span><br><span class="line"><span class="string"> \'totalSize\'=\'10554\',</span></span><br><span class="line"><span class="string"> \'transient_lastDdlTime\'=\'1473167210\')</span></span><br></pre></td></tr></table></figure>

<p>某一行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2 AAAAAAAAAAAAAAAC 2002-07-17 site_0 16450 91500 Unknown Gregory George 1 sheaves despite the quietly sly asymp 	thin enticing frets except the sometimes final courts might promise blithe dino Frank Hernandez 1 ese 17 5th Ave EbDxJVL Georgetown Guadalupe County TX 75435 United States -6 0.01</span><br></pre></td></tr></table></figure>

<p><img src="http://upload-images.jianshu.io/upload_images/1752522-2e4b0e5141927479.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="欢迎关注公众号: FullStackPlan 获取更多干货"></p>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="/js/vdonate.js"></script>
<script>
var a = new Donate({
  title: '欢迎打赏~', // 可选参数，打赏标题
  btnText: '打赏支持', // 可选参数，打赏按钮文字
  el: document.getElementById('donation_div'),
  wechatImage: 'http://upload-images.jianshu.io/upload_images/1752522-36613fdaddaabe1e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240',
  alipayImage: 'http://upload-images.jianshu.io/upload_images/1752522-e25c8a72b44c418e.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240'
});
</script>
      
      
        
	<div id="comment">
		<!-- 来必力City版安装代码 -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQ4MS82MDQ5">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
		</div>
		<!-- City版安装代码已完成 -->
	</div>



      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TPCx-BB/">TPCx-BB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/基准测试/">基准测试</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/大数据/">大数据</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/03/11/Python日志模块示例/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">
        
          Python日志模块示例
        
      </div>
    </a>
  
  
    <a href="/2017/03/11/Stack Overflow上关于Java Collections的几个常见问题/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">关于Java Collections的几个常见问题</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#代码结构"><span class="nav-number">1.</span> <span class="nav-text">代码结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据生成"><span class="nav-number">2.</span> <span class="nav-text">数据生成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#执行流程"><span class="nav-number">3.</span> <span class="nav-text">执行流程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#bigBench"><span class="nav-number">3.1.</span> <span class="nav-text">bigBench</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runBenchmark"><span class="nav-number">3.2.</span> <span class="nav-text">runBenchmark</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runModule"><span class="nav-number">3.3.</span> <span class="nav-text">runModule()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runCmd"><span class="nav-number">3.4.</span> <span class="nav-text">runCmd()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#getQueryList"><span class="nav-number">3.5.</span> <span class="nav-text">getQueryList()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#parseEnvironment"><span class="nav-number">3.6.</span> <span class="nav-text">parseEnvironment()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#run"><span class="nav-number">3.7.</span> <span class="nav-text">run()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#benchmarkPhase-和-module-对应关系"><span class="nav-number">3.8.</span> <span class="nav-text">benchmarkPhase 和 module 对应关系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#程序调用流程"><span class="nav-number">3.9.</span> <span class="nav-text">程序调用流程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#module"><span class="nav-number">4.</span> <span class="nav-text">module</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cleanAll"><span class="nav-number">4.1.</span> <span class="nav-text">cleanAll</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cleanQuery"><span class="nav-number">4.2.</span> <span class="nav-text">cleanQuery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cleanMetastore"><span class="nav-number">4.3.</span> <span class="nav-text">cleanMetastore</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cleanData"><span class="nav-number">4.4.</span> <span class="nav-text">cleanData</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#populateMetastore"><span class="nav-number">4.5.</span> <span class="nav-text">populateMetastore</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runQuery"><span class="nav-number">4.6.</span> <span class="nav-text">runQuery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#validateQuery"><span class="nav-number">4.7.</span> <span class="nav-text">validateQuery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#refreshMetastore"><span class="nav-number">4.8.</span> <span class="nav-text">refreshMetastore</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录"><span class="nav-number">5.</span> <span class="nav-text">附录</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#23张表"><span class="nav-number">5.1.</span> <span class="nav-text">23张表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#customer-（99000行）4-03MB"><span class="nav-number">5.2.</span> <span class="nav-text">customer （99000行）4.03MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#customer-address（49500行）-0-92MB"><span class="nav-number">5.3.</span> <span class="nav-text">customer_address（49500行） 0.92MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#customer-demographics-19200800行）6-84MB"><span class="nav-number">5.4.</span> <span class="nav-text">customer_demographics (19200800行）6.84MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#date-dim-（109573行）-1-67MB"><span class="nav-number">5.5.</span> <span class="nav-text">date_dim （109573行） 1.67MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#household-demographics-（7200行）-14-31KB"><span class="nav-number">5.6.</span> <span class="nav-text">household_demographics （7200行） 14.31KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#income-band-（20行）-754B"><span class="nav-number">5.7.</span> <span class="nav-text">income_band （20行） 754B</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inventory-（23255100行）-34-55MB"><span class="nav-number">5.8.</span> <span class="nav-text">inventory （23255100行） 34.55MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#item-（17820行）-2-36MB"><span class="nav-number">5.9.</span> <span class="nav-text">item （17820行） 2.36MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#item-marketprices-（89100行）-0-63MB"><span class="nav-number">5.10.</span> <span class="nav-text">item_marketprices （89100行） 0.63MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#product-reviews-（89991行）-24-36MB"><span class="nav-number">5.11.</span> <span class="nav-text">product_reviews （89991行） 24.36MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#promotion-（300行）-15-83KB"><span class="nav-number">5.12.</span> <span class="nav-text">promotion （300行） 15.83KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reason-（35行）-3-17KB"><span class="nav-number">5.13.</span> <span class="nav-text">reason （35行） 3.17KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ship-mode-（20行）-2-93KB"><span class="nav-number">5.14.</span> <span class="nav-text">ship_mode （20行） 2.93KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#store-（12行）-8-03KB"><span class="nav-number">5.15.</span> <span class="nav-text">store （12行） 8.03KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#store-returns-37902行）-1-19MB"><span class="nav-number">5.16.</span> <span class="nav-text">store_returns (37902行） 1.19MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#store-sales-（667579行）-23-49MB"><span class="nav-number">5.17.</span> <span class="nav-text">store_sales （667579行） 23.49MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#time-dim-（86400行）-219-49KB"><span class="nav-number">5.18.</span> <span class="nav-text">time_dim （86400行） 219.49KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#warehouse-（5行）-1-94KB"><span class="nav-number">5.19.</span> <span class="nav-text">warehouse （5行） 1.94KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-clickstreams-（6770550行）-34-11MB"><span class="nav-number">5.20.</span> <span class="nav-text">web_clickstreams （6770550行） 34.11MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-page-（60行）-6-81KB"><span class="nav-number">5.21.</span> <span class="nav-text">web_page （60行） 6.81KB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-returns-（38487行）-1-40MB"><span class="nav-number">5.22.</span> <span class="nav-text">web_returns （38487行） 1.40MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-sales-（668052行）-32-99MB"><span class="nav-number">5.23.</span> <span class="nav-text">web_sales （668052行） 32.99MB</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web-site-（30行）10-31KB"><span class="nav-number">5.24.</span> <span class="nav-text">web_site （30行）10.31KB</span></a></li></ol></li></ol>
    
    </div>
  </aside>
</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p id="copyRightEn">Copyright &copy; 2016 - 2019 LBD&#39;s Blog All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				访客数 : <span id="busuanzi_value_site_uv"></span> |  
				访问量 : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">Categories</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>



  <script src="/js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            LBD&#39;s Blog
          </div>
          <div class="panel-body">
            Copyright © 2019 LBD All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>