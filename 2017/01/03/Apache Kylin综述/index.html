<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="大数据,Kylin,NoSQL," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="article">
<meta property="og:title" content="Apache Kylin综述">
<meta property="og:url" content="http://linbingdong.com/2017/01/03/Apache Kylin综述/index.html">
<meta property="og:site_name" content="LBD's Blog">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-b24bc950f45d2666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-063ca7dea83ded85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-1e80e8a1417a6d0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-06ce55c3c869f24f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-3ef68656c02dce96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-fdd4b9c3e735bc2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-2b88a5bd73284efe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-1e771d4d6cb92a32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-2d01c3338ea5556a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-1118eca4f5988933.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-5068797db1e9470f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-6fca7a6cc0e11ce4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-94e857406c491ae5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-7b7339f8f56be4d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-e276d255006fe654.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-7c5019c7e84cddb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-546162bcaa06d6cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-ef4a4bd304401b15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-086d01240e72f0cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-3942e07573e7cf1d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-dfbc366e565347b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-95d11c3255835a78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-b9610e117aa519da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-0b63232b1ea37c37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-7ddf65cb11784072.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-a138c2bc9fd67644.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-79cbf2f5f97188d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-eacdf1f9d1722d0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-22be16b2121f50c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-71849088c33324a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-87a6469b386f9318.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-76862da06fef99b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-a99c1fd6b184f610.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-aa6a2267fc5259cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-7f9d17cfa65272bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1752522-a46c1e5ff55cea0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-01-03T01:32:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache Kylin综述">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1752522-b24bc950f45d2666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":30},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://linbingdong.com/2017/01/03/Apache Kylin综述/"/>





  <title> Apache Kylin综述 | LBD's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">LBD's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <h1 class="site-subtitle" itemprop="description">大数据与分布式</h1>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://linbingdong.com/2017/01/03/Apache Kylin综述/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="LBD">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="LBD's Blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="LBD's Blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                Apache Kylin综述
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-03T09:28:17+08:00">
                2017-01-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kylin/" itemprop="url" rel="index">
                    <span itemprop="name">Kylin</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/01/03/Apache Kylin综述/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/03/Apache Kylin综述/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://upload-images.jianshu.io/upload_images/1752522-b24bc950f45d2666.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<a id="more"></a>
<h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1. 简介"></a>1. 简介</h2><h3 id="1-1-Kylin概览"><a href="#1-1-Kylin概览" class="headerlink" title="1.1 Kylin概览"></a>1.1 Kylin概览</h3><p>Apache Kylin是一个开源的<strong>分布式分析引擎</strong>，提供Hadoop之上的SQL查询接口及多维分析（OLAP）能力（可以把Kylin定义为<strong>OLAP on Hadoop</strong>）。Apache Kylin于2015年11月正式毕业成为Apache基金会(ASF) 顶级项目，是<strong>第一个由中国团队完整贡献到Apache的顶级项目</strong>。</p>
<p>Apache Kyiln构建在Hadoop等分布式计算平台之上，充分利用了<strong>MapReduce</strong>的并行处理能力和可扩展基础设施，高效地处理超大规模数据，可根据数据的规模实现架构的可伸缩。Apache Kylin作为OLAP引擎包含了从<strong>数据源（Hive／Kafka等）</strong>获取源数据，基于MapReduce<strong>构建多维立方体(Cube)</strong>，并充分利用<strong>HBase</strong>的列式特性来分布式的<strong>存储立方体数据</strong>，提供标准SQL解析与查询优化，以及ODBC／JDBC驱动及REST API等多个模块。<strong>可插拔</strong>的灵活架构，允许支持更多的数据源接入Kylin，也支持采用其它技术作为存储引擎。</p>
<p>大多数的Hadoop分析工具和SQL是友好的，所以Apache Kylin拥有SQL接口这一点就显得尤为重要。Kylin用的SQL解析器是开源的Apache Calcite，支持几乎所有的SQL标准。Hive用的也是Calcite。</p>
<p>Kylin和其它SQL ON Hadoop的主要区别是<strong>预计算（离线计算）</strong>。用户在使用之前先选择一个Hive Table的集合，然后在这个基础上做一个离线的Cube构建，Cube构建完了之后就可以做SQL查询了。</p>
<p>用离线计算来代替在线计算，在离线过程当中把复杂的、计算量很大的工作做完，在线计算量就会变小，就可以更快的返回查询结果。通过这种方式，Kylin可以有更少的计算量，更高的吞吐量。</p>
<p>Apache Kylin开源一年左右的时间，已经在国内国际多个公司被采用作为大数据分析平台的关键组成部分，包括eBay、Expedia、Exponential、百度、京东、美团、明略数据、网易、中国移动、唯品会、58同城等。</p>
<h3 id="1-2-Kylin架构"><a href="#1-2-Kylin架构" class="headerlink" title="1.2 Kylin架构"></a>1.2 Kylin架构</h3><p><img src="http://upload-images.jianshu.io/upload_images/1752522-063ca7dea83ded85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="kylin_arch1"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-1e80e8a1417a6d0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="kylin_arch2"></p>
<p>Apache Kylin包含以下核心组件：</p>
<blockquote>
<p><strong>元数据引擎</strong>：包含模型设计，Cube设计，表结构同步，数据采样分析等。支持层级维度、联合维度、可推导维度等维度降维优化技术，避免Cube数据膨胀。支持多种字典编码算法，实现数据高效压缩存储。</p>
<p><strong>Job引擎</strong>：用于向Hadoop平台提交Cube构建任务，支持全表构建、增量构建、流式构建等多种构建机制，支持Cube自动合并等IO优化手段，内置多种Cube预计算算法以及数十个Job性能调优参数，充分发挥MapReduce的计算能力。</p>
<p><strong>存储引擎</strong>：将关系型表的源数据，经过预计算，保存在支持高通量大并发快速读写的键值数据库HBase中，充分利用HBase高效的Fuzzy Key过滤技术和Coprocessor并行处理技术，以并行计算方式检索数据，支持查询逻辑下压存储节点，实现了数据检索问题由O(N)的计算复杂度降低为O(1)。</p>
<p><strong>查询引擎</strong>：构建在Apache Calcite语法解析器之上，支持JDBC／ODBC／REST等多种协议和接口，支持ANSI SQL，包含绝大多数SQL函数，提供自定义计算函数机制，与Tableau等主流BI工具完美对接。</p>
<p><strong>Web管理端</strong>：内置用户友好的交互界面，支持向导式的模型构建，直观的任务监控与告警，以及用户权限管理。</p>
</blockquote>
<h3 id="1-3-Kylin特点"><a href="#1-3-Kylin特点" class="headerlink" title="1.3 Kylin特点"></a>1.3 Kylin特点</h3><ul>
<li><p><strong>可扩展超快OLAP引擎: </strong><br>Kylin是为减少在Hadoop上百亿规模数据查询延迟而设计</p>
</li>
<li><p><strong>Hadoop ANSI SQL 接口: </strong><br>Kylin为Hadoop提供标准SQL支持大部分查询功能</p>
</li>
<li><p><strong>交互式查询能力: </strong><br>通过Kylin，用户可以与Hadoop数据进行亚秒级交互，在同样的数据集上提供比Hive更好的性能</p>
</li>
<li><p><strong>多维立方体（MOLAP Cube）:</strong><br>用户能够在Kylin里为百亿以上数据集定义数据模型并构建立方体</p>
</li>
<li><p><strong>与BI工具无缝整合:</strong><br>Kylin提供与BI工具，如Tableau，的整合能力，即将提供对其他工具的整合</p>
</li>
<li><p><strong>其他特性:</strong> </p>
<ul>
<li>Job管理与监控 </li>
<li>压缩与编码 </li>
<li>增量更新 </li>
<li>利用HBase Coprocessor</li>
<li>基于HyperLogLog的Dinstinc Count近似算法 - 友好的web界面以管理，监控和使用立方体 </li>
<li>项目及立方体级别的访问控制安全</li>
<li>支持LDAP</li>
</ul>
</li>
</ul>
<h3 id="1-4-Kylin生态圈"><a href="#1-4-Kylin生态圈" class="headerlink" title="1.4 Kylin生态圈"></a>1.4 Kylin生态圈</h3><p><img src="http://upload-images.jianshu.io/upload_images/1752522-06ce55c3c869f24f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="core.png"></p>
<p><strong>Kylin 核心:</strong> Kylin OLAP引擎基础框架，包括元数据（Metadata）引擎，查询引擎，Job引擎及存储引擎等，同时包括REST服务器以响应客户端请求</p>
<p><strong>扩展:</strong> 支持额外功能和特性的插件</p>
<p><strong>整合:</strong> 与调度系统，ETL，监控等生命周期管理系统的整合</p>
<p><strong>用户界面:</strong> 在Kylin核心之上扩展的第三方用户界面</p>
<p><strong>驱动:</strong> ODBC 和 JDBC 驱动以支持不同的工具和产品，比如Tableau</p>
<h3 id="1-5-Kylin在各大公司的实践"><a href="#1-5-Kylin在各大公司的实践" class="headerlink" title="1.5 Kylin在各大公司的实践"></a>1.5 Kylin在各大公司的实践</h3><ul>
<li><a href="http://www.infoq.com/cn/articles/kylin-apache-in-meituan-olap-scenarios-practice" target="_blank" rel="external">Apache Kylin在美团数十亿数据OLAP场景下的实践
</a></li>
<li><a href="http://www.infoq.com/cn/articles/practis-of-apache-kylin-in-baidu-map" target="_blank" rel="external">Apache Kylin在百度地图的实践</a></li>
<li><a href="http://www.tuicool.com/articles/BFrQn2J" target="_blank" rel="external">Apache Kylin在京东云海的实践</a></li>
<li><a href="http://www.tuicool.com/articles/y6vEfyU" target="_blank" rel="external">Apache Kylin 在电信运营商的实践和案例分享</a></li>
<li><a href="http://kyligence.io/2016/12/2161/" target="_blank" rel="external">Apache Kylin在国美在线的应用</a></li>
<li><a href="http://kyligence.io/2016/12/2208/" target="_blank" rel="external">Apache Kylin在魅族的实践</a></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-3ef68656c02dce96.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<h3 id="1-6-Kylin基础概念"><a href="#1-6-Kylin基础概念" class="headerlink" title="1.6 Kylin基础概念"></a>1.6 Kylin基础概念</h3><ul>
<li><strong>星型模型</strong></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-fdd4b9c3e735bc2b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="star-schema"></p>
<ul>
<li><strong>Cube</strong><br><img src="http://upload-images.jianshu.io/upload_images/1752522-2b88a5bd73284efe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cube"></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-1e771d4d6cb92a32.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Partial Cube"></p>
<ul>
<li><strong>在HBase中存储</strong></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-2d01c3338ea5556a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="屏幕快照 2016-12-22 下午1.55.04.png"></p>
<h4 id="1-6-1-CUBE"><a href="#1-6-1-CUBE" class="headerlink" title="1.6.1 CUBE"></a>1.6.1 CUBE</h4><ul>
<li><p><strong>Table</strong> - 表， 是Cube的数据源；在创建Cube之前，KAP需要从数据源（通常为Hive）同步表的元数据，包含表名、列名、列属性等。</p>
</li>
<li><p><strong>Data Model</strong> - 数据模型，定义了由若干张表的一个连接关系。Kylin支持<a href="https://en.wikipedia.org/wiki/Star_schema" target="_blank" rel="external">星型模型</a>的多维分析；在创建Cube之前，用户需定义这么一个数据模型（目前Kylin<strong>只支持星型模型</strong>，未来会支持雪花模型）。</p>
</li>
<li><p><strong>Cube</strong> - 数据立方体，是一种多维分析的技术，通过预计算，将计算结果存储在某多个维度值所映射的空间中；在运行时通过对Cube的再处理而快速获取结果。</p>
</li>
<li><p><strong>Partition</strong> - 分区，用户可以定义一个分区日期或时间列，随后对Cube的构建按此列的值范围而进行，从而将Cube分成多个Segment。</p>
</li>
<li><p><strong>Cube Segment</strong> - 每个Cube Segment是对特定时间范围的数据计算而成的Cube。每个Segment对应一张HBase表。</p>
</li>
<li><p><strong>Aggregation Group</strong> - 聚合组，每个聚合组是全部维度的一个子集；通过将很多个维度分组，并把常一起使用的维度放在一起，可以有效降低Cube的组合数。</p>
</li>
</ul>
<h4 id="1-6-2-维度-amp-度量"><a href="#1-6-2-维度-amp-度量" class="headerlink" title="1.6.2 维度 &amp; 度量"></a>1.6.2 维度 &amp; 度量</h4><ul>
<li><p><strong>Mandotary</strong> - 必需的维度：这种类型用于对Cube生成树做剪枝：如果一个维度被标记为“Mandatory”，会认为所有的查询都会包含此维度，故所有不含此维度的组合，在Cube构建时都会被剪枝（不计算）.</p>
</li>
<li><p><strong>Hierarchy</strong> - 层级维度：如果多个维度之间有层级（或包含）的关系，通过设置为“Hierarchy”，那些不满足层级的组合会被剪枝。如果A, B, C是层级，并且A&gt;B&gt;C，那么只需要计算组合A, AB, ABC; 其它组合如B, C, BC, AC将不做预计算。</p>
</li>
<li><p><strong>Derived</strong> - 衍生维度：维度表的列值，可以从它的主键值衍生而来，那么通过将这些列定义为衍生维度，可以仅将主键加入到Cube的预计算来，而在运行时通过使用维度表的快照，衍生出非PK列的值，从而起到降维的效果。</p>
</li>
<li><p><strong>Count Distinct(HyperLogLog)</strong> - 基于HyperLogLog的Count Distint：快速、精确的COUNT DISTINCT是较难计算的, 一个近似的轻量级算法 - <a href="https://en.wikipedia.org/wiki/HyperLogLog" target="_blank" rel="external">HyperLogLog</a> 为此而发明, 能够在大规模数据集上做去重并保持较低的误差率.</p>
</li>
<li><p><strong>Count Distinct(Bitmap)</strong> - 基于Bitmap的COUNT DISTINCT，可以精确去重，但是存储开销较大。目前只支持int的数据类型.</p>
</li>
<li><p><strong>Top N</strong> - 预计算最top的某些记录的度量，如交易量最大的1000个卖家。</p>
</li>
</ul>
<h4 id="1-6-3-CUBE-操作"><a href="#1-6-3-CUBE-操作" class="headerlink" title="1.6.3 CUBE 操作"></a>1.6.3 CUBE 操作</h4><ul>
<li><p><strong>BUILD</strong> - 构建：给定一个时间范围，将源数据通过运算而生成一个新的Cube Segment。</p>
</li>
<li><p><strong>REFRESH</strong> - 刷新：对某个已经构建过的Cube Segment，重新从数据源抽取数据并构建，从而获得更新。</p>
</li>
<li><p><strong>MERGE</strong> - 合并：将多个Cube Segment合并为一个Segment。这个操作可以减少Segment的数量，同时减少Cube的存储空间。</p>
</li>
<li><p><strong>PURGE</strong> - 清空：将Cube的所有Cube Segment删除。 </p>
</li>
</ul>
<h4 id="1-6-4-JOB状态"><a href="#1-6-4-JOB状态" class="headerlink" title="1.6.4 JOB状态"></a>1.6.4 JOB状态</h4><ul>
<li><p><strong>NEW</strong> - 新任务，刚刚创建。</p>
</li>
<li><p><strong>PENDING</strong> - 等待被调度执行的任务.</p>
</li>
<li><p><strong>RUNNING</strong> - 正在运行的任务。</p>
</li>
<li><p><strong>FINISHED</strong> - 正常完成的任务（终态）。</p>
</li>
<li><p><strong>ERROR</strong> - 执行出错的任务。</p>
</li>
<li><p><strong>DISCARDED</strong> - 丢弃的任务（终态）。</p>
</li>
</ul>
<h4 id="1-6-5-JOB-操作"><a href="#1-6-5-JOB-操作" class="headerlink" title="1.6.5 JOB 操作"></a>1.6.5 JOB 操作</h4><ul>
<li><p><strong>RESUME</strong> - 恢复：处于ERROR状态的任务，用户在排查或解决问题后，通过此操作来重试执行。</p>
</li>
<li><p><strong>DISCARD</strong> - 丢弃：放弃此任务，立即停止执行且不会再恢复。</p>
</li>
</ul>
<h2 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h2><h3 id="2-1-样例数据集"><a href="#2-1-样例数据集" class="headerlink" title="2.1 样例数据集"></a>2.1 样例数据集</h3><p>二进制包中包含了一份用于测试的样例数据集，总共大小仅1MB左右，共计3张表，其中事实表有10000条数据。</p>
<p>Kylin仅支持星型数据模型，这里用到的样例数据集就是一个规范的星型模型结构，它总共包含了3个数据表：</p>
<p><strong>KYLIN_SALES</strong>  该表是事实表，保存了销售订单的明细信息。每一列保存了卖家、商品分类、订单金额、商品数量等信息，每一行对应着一笔交易订单。</p>
<p><strong>KYLIN_CATEGORY_GROUPINGS</strong> 该表是维表，保存了商品分类的详细介绍，例如商品分类名称等。</p>
<p><strong>KYLIN_CAL_DT</strong> 该表是维表，保存了时间的扩展信息。如单个日期所在的年始、月始、周始、年份、月份等。这三张表一起构成了整个星型模型的结构，下图是实例-关系图（图中未列出表上的所有列）： </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-1118eca4f5988933.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dataset_1.png"></p>
<p><strong>数据表与关系</strong></p>
<table>
<thead>
<tr>
<th>表</th>
<th>字段</th>
<th>意义</th>
</tr>
</thead>
<tbody>
<tr>
<td>KYLIN_SALES</td>
<td>PART_DT</td>
<td>订单日期</td>
</tr>
<tr>
<td>KYLIN_SALES</td>
<td>LEAF_CATEG_ID</td>
<td>商品分类ID</td>
</tr>
<tr>
<td>KYLIN_SALES</td>
<td>SELLER_ID</td>
<td>卖家ID</td>
</tr>
<tr>
<td>KYLIN_SALES</td>
<td>PRICE</td>
<td>订单金额</td>
</tr>
<tr>
<td>KYLIN_SALES</td>
<td>ITEM_COUNT</td>
<td>购买商品个数</td>
</tr>
<tr>
<td>KYLIN_SALES</td>
<td>LSTG_FORMAT_NAME</td>
<td>订单交易类型</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>USER_DEFINED_FIELD1</td>
<td>用户定义字段1</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>USER_DEFINED_FIELD3</td>
<td>用户定义字段3</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>UPD_DATE</td>
<td>更新日期</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>UPD_USER</td>
<td>更新负责人</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>META_CATEG_NAME</td>
<td>一级分类</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>CATEG_LVL2_NAME</td>
<td>二级分类</td>
</tr>
<tr>
<td>KYLIN_CATEGORY_GROUPINGS</td>
<td>CATEG_LVL3_NAME</td>
<td>三级分类</td>
</tr>
<tr>
<td>KYLIN_CAL_DT</td>
<td>CAL_DT</td>
<td>日期</td>
</tr>
<tr>
<td>KYLIN_CAL_DT</td>
<td>WEEK_BEG_DT</td>
<td>周始日期</td>
</tr>
</tbody>
</table>
<h3 id="2-2-数据导入"><a href="#2-2-数据导入" class="headerlink" title="2.2 数据导入"></a>2.2 数据导入</h3><h4 id="2-2-1-导入Hive数据源"><a href="#2-2-1-导入Hive数据源" class="headerlink" title="2.2.1 导入Hive数据源"></a>2.2.1 导入Hive数据源</h4><p>目前，Kylin支持Hive作为默认的输入数据源。为了使用Kylin中自带的样例数据，需要把数据表导入Hive中。在Kylin安装目录的bin文件夹中，有一个可执行脚本，可以把样例数据导入Hive：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line"><span class="variable">$KYLIN_HOME</span>/bin/sample.sh</div></pre></td></tr></table></figure>
<p>脚本执行成功之后，进入Hive CLI，确认这些数据已经导入成功，命令如下：</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><div class="line">hive</div><div class="line">hive&gt; show tables;</div><div class="line">OK</div><div class="line">kylin_cal_dt</div><div class="line">kylin_category_groupings</div><div class="line">kylin_sales</div><div class="line"><span class="built_in">Time</span> taken: <span class="number">0.127</span> seconds, Fetched: <span class="number">3</span> row(s)</div><div class="line">hive&gt; <span class="built_in">select</span> <span class="built_in">count</span>(*) <span class="keyword">from</span> kylin_sales;</div><div class="line">Query ID = root_20160707221515_b040318d-<span class="number">1</span>f08-<span class="number">44</span>ab-b337-d1f858c46d7d</div><div class="line">Total jobs = <span class="number">1</span></div><div class="line">Launching Job <span class="number">1</span> out of <span class="number">1</span></div><div class="line">Number of reduce tasks determined at <span class="built_in">compile</span> <span class="built_in">time</span>: <span class="number">1</span></div><div class="line"><span class="built_in">In</span> order <span class="keyword">to</span> change the average <span class="built_in">load</span> <span class="keyword">for</span> a reducer (<span class="built_in">in</span> bytes):</div><div class="line">  <span class="built_in">set</span> hive.<span class="built_in">exec</span>.reducers.bytes.per.reducer=&lt;number&gt;</div><div class="line"><span class="built_in">In</span> order <span class="keyword">to</span> limit the maximum number of reducers:</div><div class="line">  <span class="built_in">set</span> hive.<span class="built_in">exec</span>.reducers.<span class="built_in">max</span>=&lt;number&gt;</div><div class="line"><span class="built_in">In</span> order <span class="keyword">to</span> <span class="built_in">set</span> a constant number of reducers:</div><div class="line">  <span class="built_in">set</span> mapreduce.job.reduces=&lt;number&gt;</div><div class="line">Starting Job = job_1467288198207_0129, Tracking URL = http:<span class="comment">//sandbox.hortonworks.com:8088/proxy/application_1467288198207_0129/</span></div><div class="line">Kill Command = /usr/hdp/<span class="number">2.2</span>.<span class="number">4.2</span>-<span class="number">2</span>/hadoop/bin/hadoop job  -kill job_1467288198207_0129</div><div class="line">Hadoop job information <span class="keyword">for</span> Stage-<span class="number">1</span>: number of mappers: <span class="number">1</span>; number of reducers: <span class="number">1</span></div><div class="line"><span class="number">2016</span>-<span class="number">07</span>-<span class="number">07</span> <span class="number">22</span>:<span class="number">15</span>:<span class="number">11</span>,<span class="number">897</span> Stage-<span class="number">1</span> map = <span class="number">0</span>%,  reduce = <span class="number">0</span>%</div><div class="line"><span class="number">2016</span>-<span class="number">07</span>-<span class="number">07</span> <span class="number">22</span>:<span class="number">15</span>:<span class="number">17</span>,<span class="number">502</span> Stage-<span class="number">1</span> map = <span class="number">100</span>%,  reduce = <span class="number">0</span>%, Cumulative CPU <span class="number">1.64</span> sec</div><div class="line"><span class="number">2016</span>-<span class="number">07</span>-<span class="number">07</span> <span class="number">22</span>:<span class="number">15</span>:<span class="number">25</span>,<span class="number">039</span> Stage-<span class="number">1</span> map = <span class="number">100</span>%,  reduce = <span class="number">100</span>%, Cumulative CPU <span class="number">3.37</span> sec</div><div class="line">MapReduce Total cumulative CPU <span class="built_in">time</span>: <span class="number">3</span> seconds <span class="number">370</span> msec</div><div class="line">Ended Job = job_1467288198207_0129</div><div class="line">MapReduce Jobs Launched:</div><div class="line">Stage-Stage-<span class="number">1</span>: Map: <span class="number">1</span>  Reduce: <span class="number">1</span>   Cumulative CPU: <span class="number">3.37</span> sec   HDFS Read: <span class="number">505033</span> HDFS Write: <span class="number">6</span> SUCCESS</div><div class="line">Total MapReduce CPU <span class="built_in">Time</span> Spent: <span class="number">3</span> seconds <span class="number">370</span> msec</div><div class="line">OK</div><div class="line"><span class="number">10000</span></div><div class="line"><span class="built_in">Time</span> taken: <span class="number">24.966</span> seconds, Fetched: <span class="number">1</span> row(s)</div></pre></td></tr></table></figure>
<h4 id="2-2-2-创建项目"><a href="#2-2-2-创建项目" class="headerlink" title="2.2.2 创建项目"></a>2.2.2 创建项目</h4><p>打开Kylin的Web UI（<ip>:7070/kylin），如下图所示的操作创建一个新的项目（Project），并命名为KAP_Sample_1。</ip></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-5068797db1e9470f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dataimport_1.png"></p>
<p>在Web UI的左上角选择刚刚创建的项目，表示我们接下来的全部操作都在这个项目中，在当前项目的操作不会对其他项目产生影响。 </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-6fca7a6cc0e11ce4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dataimport_2.png"></p>
<h4 id="2-2-3-同步Hive表"><a href="#2-2-3-同步Hive表" class="headerlink" title="2.2.3 同步Hive表"></a>2.2.3 同步Hive表</h4><p>需要把Hive数据表同步到Kylin当中才能使用。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-94e857406c491ae5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dataimport_3.png"></p>
<p>在弹出的对话框中展开default数据库，并选择需要的三张表，如图所示 </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-7b7339f8f56be4d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dataimport_4.png"></p>
<p>导入后系统会自动计算各表各列的维数，以掌握数据的基本情况。稍等几分钟后，我们可以通过数据源表的详情页查看这些信息。 </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-e276d255006fe654.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="dataimport_5.png"></p>
<h3 id="2-3-创建数据模型（model）"><a href="#2-3-创建数据模型（model）" class="headerlink" title="2.3 创建数据模型（model）"></a>2.3 创建数据模型（model）</h3><p>在数据源就绪的基础之上，我们开始创建数据模型。以Kylin自带的数据集为例，该数据集的数据模型包含1个事实表和2个维表，表间通过外键进行关联。实际上，并不是表上所有的字段都有被分析的需要，因此我们可以有目的地仅选择所需字段添加到数据模型中；然后，根据具体的分析场景，把这些字段设置为维度或度量。</p>
<p>打开Kylin的Web UI，在左上角项目列表中选择刚刚创建的<strong>KAP_Sample_1</strong>项目，然后进入“模型”页面，并创建一个模型。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-7c5019c7e84cddb9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="datamodel_1.png"></p>
<p>第一步，在基本信息页，输入模型名称为Sample_Model_1，然后单击下一步。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-546162bcaa06d6cc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="datamodel_2.png"></p>
<p>第二步，为模型选择事实表（<em>Fact Table</em>）和查找表（<em>Lookup Table</em>）。根据星型模型结构，选择KYLIN_SALES为事实表，然后添加KYLIN_CAL_DT和KYLIN_CATEGORY_GROUPINGS作为查找表，并设置好连接条件：</p>
<p>KYLIN_CAL_DT 连接类型：Inner 连接条件：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">DEFAULT<span class="selector-class">.KYLIN_SALES</span><span class="selector-class">.PART_DT</span> = DEFAULT<span class="selector-class">.KYLIN_CAL_DT</span><span class="selector-class">.CAL_DT</span></div></pre></td></tr></table></figure>
<p>KYLIN_CATEGORY_GROUPINGS 连接类型：Inner 连接条件：</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><div class="line">KYLIN_SALES<span class="selector-class">.LEAF_CATEG_ID</span> = KYLIN_CATEGORY_GROUPINGS<span class="selector-class">.LEAF_CATEG_ID</span></div><div class="line">KYLIN_SALES<span class="selector-class">.LSTG_SITE_ID</span> = KYLIN_CATEGORY_GROUPINGS.SITE_ID</div></pre></td></tr></table></figure>
<p>下图是设置好之后的界面： </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-ef4a4bd304401b15.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="datamodel_3.png"></p>
<p>第三步，从上一步添加的事实表和查找表中选择需要作为维度的字段。一般的，时间经常用来作为过滤条件，所以我们首先添加时间字段。此外，我们再添加商品分类、卖家ID等字段为维度，具体情况如下图所示： </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-086d01240e72f0cb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="datamodel_4.png"></p>
<p>第四步，根据业务需要，从事实表上选择衡量指标的字段作为度量。例如，PRICE字段用来衡量销售额，ITEM_COUNT字段用来衡量商品销量，SELLER_ID用来衡量卖家的销售能力。最终结果如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-3942e07573e7cf1d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="datamodel_5.png"></p>
<p>第五步，设置根据时间分段。一般来说，销售数据都是与日俱增的，每天都会有新数据通过ETL到达Hive中，需要选择增量构建方式构建Cube，所以需要选择用于分段的时间字段DEFAULT.KYLIN_SALES.PART_DT。根据样例数据可以看到，这一列时间的格式是yyyy-MM-dd，所以选择对应的日期格式。此外，我们既不需要设置单独的分区时间列，也不需要添加固定的过滤条件。设置效果如下图所示。 </p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-dfbc366e565347b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="datamodel_6.png"></p>
<p>最终，单击“保存”按钮，到此数据模型就创建成功了。</p>
<h3 id="2-4-创建Cube"><a href="#2-4-创建Cube" class="headerlink" title="2.4 创建Cube"></a>2.4 创建Cube</h3><p>在创建好数据模型的基础上，我们还需要根据查询需求定义度量的预计算类型、维度的组合等，这个过程就是Cube设计的过程。本文将以Kylin自带的样例数据为例，介绍Cube的创建过程。</p>
<p>打开Kylin的Web UI，首先选择KAP_Sample_1项目，跳转到模型页面，然后按照下图所示创建一个Cube。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-95d11c3255835a78.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_1.png"></p>
<p>第一步，在“模型名称”中选择Sample_Model_1，输入新建Cube的名称Sample_Cube_1，其余字段保持默认，然后单击“下一步”。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-b9610e117aa519da.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_2.png"></p>
<p>第二步，从数据模型的维度中选择一些列作为Cube的维度。这里的设置会影响到生成的Cuboid数量，进而影响Cube的数据量大小。 在KYLIN_CATEGORY_GROUPINGS表里，和商品分类相关的三个字段（META_CATEG_NAME、CATEG_LVL2_NAME、CATEG_LVL3_NAME）都可能出现在过滤条件中，我们先把他们添加为普通类型维度。因为从查询表上添加普通维度不能通过自动生成器（Auto Generator）生成，因此采用手动添加方式，过程如下：</p>
<ol>
<li><p>单击“添加维度”按钮，然后选择“普通维度”。</p>
</li>
<li><p>针对每一个维度字段，首先在Name输入框中输入维度名称，在Table Name中选择KYLIN_CATEGORY_GROUPINGS表，然后在Column Name中选择相应的列名。</p>
</li>
</ol>
<p>此外，在查询中还经常把时间作为过滤或聚合的条件，如按周过滤、按周聚合等。这里我们以按周为例，需要用到KYLIN_CAL_DT中的WEEK_BEG_DT字段，但是该字段实际上可以由PART_DT字段决定，即根据每一个PART_DT值可以对应出一个WEEK_BEG_DT字段，因此，我们添加WEEK_BEG_DT字段为可推倒维度。 同样的，KYLIN_CATEGORY_GROUPINGS表中还有一些可作为可推到维度的字段，如USER_DEFINED_FIELD1、USER_DEFINED_FIELD3、UPD_DATE、UPD_USER等。</p>
<p>在事实表上，表征交易类型的LSTG_FORMAT_NAME字段也会用于过滤或聚合条件，因此，我们再添加LSTG_FORMAT_NAME字段作为普通维度。 最终，维度的设置结果如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-0b63232b1ea37c37.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_3.png"></p>
<p>第三步，根据数据分析中的聚合需求，我们需要为Cube定义度量的聚合形式。默认的，根据数据类型，系统会自动创建好一些COUNT()聚合和SUM()聚合，用于考量交易订单的数量或者卖出商品的总量。默认建好的聚合仍然可以手动修改或删除。在这个案例中，我们还需要通过PRICE的不同聚合形式考量销售额，如总销售额为SUM(PRICE)、最高订单金额为MAX(PRICE)、最低订单金额为MIN(PRICE)。因此，我们手动创建三个度量，分别选择聚合表达式为SUM、MIN、MAX，并选择PRICE列作为目标列。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-7ddf65cb11784072.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_4.png"></p>
<p>其次，我们还需要通过COUNT(DISTINCT SELLER_ID)考量卖家个数。根据前面章节的介绍，Kylin默认使用HyperLogLog算法进行COUNT_DISTINCT的计算，该算法是个近似算法，在创建度量时需要选择一个近似度，本案例对精确性要求不高，为了提升查询性能，我们选择精度较低的“Error Rate &lt; 9.75%”。同样的，我们再创建一个COUNT(DISTINCT LSTG_FORMAT_NAME)的度量考量不同条件下的交易类型。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-a138c2bc9fd67644.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_5.png"></p>
<p>在销售业务分析的场景中，往往需要挑选出销售业绩最好的商家，这时候就需要TOP-N的度量了。在这个例子中，我们会选出SUM(PRICE)最高的一些SELLER_ID，实际上就是执行如下的SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> SELLER_ID, <span class="keyword">SUM</span>(PRICE) <span class="keyword">FROM</span> KYLIN_SALES <span class="keyword">GROUP</span> <span class="keyword">BY</span> SELLER_ID <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">SUM</span>(PRICE)</div></pre></td></tr></table></figure>
<p>因此，我们创建一个TOP-N的度量，选择PRICE字段作为SUM/OPDER BY字段，选择SELLER_ID字段作为GROUP BY字段，并选择TOPN(100)作为度量的精度。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-79cbf2f5f97188d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_6.png"></p>
<p>最终添加的度量如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-eacdf1f9d1722d0c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_7.png"></p>
<p>第四步，我们对Cube的构建和维护进行配置。一般的，一个销售统计的SQL查询往往会按月、周进行过滤和聚合，所以我们可以设置Cube自动按周、月进行自动合并，即每7天进行一次合并，每4周（28天）进行一次合并，设置“触发自动合并的时间阈值”如下所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-22be16b2121f50c5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_8.png"></p>
<p>因为存在对于历史订单的查询需求，我们在此不对Cube做自动清理，所以需要设置“保留时间阈值”为0。</p>
<p>在创建数据模型的时候我们提到，我们希望采用增量构建方式对Cube进行构建，并选择了PART_DT字段作为分区时间列。在创建Cube时，我们需要指定Cube构建的起始时间，在这个例子中，根据样例数据中的时间条件，我们选择2012-01-01 00:00:00作为分区起始时间。</p>
<p>第五步，通过对Cube进行高级设置优化Cube的存储大小和查询速度，主要包括聚合组和Rowkey。在前文我们提到，添加聚合组可以利用字段间的层级关系和包含关系有效地降低Cuboid的数量。在这个案例当中，与商品分类相关的三个字段（META_CATEG_NAME、CATEG_LVL2_NAME、CATEG_LVL3_NAME）实际上具有层级关系，如一级类别（META_CATEG_NAME）包含多个二级类别（CATEG_LVL2_NAME），二级类别又包含多个三级类别（CATEG_LVL3_NAME），所以，我们可以为它们创建层级结构的组合（Hierarchy Dimensions）。最终，聚合组的设计如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-71849088c33324a9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_9.png"></p>
<p>由于参与Cuboid生成的维度都会作为Rowkey，因此我们需要把这些列添加为Rowkey当中。在这个案例中，总共需要添加7个Rowkey。在每个Rowkey上，还需要为列值设置编码方法。在这个案例中，我们除了把LSTG_FORMAT_NAME设置为fixed_length类型（长度为12）外，将其余的Rowkey都设置为dict编码。 Rowkey的顺序对于查询性能来说至关重要，如第六章所讲，一般把最经常出现在过滤条件中的列放置在Rowkey的前面，在这个案例中，我们首先把PART_DT放在Rowkey的第一位。接下来，按照层级把商品分类的字段跟随其后。最终，Rowkey的设置如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-87a6469b386f9318.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_10.png"></p>
<blockquote>
<p><strong>对Plus版本</strong>：Raw Table是Plus版本的特有功能。如果启用，Kylin将在构建Cube之外也保存所有的原始记录，支持高速的明细查询。Raw Table还处于beta测试阶段，仅支持最简单的启用或者不启用。其他的Raw Table配置参数暂时不起作用。</p>
</blockquote>
<p>第六步，设置Cube的配置覆盖。在这里添加的配置项可以在Cube级别覆盖从kylin.properties配置文件读取出来的全局配置。在这个案例中，我们可以直接采用默认配置，在此不做任何修改。 ​第七步，对Cube的信息进行概览。请读者仔细确认这些基本信息，包括数据模型名称、事实表以及维度和度量个数。确认无误后单击“保存”按钮，并在弹出的确认提示框中选择“Yes”。 ​最终，Cube的创建就完成了。我们可以刷新Model页面，在Cube列表中就可以看到新创建的Cube了。因为新创建的Cube没有被构建过，是不能被查询的，所以状态仍然是“禁用”。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-76862da06fef99b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="createcube_11.png"></p>
<h3 id="2-5-构建Cube"><a href="#2-5-构建Cube" class="headerlink" title="2.5 构建Cube"></a>2.5 构建Cube</h3><p>在创建好Cube之后，只有对Cube进行构建，才能利用它执行SQL查询。本文以Kylin样例数据为例，介绍Cube构建的过程。</p>
<p><strong>初次构建</strong></p>
<p>首先打开Kylin的Web UI，并选择Kylin_Sample_1项目，然后跳转到模型页面，找到Cube列表。 第一步，在Cube列表中找到Kylin_Sample_Cube_1。单击右侧的Action按钮，在弹出的菜单中选择“构建”。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-a99c1fd6b184f610.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="buildcube_0.png"></p>
<p>第二步，在弹出的Cube构建确认对话框中确认Cube的分段时间列（Partition Date Column）是DEFAULT.KYLIN_SALES.PART_DT，以及起始时间是2012-01-01 00:00:00。在KAP中，一次构建会为Cube产生一个新的Segment，每次的SQL查询都会访问一个或多个符合条件的Segment；我们需要尽可能地让一个Segment更好地适用于查询条件，因此我们可以按年构建，即每个年份构建一个Segment。在这个例子中，我们输入结束日期（End Date）为2013-01-01 00:00:00。设置完成后单击Submit按钮。</p>
<blockquote>
<p>注意：增量构建是具体按年构建还是按月构建应该根据实际的业务需求、ETL时效及数据量大小而定。如果一次构建的数据量过大，可能导致构建时间过长，或出现内存溢出等异常。在当前的样例数据中，数据量较小，按年构建是可以顺利完成的。</p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-aa6a2267fc5259cd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="buildcube_1.png"></p>
<p>当任务成功提交之后，切换到Monitor页面，这里会列出所有的任务列表。我们找到列表最上面的一个任务（名称是：Kylin_Sample_Cube_1 - 20120101000000_20130101000000），这就是我们刚刚提交的任务。在这一行双击或单击右侧的箭头图标，页面右侧会显示当前任务的详细信息。 待构建任务完成，可以在Monitor页面看到该任务状态已被置为完成（Finished）。这时候，第一个Segment就构建完成了。前往Cube列表中查看，会发现该Cube的状态已被置为“就绪（Ready）”了。</p>
<p><strong>增量构建</strong></p>
<p>在第一个Segment构建完成之后，我们开始构建第二个Segment。首先在Model页面的Cube列表中找到该Cube，单击右侧的Actions按钮，然后选择“Build”，打开Cube构建确认对话框。 在这个对话框中，首先确认起始时间（Start Date）是2013-01-01 00:00:00，因为这是上次构建的结束日期，为保障所构建数据的连续性，Apache Kylin自动为新一次构建的起始时间更新为上次构建的结束日期。同样的，在结束时间（End Date）里输入2014-01-01 00:00:00，然后单击Submit按钮，开始构建下一年的Segment。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-7f9d17cfa65272bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="buildcube_2.png"></p>
<p>待构建完成，我们可以在Cube的详情页中查看，发现Cube的两个Segment都已就绪。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1752522-a46c1e5ff55cea0e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="buildcube_3.png"></p>
<h2 id="3-参考资料"><a href="#3-参考资料" class="headerlink" title="3. 参考资料"></a>3. 参考资料</h2><ul>
<li><a href="http://kylin.apache.org/cn/" target="_blank" rel="external">http://kylin.apache.org/cn/</a></li>
<li><a href="https://kyligence.gitbooks.io/kap-manual/content/zh-cn/introduction/concepts.cn.html" target="_blank" rel="external">https://kyligence.gitbooks.io/kap-manual/content/zh-cn/introduction/concepts.cn.html</a></li>
<li><a href="http://webdataanalysis.net/web-data-warehouse/multidimensional-data-model/" target="_blank" rel="external">http://webdataanalysis.net/web-data-warehouse/multidimensional-data-model/</a></li>
<li><a href="http://www.cnblogs.com/mq0036/p/4155832.html" target="_blank" rel="external">http://www.cnblogs.com/mq0036/p/4155832.html</a></li>
</ul>

      
    </div>

    <div>
      
        
<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/uploads/wechat-qcode.jpg" alt="LBD wechat" style="width: 200px; max-width: 100%;"/>
    <div>欢迎关注公众号:FullStackPlan获取更多干货</div>
</div>


      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/大数据/" rel="tag"># 大数据</a>
          
            <a href="/tags/Kylin/" rel="tag"># Kylin</a>
          
            <a href="/tags/NoSQL/" rel="tag"># NoSQL</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/12/30/分布式系列文章——Paxos算法原理与推导/" rel="next" title="分布式系列文章——Paxos算法原理与推导">
                <i class="fa fa-chevron-left"></i> 分布式系列文章——Paxos算法原理与推导
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/01/03/数组中出现次数超过一半的数字/" rel="prev" title="数组中出现次数超过一半的数字">
                数组中出现次数超过一半的数字 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/01/03/Apache Kylin综述/"
           data-title="Apache Kylin综述" data-url="http://linbingdong.com/2017/01/03/Apache Kylin综述/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="LBD" />
          <p class="site-author-name" itemprop="name">LBD</p>
          <p class="site-description motion-element" itemprop="description">大数据与分布式</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">105</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              博客推荐
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="https://toutiao.io/subjects/157348" title="开发者头条独家号" target="_blank">开发者头条独家号</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.pingcap.com/bloglist.html" title="PingCAP博客" target="_blank">PingCAP博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://tech.meituan.com/" title="美团点评技术团队" target="_blank">美团点评技术团队</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://dongxicheng.org/" title="董的博客" target="_blank">董的博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://hbasefly.com/" title="有态度的HBase" target="_blank">有态度的HBase</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://jm.taobao.org" title="阿里中间件团队博客" target="_blank">阿里中间件团队博客</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://zh.lucida.me/archives/" title="Lucida" target="_blank">Lucida</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-简介"><span class="nav-text">1. 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-Kylin概览"><span class="nav-text">1.1 Kylin概览</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-Kylin架构"><span class="nav-text">1.2 Kylin架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-Kylin特点"><span class="nav-text">1.3 Kylin特点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-Kylin生态圈"><span class="nav-text">1.4 Kylin生态圈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-5-Kylin在各大公司的实践"><span class="nav-text">1.5 Kylin在各大公司的实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-6-Kylin基础概念"><span class="nav-text">1.6 Kylin基础概念</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-1-CUBE"><span class="nav-text">1.6.1 CUBE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-2-维度-amp-度量"><span class="nav-text">1.6.2 维度 & 度量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-3-CUBE-操作"><span class="nav-text">1.6.3 CUBE 操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-4-JOB状态"><span class="nav-text">1.6.4 JOB状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-6-5-JOB-操作"><span class="nav-text">1.6.5 JOB 操作</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-使用"><span class="nav-text">2. 使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-样例数据集"><span class="nav-text">2.1 样例数据集</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-数据导入"><span class="nav-text">2.2 数据导入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-导入Hive数据源"><span class="nav-text">2.2.1 导入Hive数据源</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-创建项目"><span class="nav-text">2.2.2 创建项目</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-同步Hive表"><span class="nav-text">2.2.3 同步Hive表</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-创建数据模型（model）"><span class="nav-text">2.3 创建数据模型（model）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-创建Cube"><span class="nav-text">2.4 创建Cube</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-构建Cube"><span class="nav-text">2.5 构建Cube</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-参考资料"><span class="nav-text">3. 参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LBD</span>
</div>



        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">访客数<span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv">访问量<span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"lbd"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  










  
  

  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
